<html>
<head>
<meta name=vsisbn content="0789719274">
<meta name=vstitle content="Unix Hints & Hacks">
<meta name=vsauthor content="Kirk Waingrow">
<meta name=vsimprint content="Que">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="04/20/99">
<meta name=vscategory content="Operating Systems: UNIX">




<title>UNIX Hints and Hacks:Topics in Administration</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/0789719274.gif" width=60 height=73 alt="Unix Hints & Hacks" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Unix Hints & Hacks</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by Kirk Waingrow</i>
    <br>
    Que,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;0789719274<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;04/20/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=0789719274//-->
<!--TITLE=UNIX Hints and Hacks//-->
<!--AUTHOR=Kirk Waingrow//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=que//-->
<!--CHAPTER=01//-->
<!--PAGES=012-016//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="01-01.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="01-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h3><a name="Heading2"></A><font color="#000077">1.1 Collecting System Information</FONT></H3>
<h4 align="LEFT"><a name="Heading3"></A><font color="#000077">1.1.1 Description</FONT></H4>
<p>For any new computer, collect the information that it contains.
</P>
<p><font size="+1"><b>Example</B></FONT></P>
<p>Flavors: AT&T, BSD
</P>
<p>At the very least, collect the following information for each system that you have:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;Hostname:
<!-- CODE SNIP //-->
<pre>
% hostname
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Hostname aliases:
<!-- CODE SNIP //-->
<pre>
% grep &#145;hostname&#145; /etc/hosts | awk &#145;{ print $3 }&#146;
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Host network addresses:
<!-- CODE SNIP //-->
<pre>
% grep &#145;hostname&#145; /etc/hosts | awk &#145;{ print $1 }&#146;
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Host ID:
<!-- CODE SNIP //-->
<pre>
% hostid
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;System serial number:
<br>On the back of most all computers.
<dd><b>&#149;</B>&nbsp;&nbsp;Manufacturer of the system&#146;s hardware:
<br>On the front of most computers
<dd><b>&#149;</B>&nbsp;&nbsp;System model name:
<br>On the front of most computers
<dd><b>&#149;</B>&nbsp;&nbsp;CPU type:
<!-- CODE SNIP //-->
<pre>
% uname -a
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Application architecture:
<!-- CODE SNIP //-->
<pre>
% uname -a
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Kernel architecture:
<!-- CODE SNIP //-->
<pre>
% uname -a
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Amount of main memory:
<br>Can be found at boot time
<!-- CODE SNIP //-->
<pre>
% dmesg
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Operating system name:
<!-- CODE SNIP //-->
<pre>
% uname -a
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Operating system version:
<!-- CODE SNIP //-->
<pre>
% uname -a
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Kernel version:
<!-- CODE SNIP //-->
<pre>
% uname -a
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Disk configuration:
<!-- CODE SNIP //-->
<pre>
% df
</PRE>
<!-- END CODE SNIP //-->
<dd><b>&#149;</B>&nbsp;&nbsp;Other pieces of information to consider are
<dl>
<dd>A copy of all the NFS mounted filesystems
<dd>NIS/YP configuration
<dd>A listing of all OS packages installed
<dd>A listing of all patches installed
<dd>Complete disk drive settings and configurations
<dd>All relevant software license keys and codes
<dd>Any custom soft links that were created
<dd>A copy of the settings and configurations for all defined printers
</DL>
</DL>
<p><font size="+1"><b>Reason</B></FONT></P>
<p>As an environment grows or more machines need to be maintained, it is best to always have a report of the configuration of the system.
</P>
<p><font size="+1"><b>Real World Experience</B></FONT></P>
<p>One of the worst things that can happen to even the most experienced UNIX administrators is to open up a trouble ticket with a vendor to replace a disk drive or memory and not have the answer to the simplest of questions: &#147;How big was the drive?&#148; or &#147;What size SIMMs were in the system?&#148;. It takes only a second to gather the information when the computer first arrives. Have the information readily available.
</P>
<p>If a system drive dies and you have a copy of the configuration (and good backups), you can label the drive with the same configurations as the dead one, restore from your backups, and be back in business.</P>
<p><font size="+1"><b>Other Resources</B></FONT></P>
<p>Man pages:
</P>
<!-- CODE SNIP //-->
<pre>
df, hostname, hostid, uname
</PRE>
<!-- END CODE SNIP //-->
<p>Internet:
</P>
<p>SysInfo home page&#151;<a href="http://www.magnicomp.com/sysinfo/">http://www.MagniComp.com/sysinfo/</A></P>
<h3><a name="Heading4"></A><font color="#000077">1.2 Backup Key Files!</FONT></H3>
<h4 align="LEFT"><a name="Heading5"></A><font color="#000077">1.2.1 Description</FONT></H4>
<p>One of the very last things that should be finished before moving a system into production is to back up all the key files to another spot on the system.
</P>
<p><font size="+1"><b>Example</B></FONT></P>
<p>Flavors: AT&T, BSD
</P>
<p><i>Kernel</I> This should be the first file backed up. If it gets deleted you can restore it back. This file is often named /kernel, /unix, or /vmunix.</P>
<p><i>Password File</I> Having a backup of the password file is a good idea, in case the system password file gets compromised. This is the file referred to as /etc/passwd.</P>
<p><i>Group File</I> Back this up for similar reasons as you do a password file. This file is /etc/group.</P>
<p><i>Host Table</I> Make an extra copy of the host table, in case the file is corrupted or entries are removed and then needed in the future. This file is named /etc/hosts.</P>
<p><i>Filesystem Table</I> This is for recovery of the filesystem configurations. This file is often called /etc/fstab or /etc/vfstab.</P>
<p><i>Sendmail Config Files</I> If anyone works with sendmail, back these up for sure. If mail breaks, the quickest recovery is to restore from the backed up config files. These would be /usr/lib/sendmail.cf, /usr/lib/sendmail.fc, and /usr/lib/sendmail.mc.</P>
<p>Inetd Configs This file has been known to get misconfigured and is a target for hackers. This is the file /etc/inetd.conf.</P>
<p><i>TTY settings</I> If you have any specialized devices attached, these should be backed up. These settings are typically found in /etc/inittab, /etc/ttytab, and /etc/ttys.</P>
<p><i>Start Up Scripts</I> Any special scripts that get started at boot time should be kept in another area. These files would usually reside in the /etc/init.d or /etc/rc#.d directories.</P>
<p><font size="+1"><b>Reason</B></FONT></P>
<p>It is quicker to restore small, necessary files from disk than from tape. For security monitoring, the files can be checked periodically to see whether any of the system files were compromised.
</P>
<p><font size="+1"><b>Real World Experience</B></FONT></P>
<p>Reserve 5&#150;10MB on another disk for vital data. If a second disk isn&#146;t available, use a partition other than any of the partitions that the backed up files live on. If all the files being backed up are on the root (/) partition, store the files in the /usr/ partition. Make sure that all the files maintain the same ownership and permissions as the original system files.
</P>
<p>Some flavors of UNIX don&#146;t expect a lot of space in the root partition. Users sometimes see the root partition 95% or more full, view the lack of disk space as an immediate problem, and remove any large files that catch their attention, including the largest one at the top of the tree: the kernel file. It is usually one of the first to go. This isn&#146;t something that happens a lot, but if there is a backup nearby, the user can be up and running in no time.</P>
<p>In addition to having a copy of these files, you have the opportunity to check the system files against the backup files to see whether any were compromised.</P>
<h3><a name="Heading6"></A><font color="#000077">1.3 Execution on the Last Day of a Month</FONT></H3>
<h4 align="LEFT"><a name="Heading7"></A><font color="#000077">1.3.1 Description</FONT></H4>
<p>This command will determine whether tomorrow is the first day of the next month. If it finds that to be true, you can then execute a predefined script or program.
</P>
<p><font size="+1"><b>Example One: The Shell Method</B></FONT></P>
<p>Flavors: AT&T, BSD
</P>
<p>Shells: bsh, bash, ksh, Perl</P>
<p>Syntax:</P>
<!-- CODE SNIP //-->
<pre>
TZ={GMT|PST|EDT|...}<b>-24 date &#43;%d</B>
</PRE>
<!-- END CODE SNIP //-->
<p><small>TZ</SMALL> is a reserved timezone variable in the UNIX system. Simply tell <small>TZ</SMALL> that it will be tomorrow by adding one day to the current date (<small>&#43;%d</SMALL>). If today is the last day of the month (that is, 31), <small>TZ</SMALL> will recognize that tomorrow is the first day of the next month.</P>
<!-- CODE SNIP //-->
<pre>
$ TZ=PST-24 date &#43;%d
</PRE>
<!-- END CODE SNIP //-->
<p>This can then be scripted to execute a program if the result of <small>TZ</SMALL> is <small>1</SMALL>.</P>
<!-- CODE SNIP //-->
<pre>
#! /bin/sh

FILE=&#145;runme&#145;
if test &#145;TZ=PST-24 date &#43;%d&#145; = 1; then
   $FILE
fi
</PRE>
<!-- END CODE SNIP //-->
<p>Line 1: Sets the shell script to be used (the Bourne shell in this case).
</P>
<p>Line 3: Sets a variable to the name of the program to run.</P>
<p>Line 4: If the value that results from <small>TZ</SMALL> equals <small>1</SMALL>, today is the last day of the month.</P>
<p>Line 5: Because today is the last day, execute the program stored in the variable called <small>FILE</SMALL>.</P>
<p>Line 6: If the result of <small>TZ</SMALL> does not equal <small>1</SMALL>, end this script.</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="01-01.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="01-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>