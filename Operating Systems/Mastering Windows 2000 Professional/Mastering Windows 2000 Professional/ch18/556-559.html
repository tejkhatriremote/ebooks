<html>
<head>
<meta name=vsisbn content="0782124488">
<meta name=vstitle content="Mastering Windows 2000 Professional">
<meta name=vsauthor content="Mark Minasi, Todd Phillips">
<meta name=vspublisher content="Sybex, Inc.">
<meta name=vspubdate content="01/01/00">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Mastering Windows 2000 Professional:Understanding the Architecture</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

<script language="JavaScript1.2">
<!--
function checkForQuery(fm) {
  /* get the query value */
  var i = escape(fm.query.value);
  if (i == "") {
      alert('Please enter a search word or phrase');
      return false;
  }                  /* query is blank, dont run the .jsp file */
  else return true;  /* execute the .jsp file */
}
//--></script>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/0782124488.gif" width=60 height=73 alt="Mastering Windows 2000 Professional" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Mastering Windows 2000 Professional</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by Mark Minasi, Todd Phillips</i>
    <br>
    Sybex, Inc.
    <br>
    <b>ISBN:</b>&nbsp;0782124488<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;01/01/00</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=0782124488//-->
<!--TITLE=Mastering Windows 2000 Professional//-->
<!--AUTHOR=Mark Minasi//-->
<!--AUTHOR=Todd Phillips//-->
<!--PUBLISHER=SYBEX//-->
<!--CHAPTER=18//-->
<!--PAGES=556-559//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="552-554.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="559-561.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h4 align="LEFT"><a name="Heading14"></A><font color="#000077">Windows 2000&#146;s Compromise</FONT></H4>
<p>A pure microkernel model, then, would be tremendously inefficient because of the massive number of context shifts it requires. So Windows 2000 settles on a kind of modified microkernel structure, as you see in Figure 18.4.
</P>
<p><a name="Fig4"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/0782124488/ch18/images/18-04.jpg',500,486)"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/0782124488/ch18/images/18-04t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/0782124488/ch18/images/18-04.jpg',500,486)"><font color="#000077"><b>Figure 18.4</B></FONT></A>&nbsp;&nbsp;Windows 2000&#146;s modified client-server structure (simplified)</P>
<p>Now, whenever we see a figure like this, our eyes tend to glaze over; lest <i>yours</I> do the same, let&#146;s break it down. You need to understand this diagram if you want to stay with this chapter. Also, we couldn&#146;t fit an important flow of information on the figure, so read on to see what&#146;s <i>not</I> in this picture.</P>
<p>The Hardware box represents only the hardware on which you&#146;re running Windows 2000. You&#146;ve already met the HAL and the Kernel. Although this picture shows the Kernel as sitting atop the HAL, that representation is not 100 percent accurate. Some small parts of the Kernel interact directly with the hardware rather than through the HAL.</P>
<p>The I/O Manager is vitally important because:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;It contains all the device drivers that keep the hardware working.
<dd><b>&#149;</B>&nbsp;&nbsp;It contains most of the networking part of Windows 2000.
<dd><b>&#149;</B>&nbsp;&nbsp;It contains the file systems&#151;FAT, FAT32, and NTFS.
</DL>
<p><i>Windows 2000 Executive Services</I> (which were first mentioned way back in Chapter 1, &#147;Introducing Windows 2000 Professional,&#148; and Chapter 2, &#147;Running Your Applications&#148;) is just a catch-all phrase for a few modules that are important to Windows 2000 and that live in Kernel mode. They are also called Windows 2000 Executive functions. We&#146;ll get to all of them a bit later.</P>
<p>In User mode, you see the OS/2, POSIX, DOS/Windows 3.1, and client-server (Win32) subsystems (usually abbreviated CSRSS) of Windows 2000. Although they&#146;re an important part of the operating system, they live out in User mode&#151;and for a very good reason.</P>
<p>Operating system designers have always struggled with the dilemma that we described a bit earlier. They want to segregate the operating system from the applications, because the applications can&#146;t be trusted. But allowing the applications to be more closely knit to the underlying operating system makes for smaller applications and faster operating systems. Running OS/2 or Windows 3.1 applications, then, <i>requires</I> that Windows 2000 allow these applications to peek and poke into the OS/2 and Windows 3.1 subsystems. That kind of intimacy is necessary for Windows 2000 to fool those applications into thinking that they are running on their native operating systems rather than on simple Windows 2000 subsystems that are mimicking the native systems.</P>
<p>In fact, any program running on a Windows 2000 machine ends up using the native Windows 2000 programming interface; the environment subsystems resemble translators that convert an OS/2, DOS, Windows 3.1, or POSIX operating system request to an equivalent Windows 2000 request and then pass that request to Windows 2000. The front end for requests to Windows 2000 is the CSRSS. The word for the native Windows 2000 programming interface, by the way, is <i>Win32</I>&#151;something we&#146;ll have more to say about a bit later.</P>
<p>But first, let&#146;s clear up something <i>very important</I> that underscores yet again the cost of using even a hybrid client-server approach as Windows 2000 does. Look at the lines running between the subsystems, the CSRSS, and the Windows 2000 Executive. They&#146;re not actually correct because we&#146;ve depicted each environment subsystem communicating directly with CSRSS&#151;do you remember why? Take a look at Figure 18.5, and you&#146;ll see what we&#146;re talking about.</P>
<p><a name="Fig5"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/0782124488/ch18/images/18-05.jpg',500,286)"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/0782124488/ch18/images/18-05t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/0782124488/ch18/images/18-05.jpg',500,286)"><font color="#000077"><b>Figure 18.5</B></FONT></A>&nbsp;&nbsp;A more accurate view of subsystem communication in Windows 2000&#146;s modified client-server structure</P>
<p>Figure 18.5 illustrates how just one User mode subsystem, the DOS/Windows 3.1 subsystem, communicates with another User mode subsystem, the CSRSS. Figure 18.4 shows a double-sided arrow between the DOS/Windows 3.1 subsystem and the CSRSS. But two User modules can&#146;t directly communicate&#151;<i>pass messages</I> is the more accepted Windows 2000 term&#151;under Windows 2000. Instead, the DOS/Windows 3.1 subsystem must pass a message to the Windows 2000 Executive, which lives in Kernel mode, which then passes the message to CSRSS.</P>
<p>Similarly, CSRSS can respond only to a request from the DOS/ Windows 3.1 subsystem by first sending a message to the Windows 2000 Executive, which then forwards the note to the DOS/Windows 3.1 subsystem. Here you see that we&#146;re &#146;fessing up for having oversimplified things a bit. Go back to Figure 18.4 and visualize all of the User mode communications that are represented as double-headed arrows as really being four single-headed arrows. We didn&#146;t want that oversimplification to cause you to miss exactly <i>how</I> expensive the client-server model is in terms of User/Kernel shifts.</P>
<blockquote>
<p><font size="-1"><hr><b>NOTE:&nbsp;&nbsp;</B>The part of the Windows 2000 Executive that handles all this message passing is the Local Procedure Call (LPC) facility.<hr></FONT>
</BLOCKQUOTE>
<h4 align="LEFT"><a name="Heading15"></A><font color="#000077">Is the Microkernel a Bad Compromise?</FONT></H4>
<p>The whole idea of a microkernel or client-server operating system is that it is a stable approach, which puts drivers and subsystems all at arm&#146;s length, so to speak&#151;out in User mode (ring 3 on Intel systems). And if they crash, they crash only themselves.
</P>
<p>Well, yes, that of course sounds good, but to a certain extent, it&#146;s a moot point. If the keyboard driver is in User mode and it crashes, then certainly it has crashed only itself and the Kernel continues to run. But what can you do with an operating system without a functioning keyboard?</P>
<p>On yet another hand, some of the things that you want to do might be possible even without a working keyboard. On a Windows 2000 Server machine, your server processes would continue to run as long as they didn&#146;t need keyboard input. You could then <i>choose</I> when to take down the server and bring it back up, rather than potentially have the entire system crash on the errant driver&#146;s schedule.</P>
<blockquote>
<p><font size="-1"><hr><b>TIP:&nbsp;&nbsp;</B>The best approach for stability is probably to keep applications in User mode and put the operating system in Kernel mode&#151;but to debug the operating system extremely well.<hr></FONT>
</BLOCKQUOTE>
<p><br></P>
<center>
<table border>
<tr>
<td><a href="552-554.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="559-561.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>