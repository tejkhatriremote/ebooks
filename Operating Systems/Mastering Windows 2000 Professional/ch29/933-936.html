<html>
<head>
<meta name=vsisbn content="0782124488">
<meta name=vstitle content="Mastering Windows 2000 Professional">
<meta name=vsauthor content="Mark Minasi, Todd Phillips">
<meta name=vspublisher content="Sybex, Inc.">
<meta name=vspubdate content="01/01/00">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Mastering Windows 2000 Professional:Fixing Windows 2000 Professional When It Breaks</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

<script language="JavaScript1.2">
<!--
function checkForQuery(fm) {
  /* get the query value */
  var i = escape(fm.query.value);
  if (i == "") {
      alert('Please enter a search word or phrase');
      return false;
  }                  /* query is blank, dont run the .jsp file */
  else return true;  /* execute the .jsp file */
}
//--></script>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/0782124488.gif" width=60 height=73 alt="Mastering Windows 2000 Professional" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Mastering Windows 2000 Professional</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by Mark Minasi, Todd Phillips</i>
    <br>
    Sybex, Inc.
    <br>
    <b>ISBN:</b>&nbsp;0782124488<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;01/01/00</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=0782124488//-->
<!--TITLE=Mastering Windows 2000 Professional//-->
<!--AUTHOR=Mark Minasi//-->
<!--AUTHOR=Todd Phillips//-->
<!--PUBLISHER=SYBEX//-->
<!--CHAPTER=29//-->
<!--PAGES=933-936//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="930-933.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="936-940.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h4 align="LEFT"><a name="Heading26"></A><font color="#000077">Setting Up the Symbol Tree on the Host Computer</FONT></H4>
<p>The symbol tree that you set up on the host computer must match the version of Windows 2000 that is running on the target computer. The Windows 2000 Professional Support Tools CD already has symbol trees created on it for each platform. They are in <tt>Support\Debug\i386\Symbols</TT>.</P>
<p>To construct a symbol tree, you need to do the following:</P>
<dl>
<dd><b>1.</B>&nbsp;&nbsp;Copy the proper tree from the Support directory on the CD to the hard drive on the host computer.
<dd><b>2.</B>&nbsp;&nbsp;If you are debugging a multiprocessor, you&#146;ll need to rename <tt>ntkrnlmp.dbg</TT> to <tt>ntoskrnl.dbg</TT>. These files are in the Exe subdirectory of the symbol tree.
</DL>
<p>At this point, your symbol tree should be all set up unless you are debugging a multiprocessor or the target computer uses a special HAL. In either of these cases, you&#146;ll need to rename some of the symbol files.
</P>
<p>If you&#146;re debugging a multiprocessor, you&#146;ll have to rename <tt>ntkrnlmp.dbg</TT> (in the Exe subdirectory of the symbol tree) to <tt>ntoskrnl.dbg</TT>.</P>
<p>However, if your computer uses a special HAL, there&#146;s a wider range of files to choose from. Table 29.3 shows the HAL files for each platform. Determine which HAL the target computer uses and rename the corresponding <tt>.dbg</TT> file (in the Dll subdirectory of the symbol tree) to <tt>hal.dbg</TT> (located in <tt>\Systemroot\System32</TT>).</P>
<table width="100%"><caption align=LEFT><b>Table 29.3</B> The HAL Files by Platform
<th colspan="2" align="LEFT">Files for I386-Based Computers
<tr>
<th width="30%" align="LEFT">Filename
<th width="70%" align="LEFT">Type of System
<tr>
<td colspan="2"><hr>
<tr>
<td><tt>hal.dbg</TT>
<td>Standard HAL for Intel Systems
<tr>
<td><tt>hal486c.dbg</TT>
<td>486 c Step processor
<tr>
<td><tt>halapic.dbg</TT>
<td>Uniprocessor version of <tt>halmps.dbg</TT>
<tr>
<td><tt>halast.dbg</TT>
<td>AST SMP systems
<tr>
<td><tt>halcbus.dbg</TT>
<td>Cbus systems
<tr>
<td><tt>halmca.dbg</TT>
<td>MCA-based systems (PS/2 and others)
<tr>
<td><tt>halmps.dbg</TT>
<td>Most Intel multiprocessor systems
<tr>
<td><tt>halncr.dbg</TT>
<td>NCR SMP computers
<tr>
<td><tt>haloli.dbg</TT>
<td>Olivetti SMP computers
<tr>
<td><tt>halsp.dbg</TT>
<td>Compaq Systempro
<tr>
<td><tt>halwyse7.dbg</TT>
<td>Wyse7 systems
<tr>
<td colspan="2"><hr>
</TABLE>
<p>Some of you may have a HAL file that was supplied by your computer&#146;s manufacturer. In that case, you&#146;ll need to get the symbols from the manufacturer, rename the symbol file to <tt>hal.dbg</TT>, and place it in the <tt>dll</TT> subdirectory of the symbol tree.</P>
<h4 align="LEFT"><a name="Heading27"></A><font color="#000077">Setting Up the Debugger on the Host Computer</FONT></H4>
<p>To set up the debugger on the host, you&#146;ll first need to copy some files from the <tt>Support\Debug\<i>Platform</I></TT> directory to a debug directory on the hard drive, where <i>Platform</I> is the platform of the host computer: I386 or Alpha.</P>
<p>Some files that you copy must match the platform of the target computer:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<tt>i386kd.exe</TT>
<dd><b>&#149;</B>&nbsp;&nbsp;<tt>imagehlp.dll</TT>
<dd><b>&#149;</B>&nbsp;&nbsp;<tt>kdextx86.dll</TT>
</DL>
<h4 align="LEFT"><a name="Heading28"></A><font color="#000077">Starting the Debugger</FONT></H4>
<p>After you construct the symbol tree and copy the symbol files to it, you need to create a batch file to set the environment variables listed in Table 29.4 on the host computer.
</P>
<table width="100%"><caption align=LEFT><b>Table 29.4</B> Environment Variables for the Host Computer
<tr>
<th width="30%" align="LEFT">Variable
<th width="70%" align="LEFT">Description
<tr>
<td colspan="2"><hr>
<tr>
<td>_nt_debug_port
<td>COM port used on the host computer for debugging.
<tr>
<td valign="TOP">_nt_debug_baud_rate
<td>Maximum baud rate for the debug port. This number is either 9600 or 19,200 if you&#146;re using a modem. If you&#146;re using a null-modem cable or a RISC-based computer, the baud rate should be set to 19,200.
<tr>
<td>_nt_symbol_path
<td>The path containing the symbol files.
<tr>
<td valign="TOP">_nt_log_file_open
<td>Creates a log file for the debug session (optional). The log file creates a copy of everything (input and output) that happens during the debugging session.
<tr>
<td colspan="2"><hr>
</TABLE>
<p>A sample batch file for local debugging might look similar to the following:
</P>
<!-- CODE SNIP //-->
<pre>
   set _NT_DEBUG_PORT=com1
   set _NT_DEBUG_BAUD_RATE=19200
   set _NT_SYMBOL_PATH=c:\support\debug\i386\symbols
   set _NT_LOG_FILE_OPEN=c:\temp\debug.log
   i386kd -v debug
</PRE>
<!-- END CODE SNIP //-->
<p>We haven&#146;t discussed the last line yet. It is the command to run the debugger program. This line of the batch file (or any other, for that matter) can be run from the command line as well. The parameters for the debugger are as follows:
</P>
<dl>
<dd><b>-b</B>&nbsp;&nbsp;Causes the debugger to stop running on the target computer by creating a debug breakpoint (INT 3).
<dd><b>-c</B>&nbsp;&nbsp;Forces the computer to resynchronize upon connecting to the target computer. This guarantees that the target and host computers are communicating properly.
<dd><b>-m</B>&nbsp;&nbsp;Causes the debugger to monitor control lines, if you&#146;re using a modem. The debugger is active only when the carrier-detect line is active. If the line isn&#146;t active, all commands are sent to the modem.
<dd><b>-n</B>&nbsp;&nbsp;Loads symbols immediately instead of in a delayed mode.
<dd><b>-v</B>&nbsp;&nbsp;Indicates verbose mode. Displays more information than normal mode.
<dd><b>-x</B>&nbsp;&nbsp;Induces the debugger to break in when an error occurs.
</DL>
<p>Usually, the easiest way to start the debugger is to set up a batch file, using the proper variables followed by the command to run the debugger. In this way, you won&#146;t have to remember which variables to set and which debugger program to use.
</P>
<p>In a local debugging session, you will see something similar to the following:</P>
<!-- CODE SNIP //-->
<pre>
   Microsoft(R) Windows NT Kernel Debugger
   Version 5.0
   (C) 1991-1995 Microsoft Corp.
   Symbol search path is:
   KD: waiting to connect...
</PRE>
<!-- END CODE SNIP //-->
<p>At this point, the debugger waits for you to press Ctrl&#43;C to connect to the target computer. If this doesn&#146;t work, try pressing Ctrl&#43;R to resynchronize the communication between the host and the target computers.
</P>
<p>If you&#146;re debugging the target computer remotely, the same screen will appear, with this added line:</P>
<!-- CODE SNIP //-->
<pre>
   KD: No carrier detect - in terminal mode
</PRE>
<!-- END CODE SNIP //-->
<p>When this happens, you can send any of the AT commands to your modem. Issue commands to disable hardware compression, error detection, and flow control. You&#146;ll need to consult your modem&#146;s documentation because these commands vary from modem to modem. After you get a carrier-detect signal, you&#146;ll be able to use the debugger.
</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="930-933.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="936-940.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>