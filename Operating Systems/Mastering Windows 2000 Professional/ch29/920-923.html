<html>
<head>
<meta name=vsisbn content="0782124488">
<meta name=vstitle content="Mastering Windows 2000 Professional">
<meta name=vsauthor content="Mark Minasi, Todd Phillips">
<meta name=vspublisher content="Sybex, Inc.">
<meta name=vspubdate content="01/01/00">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Mastering Windows 2000 Professional:Fixing Windows 2000 Professional When It Breaks</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

<script language="JavaScript1.2">
<!--
function checkForQuery(fm) {
  /* get the query value */
  var i = escape(fm.query.value);
  if (i == "") {
      alert('Please enter a search word or phrase');
      return false;
  }                  /* query is blank, dont run the .jsp file */
  else return true;  /* execute the .jsp file */
}
//--></script>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/0782124488.gif" width=60 height=73 alt="Mastering Windows 2000 Professional" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Mastering Windows 2000 Professional</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by Mark Minasi, Todd Phillips</i>
    <br>
    Sybex, Inc.
    <br>
    <b>ISBN:</b>&nbsp;0782124488<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;01/01/00</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=0782124488//-->
<!--TITLE=Mastering Windows 2000 Professional//-->
<!--AUTHOR=Mark Minasi//-->
<!--AUTHOR=Todd Phillips//-->
<!--PUBLISHER=SYBEX//-->
<!--CHAPTER=29//-->
<!--PAGES=920-923//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="917-920.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="923-925.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<p><font size="+1"><b>Restoring a Registry</B></FONT></P>
<p>If you backed up the Registry with <tt>ntbackup</TT>, you restore it by starting Windows 2000 Setup and choosing Repair rather than Install Windows 2000. If you backed up the Registry with <tt>regback</TT>, use <tt>regrest</TT> to restore it.</P>
<p>If your Registry backup is on a backup set, you must restore it from the <tt>ntbackup</TT> program. To restore it from the GUI, click the System State check box.</P>
<p>You cannot restore a disk registry to any disk except the one from which you backed it up. In other words, you can&#146;t apply the disk registry from drive C to drive E. This restriction prevents your sneaking around Windows 2000&#146;s security system.</P>
<h3><a name="Heading15"></A><font color="#000077">Diagnosing a Boot Failure</FONT></H3>
<p>Last Known Good restores are of no value if you can&#146;t get to the &#147;Press a key now to restore Last Known Good...&#148; message. In this section, we explain the steps that the PC goes through to boot and tell you what outward signs those steps display so that you can figure out what is wrong when your PC won&#146;t boot.
</P>
<h4 align="LEFT"><a name="Heading16"></A><font color="#000077">Before the Boot: The Hardware Must Work</FONT></H4>
<p>Before anything else can happen, your PC must be free of hardware problems. You may not be able to boot if
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;Your boot drive or boot drive&#146;s controller is malfunctioning or is not set up correctly.
<dd><b>&#149;</B>&nbsp;&nbsp;You&#146;ve got an interrupt conflict.
<dd><b>&#149;</B>&nbsp;&nbsp;The CPU or some other vital circuitry is failing.
</DL>
<p>Too often, the fan on the PC&#146;s power supply has stopped working. The result is that the temperature inside your PC can rise to over 130&#176;F (55&#176;C), slowly roasting its components.
</P>
<p>A company in Bonsall, California, by the name of PC Power and Cooling Systems, makes a temperature sensor that fits inside a PC&#146;s case and squawks when the PC&#146;s internal temperature rises above 100&#176;F. It&#146;s not inexpensive (it cost $100 the last time we looked), but it&#146;s cheaper than replacing the PC.</P>
<p>Another problem that we&#146;ve run into that can prevent a machine from booting is an EISA misconfiguration. EISA allows for software configuration of machines, which is a real dream for those of us who&#146;ve spent too much of our lives flipping DIP switches and wrestling jumpers out of hard-to-get-to spaces. But the EISA setup routines on some machines have a quirk: If they don&#146;t understand <i>something</I>, they respond by knowing <i>nothing</I>. PCI machines, in contrast, don&#146;t have this problem.</P>
<p>To illustrate, suppose that you&#146;ve got an EISA disk controller in your PC. You shut down the PC and replace your old ISA LAN board with an EISA LAN board. You put the cover on your system and try to boot, only to get the message &#147;EISA CMOS failure&#148; and a stopped computer. What happened was this: The system knew to expect the EISA disk controller but it <i>didn&#146;t</I> know to expect the EISA LAN board. To play it safe, the computer refused to use the EISA disk controller. Result: You can&#146;t boot your system from the hard disk. The system will continue to do this until you run the EISA configuration program.</P>
<p>To make matters worse, most floppy disk controllers are on the hard disk controller card, making it impossible to boot from the floppy. If you can&#146;t run the EISA configuration program from either the hard disk <i>or</I> the floppy disk, what can you do?</P>
<p>The best bet in this case is to run the EISA configuration program <i>before</I> you install the board. Load the EISA configuration file for the new board and configure the board even before it&#146;s in your system. The configuration program will complain a bit about the board not being <i>in</I> the system, but it&#146;ll all work in the end. Then shut down the computer and install the new board.</P>
<h4 align="LEFT"><a name="Heading17"></A><font color="#000077">Step One: <i>ntldr</I>
</FONT></H4>
<p>The first thing that your Windows 2000 PC loads is the file <tt>ntldr</TT>, a small program in the root directory. The <tt>ntldr</TT> program announces itself by clearing the screen and displaying:</P>
<!-- CODE SNIP //-->
<pre>
   OS Loader V4.00
</PRE>
<!-- END CODE SNIP //-->
<p>The <tt>ntldr</TT> program looks for these files:</P>
<dl>
<dd><b><tt>boot.ini</TT></B>&nbsp;&nbsp;A text file that tells the Windows 2000 multiboot loader which operating systems are available.
<dd><b><tt>ntdetect.com</TT></B>&nbsp;&nbsp;A program that detects the hardware on your Windows 2000 system.
<dd><b><tt>bootsect.dos</TT></B>&nbsp;&nbsp;This file is present on your root directory if you dual boot with DOS.
<dd><b><tt>ntbootdd.sys</TT></B>&nbsp;&nbsp;This file is present if you boot from a SCSI drive without an active BIOS. It&#146;s a kind of micro-SCSI driver.
</DL>
<p>At this point, we&#146;ve seen messages such as &#147;Unable to open <tt>ntdetect.com</TT>,&#148; followed by an error code. This means that something has damaged data in your root directory, making it impossible for <tt>ntdetect.com</TT> to load. The answer in this case is to use the Windows 2000 Emergency Repair Disk; it can reconstruct most root structures.</P>
<p>The <tt>ntldr</TT> program then does the following:</P>
<dl>
<dd><b>1.</B>&nbsp;&nbsp;Shifts your processor to 386 mode (iapx86 systems)
<dd><b>2.</B>&nbsp;&nbsp;Starts the very simple file system based either on a standard disk interface (known as INT13 for non-SCSI systems) or uses <tt>ntbootdd.sys</TT> to boot from the SCSI drive
<dd><b>3.</B>&nbsp;&nbsp;Reads <tt>boot.ini</TT> to find out if there are other operating systems to offer and then shows those options on the screen
<dd><b>4.</B>&nbsp;&nbsp;Accepts the user&#146;s decision on which operating system to load
</DL>
<p>Assuming then that you selected Windows 2000, <tt>ntdetect</TT> runs.</P>
<h4 align="LEFT"><a name="Heading18"></A><font color="#000077">Step Two: <i>ntdetect</I>
</FONT></H4>
<p>Next, <tt>ntdetect.com</TT> runs to figure out what kind of hardware you&#146;ve got. This file runs silently in Windows 2000, so you have to trust that it will run correctly and do its part in finding all of your hardware.</P>
<p>The <tt>ntdetect</TT> program finds the following:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;Your PC&#146;s machine ID byte
<dd><b>&#149;</B>&nbsp;&nbsp;Its bus type
<dd><b>&#149;</B>&nbsp;&nbsp;Its video board
<dd><b>&#149;</B>&nbsp;&nbsp;Its keyboard type
<dd><b>&#149;</B>&nbsp;&nbsp;The serial ports attached to your computer
<dd><b>&#149;</B>&nbsp;&nbsp;Any parallel ports on the PC
<dd><b>&#149;</B>&nbsp;&nbsp;Floppy drives on the computer
<dd><b>&#149;</B>&nbsp;&nbsp;A mouse, if present
</DL>
<p><br></P>
<center>
<table border>
<tr>
<td><a href="917-920.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="923-925.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>