<html>
<head>
<meta name=vsisbn content="0782124488">
<meta name=vstitle content="Mastering Windows 2000 Professional">
<meta name=vsauthor content="Mark Minasi, Todd Phillips">
<meta name=vspublisher content="Sybex, Inc.">
<meta name=vspubdate content="01/01/00">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Mastering Windows 2000 Professional:Running Windows 3.x and DOS Programs</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

<script language="JavaScript1.2">
<!--
function checkForQuery(fm) {
  /* get the query value */
  var i = escape(fm.query.value);
  if (i == "") {
      alert('Please enter a search word or phrase');
      return false;
  }                  /* query is blank, dont run the .jsp file */
  else return true;  /* execute the .jsp file */
}
//--></script>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/0782124488.gif" width=60 height=73 alt="Mastering Windows 2000 Professional" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Mastering Windows 2000 Professional</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by Mark Minasi, Todd Phillips</i>
    <br>
    Sybex, Inc.
    <br>
    <b>ISBN:</b>&nbsp;0782124488<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;01/01/00</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=0782124488//-->
<!--TITLE=Mastering Windows 2000 Professional//-->
<!--AUTHOR=Mark Minasi//-->
<!--AUTHOR=Todd Phillips//-->
<!--PUBLISHER=SYBEX//-->
<!--CHAPTER=28//-->
<!--PAGES=899-901//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="896-899.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="901-903.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h4 align="LEFT"><a name="Heading15"></A><font color="#000077">Running DOS Programs and 32-Bit Device Drivers</FONT></H4>
<p>Windows 2000 Professional is composed of 32-bit (read: faster) code. Part of that code includes its device drivers, which control how applications access the PC&#146;s hardware by way of the operating system. Because Windows 2000 is its own operating system, independent of DOS, it doesn&#146;t have to switch back to real mode to access hardware devices&#151;a Good Thing. An even better thing is that your DOS sessions within Windows 2000 can use these 32-bit drivers as well because they&#146;re not running DOS as such, but emulating DOS.
</P>
<p>If, however, you run a DOS program in exclusive MS-DOS mode (by loading the DOSONLY statement in the <tt>config.sys</TT> Windows 2000 file), the application can&#146;t use any of the Windows 2000 32-bit protected-mode drivers. Therefore, you cannot run this hardware in Windows 2000. Windows 2000 <i>must</I> have Windows 2000 drivers in order to access any hardware devices.</P>
<h4 align="LEFT"><a name="Heading16"></A><font color="#000077">Using Expanded Memory</FONT></H4>
<p>Expanded memory is a classic example of how something originally intended to be a short-term solution can outlast its supposed life span. The reason is that after Lotus Development Corporation had captured a lot of the spreadsheet market with 1-2-3 version 1A, it released version 2 with much fanfare. Unfortunately, version 2 had a teensy problem: It used more conventional memory (the bottom 640K in your machine) than version 1A did. Any spreadsheets written under version 1A that used up all available conventional memory&#151;and there were plenty&#151;would not run under version 2. So Lotus, in conjunction with Intel and Microsoft, designed a kind of work-around memory that would permit the spreadsheets to load even without sufficient conventional memory. That solution, which still haunts us today in a few programs, is called <i>expanded memory</I>.</P>
<p>That&#146;s where expanded memory came from, but what is it? In a nutshell, it&#146;s non-conventional memory (either add-in boards, or in 386s and later, extended memory) that an expanded memory manager divides into pages for the application to use like conventional memory. Early expanded memory required add-in expanded memory boards, but today programs that require expanded memory can use the extended memory (memory above the first 1024K) that&#146;s on your motherboard.</P>
<p>Windows 2000 Professional will automatically supply extended memory to DOS programs that can use it. If you edit the expanded memory EMM386 statement, do <i>not</I> use the NOEMS parameter. It will prevent Windows 2000 from providing the memory. If you exclude any memory from potential expanded memory, use the <tt>x=mmmm-nnnn</TT> syntax to do so.</P>
<h4 align="LEFT"><a name="Heading17"></A><font color="#000077">Using DPMI in Windows 2000 Professional</FONT></H4>
<p>Extended memory, as you probably know, is memory above the top 1024K. Under normal circumstances, DOS apps can&#146;t use extended memory&#151;they require some special software called a <i>DOS extender</I> to boost them up to where they can see and access memory above 1024K.</P>
<p>Windows 2000 contains a DOS extender that enables DOS programs to use memory beyond 1024K, so long as they don&#146;t know that they&#146;re doing it. Windows 2000 maps conventional memory to one megabyte of extended memory and then tells the DOS session, &#147;Look! I found you this lovely computer memory that you can have for your <i>very own</I>.&#148; DOS takes the bait and accepts the extended memory as conventional memory. Any time that the application tries to access memory, it looks for an address in conventional memory, but Windows 2000 intercepts the memory access and forwards it to the address in the extended memory that has been allotted to the DOS application. A nice system, because it enables DOS programs to run with what they think is conventional memory, when in reality the conventional memory is shared among a number of &#147;virtual machines&#148;&#151;a block of extended memory used to simulate a separate machine.</P>
<p>Some DOS programs have their own DOS extenders built into them. If you need to make them work with Windows 2000, you&#146;ll find that some do&#133; but some don&#146;t. Is there some kind of overall rule?</P>
<p>Back in the days when OS/2 was still under development and Windows was just a curiosity that no one used for anything serious, a number of companies started writing DOS programs that could access extended memory on 286 and later computers. Accessing extended memory requires installing a supervisor program&#151;a program that makes sure that no program treads upon another program&#146;s territory. OS/2, Windows, and Windows NT are all examples of supervisor programs. These DOS programs didn&#146;t want to multitask, however&#151;they only wanted to support themselves and no other program in extended memory&#151;so they didn&#146;t need a very big supervisor program. Examples of early programs that used extended memory are Oracle, Informix, <tt>VDISK.SYS</TT> (the &#147;RAM disk&#148; program that came with DOS 3 and later versions of DOS up to DOS 5), and the <tt>IBMCACHE.SYS</TT> disk cache program that IBM shipped with the PS/2s. These simple supervisors were called <i>DOS extenders</I>.</P>
<p>All went well until someone tried to run a DOS extender program in a computer at the same time as another supervisor was running&#151;for example, running a DOS extender program in a DOS box under Windows 3. That led to Windows and the DOS extender fighting over who got to be the supervisor, because only one supervisor program is supposed to be active in a PC at a time. The two supervisors slugged it out, and the PC lost. To make matters worse, memory managers must <i>all</I> be supervisors, so the simple act of running, say, the 1988 vintage of Oracle (a database) on a system that uses 386 to the Max (a memory manager) would result in a lockup.</P>
<p>Consequently, the makers of DOS extender products got together and developed a method whereby DOS extenders could peacefully coexist. The virtual control program interface, or VCPI to acronym lovers, provided an agreement whereby two or more DOS extenders could coexist by defining an agreed-upon method of organizing memory. One DOS extender would make a note about how it had memory organized, save that note somewhere, and then hand control over to the second DOS extender, which would then reorganize memory the way it wanted. When it was time for DOS Extender 2 to hand control back to DOS Extender 1, it did so by restoring things the way it found them and then passing the baton back to DOS Extender 1.</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="896-899.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="901-903.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>