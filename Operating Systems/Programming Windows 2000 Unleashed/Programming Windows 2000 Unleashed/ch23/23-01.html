<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Using COM[TITLE]#43; with the IIS</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=23//-->
<!--PAGES=765-769//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="../ch22/22-10.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="23-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h2><a name="Heading1"></A><font color="#000077">Chapter 23<br>Using COM&#43; with the IIS
</FONT></H2>
<p><big><b>In This Chapter</B></BIG></P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Basis of a Web Application <i>766</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Building a Web Application <i>774</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Implementing the Theory <i>778</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Component Development <i>809</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Transacted ASP Pages <i>817</I></B>
</DL>
<p>In this chapter, the topic of building Web applications using the Microsoft Internet Information Server (IIS 5.0) is explored. The chapter starts out with an explanation of what Active Server Pages (ASP) are. The key concepts are explained and demonstrated. Shown throughout are techniques on how to build practical ASP applications. Finally, the discussion moves into how to integrate COM&#43; objects with ASP.
</P>
<h3><a name="Heading2"></A><font color="#000077">Basis of a Web Application</FONT></H3>
<p>The first step in understanding how to write a Web application is to understand the elements we have in our arsenal. Note that in this chapter, all the techniques are cross-browser capable. This means no ActiveX COM controls are used on the client side. When developing a Web application using the Microsoft server-side technologies, you use the following items:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>A database</I>. For some read-only operations, it&#146;s simpler to access the database directly.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Components</I>. Most of the business logic is encapsulated within components.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Scripting</I>. Server-side and client-side scripting are available in languages such as JScript; it&#146;s also possible to use other languages such as VBScript, PerlScript, PythonScript, RexxScript, and so on.
</DL>
<p>In a traditional Web architecture, the client requests a Web page such as something.htm or something.html. This file is a static file that the Web server sends to the client. It is a sort of cross-platform file server using the HTTP protocol to send the data to the client.
</P>
<p>ASP is different from a traditional Web application architecture. In ASP the server is instructed within the ASP page to execute some commands and send the results of those commands as a stream to the client. The stream can generate either HTML 4.0 or it can be Dynamic HTML. In advanced situations, the ASP can even generate XML data. In all these situations, the key element is that the data is sent as a sequential stream to the client. I point out that this is a sequential stream because when data has been sent, it cannot be called back.</P>
<p>In detail, an ASP file is similar to an HTML page, but it contains extra commands. These commands are in the form of scripting elements. The script can contain loops, decision statements, and reference COM objects that do something to generate more data for the stream. The script or the COM objects can access a database or some external device that is generating data.</P>
<h4 align="LEFT"><a name="Heading3"></A><font color="#000077">An Overview of ASP</FONT></H4>
<p>The overall steps are detailed in the following list and illustrated in Figure 23.1:
</P>
<p><a name="Fig1"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch23/images/23-01.jpg',229,131 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch23/images/23-01t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch23/images/23-01.jpg',229,131)"><font color="#000077"><b>Figure 23.1</B></FONT></A>&nbsp;&nbsp;ASP architecture.</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Step 1</I>. The browser makes a request to the server (for example, <a href="http://server/something/default.asp">http://server/something/default.asp</A>).
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Step 2</I>. The request is converted to an ASP request. The ASP page is loaded into the processor and then parsed. The parsing starts at the top of the page and continues until the bottom of the page is reached. At the start of this process, a stream is opened by default. The stream is a return buffer. This is defined in step 3.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Step 2a</I>. During the request processing, references can be made to the ASP built-in objects. These objects contain information about the client, the server, and the request. The built-in objects are <small>Application</SMALL>, <small>ASPError</SMALL>, <small>ObjectContext</SMALL>, <small>Request</SMALL>, <small>Response</SMALL>, <small>Server</SMALL>, and <small>Session</SMALL>.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Step 2b</I>. During the request processing, objects can be referenced that are COM&#43; applications. These objects usually perform some business processes. Typically, these are custom objects.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Step 3</I>. Whatever stream content has been generated by the script processing is sent to the client. By default, when and in what order the content is to be sent to the client are not defined. You can specify this using the <small>Response</SMALL> built-in object.
</DL>
<p>Remember that ASP works using the stream concept. For example, when a stream has a byte written, you cannot revoke that byte. Also, the information in the stream must be sent in a specific order. It was mentioned previously that the stream is sent using the HTTP protocol. This means that to influence how the HTTP protocol sends the stream, the HTTP methods need to be called before the stream is actually sent. If you attempt to change the HTTP stream characteristics in midstream, you will generate an ASP error.
</P>
<h4 align="LEFT"><a name="Heading4"></A><font color="#000077">A Quick Script Example</FONT></H4>
<p>A script on the ASP page can be defined in several ways. You can use server-side scripts and client-side scripts. Server-side execution happens on the side of the HTTP server, whereas client-side execution happens in the Web browser. Consider the following ASP script:
</P>
<!-- CODE //-->
<pre>
&lt%
var obj;
obj = 1 &#43; 1;
%&gt
&ltscript language=&#148;jscript&#148;&gt
function clientFunc() {
var obj;
obj= 1 &#43; 1;
}
&lt/script&gt
&ltscript language=&#148;jscript&#148; runat=server&gt
function serverFunc() {
var obj;
obj= 1 &#43; 1;
}
&lt/script&gt
</PRE>
<!-- END CODE //-->
<p>This script has three sections. The first block of code is a server-side script. The characters <small>&lt%</SMALL> and <small>%&gt</SMALL> begin and end this block. Note that you cannot use these tags for client-side scripting. The second block, which appears between the <small>&ltscript&gt</SMALL> and <small>&lt/script&gt</SMALL> tags, is a client-side scripting block, because there&#146;s no <small>runat</SMALL> attribute within the first <small>&ltscript&gt</SMALL> tag. The second <small>&ltscript&gt</SMALL> tag contains a server-side script, because it does contain a <small>runat=server</SMALL> attribute.</P>
<h4 align="LEFT"><a name="Heading5"></A><font color="#000077">ASP Applications</FONT></H4>
<p>ASP applications are not like traditional compiled applications. In a traditional application, a series of sources is written using a language such as C<small>&#43;&#43;</SMALL>. Then a compiler translates these files into object code and the various object code pieces are linked into an executable.</P>
<p>The Web is different because everything is dynamic and processed at the time of request. For example, consider the following URL:</P>
<a href="http://www.myurl.com/directory/default.asp">http://www.myurl.com/directory/default.asp</A>
<p>The <small>http</SMALL> specifies the HTTP protocol. The server is specified by the <a href="www.myurl.com">www.myurl.com</A>. The <small>/directory</SMALL> specifies the virtual directory. And the file is <small>default.asp</SMALL>. In Web server terms, the virtual directory is mapped to a directory on the hard disk. In ASP terms, the virtual directory is still mapped to the hard disk. Additionally, the virtual directory represents an ASP application. All ASP files retrieved from this virtual directory will share the same Session and Application variables. The concepts of Session and Application will be discussed later, but in short they are used to store state.</P>
<p>State and scope form a core functionality of ASP. State can be used to define a series of active objects, variables, or tasks. However, state is dependent on the scope at which the state was declared. The following scopes can be defined:</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="../ch22/22-10.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="23-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>