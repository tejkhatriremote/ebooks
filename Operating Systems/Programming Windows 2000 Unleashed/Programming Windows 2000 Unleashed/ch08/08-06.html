<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Windows 2000 Debugging</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=08//-->
<!--PAGES=278-281//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="08-05.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="08-07.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<p>In order to get the maximum benefit from a Dr. Watson trace, you must first install the Windows 2000 debug symbol tree. Otherwise, it can be difficult to interpret call stack information.
</P>
<p>The CD-ROM that accompanies the book includes a console mode project named Crash1, which contains functions such as the one provided in Listing 8.1.</P>
<p><b>Listing 8.1</B> One of the Bad Functions from the Crash1 Project<hr></P>
<!-- CODE SNIP //-->
<pre>
int BadFunc1()
{
    int *p = 0;
    *p = 42;
    p[45] = 42;
    return 0;

}
</PRE>
<!-- END CODE SNIP //-->
<hr>
<p>When the <small>BadFunc1</SMALL> function in Listing 8.1 is called, a <small>NULL</SMALL> pointer is referenced, thus causing an access violation.</P>
<p>Dr. Watson can be configured to collect different types of information. Figure 8.7 shows the Dr. Watson main dialog box, which is displayed by launching Dr. Watson from a DOS window using this command:</P>
<!-- CODE SNIP //-->
<pre>
drwtsn32
</PRE>
<!-- END CODE SNIP //-->
<p><a name="Fig7"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch08/images/08-07.jpg',331,455 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch08/images/08-07t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch08/images/08-07.jpg',331,455)"><font color="#000077"><b>Figure 8.7</B></FONT></A>&nbsp;&nbsp;Dr. Watson can be configured to log several types of information after an application crashes.</P>
<p>In order to use Dr. Watson, your executable must include debug information in the Common Object File Format (COFF). You can include COFF symbols in release mode builds, as well as debug builds, by modifying the Linker&#146;s debug settings in the Project Settings dialog box in Visual C<small>&#43;&#43;</SMALL> 6.0.</P>
<p>The Crash1 project is configured to generate the proper debug information in release and debug builds. Running the Crash1 program on a Windows 2000 machine that has Dr. Watson configured as the default debugger causes Dr. Watson to make an appearance, as shown in Figure 8.8.</P>
<p><a name="Fig8"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch08/images/08-08.jpg',412,158 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch08/images/08-08t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch08/images/08-08.jpg',412,158)"><font color="#000077"><b>Figure 8.8</B></FONT></A>&nbsp;&nbsp;The message box displayed as a Dr. Watson log is generated.</P>
<p>Dr. Watson logs are placed in the Windows 2000 root directory in a file named <small>drwtsn32.log</SMALL>. Listing 8.2 contains excerpts from a Dr. Watson log file generated by running Crash1.</P>
<p><b>Listing 8.2</B> Excerpts from a Dr. Watson Log File<hr></P>
<!-- CODE //-->
<pre>
Application exception occurred:
        App: Release/crash1.exe (pid=2128)
        When: 3/4/99 @ 00:49:14.984
        Exception number: c0000005 (access violation)

*----&gt System Information &lt----*
        Computer Name: SLARTIBARTFAST
        User Name: Administrator
        Number of Processors: 2
        Processor Type: x86 Family 6 Model 1 Stepping 9
        Windows Version: 5.0
        Current Build: 1946
        Service Pack: None
        Current Type: Multiprocessor Free
        Registered Organization: codev technologies
        Registered Owner: Mickey Williams

*----&gt Task List &lt----*
   0 Idle.exe
   8 System.exe
 120 smss.exe
 152 csrss.exe
 172 winlogon.exe
2156 MSDEV.exe
2128 crash1.exe
2200 drwtsn32.exe
   0 _Total.exe



function: BadFunc1
        00401029 55               push    ebp
        0040102a 8bec             mov     ebp,esp
        0040102c 51               push    ecx
        0040102d c745fc00000000   mov   dword ptr [ebp&#43;0xfc]
        00401034 8b45fc           mov     eax,[ebp&#43;0xfc]
FAULT -&gt00401037 c7002a000000    mov     dword ptr [eax],0x2a
        0040103d 8b4dfc          mov     ecx,[ebp&#43;0xfc]


*----&gt Stack Back Trace &lt----*

FramePtr ReturnAd Param#1  Param#2  Param#3  Function Name
0012FF44 00401020 0012FFC0 004011C2 00000001 crash1!BadFunc1
0012FF4C 004011C2 00000001 00312368 00312A68 crash1!main
0012FFC0 77EDE388 77F818A2 00140E68 7FFDF000 crash1!mainCRTStartup
0012FFF0 00000000 004010DF 00000000 00000000 kernel32!CreateProcessW
</PRE>
<!-- END CODE //-->
<hr>
<p>A number of lines have been removed in Listing 8.2 for clarity. Also, several of the lines were shortened to allow them to fit on the printed page. A full copy of the Dr. Watson log file is included in the Crash1 project directory.
</P>
<p>One of the great things about Dr. Watson logs is that an access violation actually places an arrow pointing at the line of assembly code that caused the fault. This is often a great help, as is the stack trace that&#146;s included in the Dr. Watson log.</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="08-05.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="08-07.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>