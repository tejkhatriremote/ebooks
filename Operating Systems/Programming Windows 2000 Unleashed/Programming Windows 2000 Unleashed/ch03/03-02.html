<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Threads and Processes</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=03//-->
<!--PAGES=059-062//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="03-01.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="03-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<p>The &#147;create&#148; flag parameter has one or more of the following values:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>CREATE_DEFAULT_ERROR_MODE</SMALL> prevents the new process from inheriting the error mode set by the parent process.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>CREATE_NEW_CONSOLE</SMALL> gives the new process its own console, instead of inheriting the one owned by the parent process. This flag cannot be used with the <small>DETACHED_PROCESS</SMALL> flag.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>CREATE_NEW_PROCESS_GROUP</SMALL> specifies that the new process is the root member of a new process group.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>CREATE_SEPARATE_WOW_VDM</SMALL> is used when you&#146;re creating a 16-bit process. This flag specifies that the new process is given its own Windows on Windows (WOW) Virtual DOS Machine.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>CREATE_SHARED_WOW_VDM</SMALL> is used when you&#146;re creating a 16-bit process. This flag specifies that the new process will share a Windows on Windows (WOW) Virtual DOS Machine.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>CREATE_SUSPENDED</SMALL> specifies that the primary thread of the new process is created in a suspended state.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>CREATE_UNICODE_ENVIRONMENT</SMALL> specifies that the environment block uses Unicode instead of ANSI characters.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>DEBUG_PROCESS</SMALL> specifies that the parent process is interested in receiving debug events generated from the new process.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>DEBUG_ONLY_THIS_PROCESS</SMALL> is used to specify that the new process should not be debugged using the same debugger used for the parent process.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>DETACHED_PROCESS</SMALL> prevents the new process from accessing the console window of the parent process. This flag cannot be used with the <small>CREATE_NEW_CONSOLE</SMALL> flag.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>IDLE_PRIORITY_CLASS</SMALL> specifies that the threads owned by the process only run when the system is idle.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>BELOW_NORMAL_PRIORITY_CLASS</SMALL> specifies that threads owned by the process should run at a priority level between <small>IDLE_PRIORITY_CLASS</SMALL> and <small>NORMAL_PRIORITY_CLASS</SMALL>. This is a more fine-grained option that was not available prior to Windows 2000.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>NORMAL_PRIORITY_CLASS</SMALL> is used to specify a process without special scheduling requirements. This thread priority value should be used for almost all cases.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>ABOVE_NORMAL_PRIORITY_CLASS</SMALL> specifies that threads owned by the process should run at a priority level between <small>NORMAL_PRIORITY_CLASS</SMALL> and <small>HIGH_PRIORITY_CLASS</SMALL>. This is a more fine-grained option that was not available prior to Windows 2000.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>HIGH_PRIORITY_CLASS</SMALL> specifies that the threads in the process need to perform delay-sensitive tasks that must be executed with a minimum amount of delay. This flag should be used with care, because it will causes the thread to preempt most other threads in the system. This priority level will not be inherited by child processes.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>REALTIME_PRIORITY_CLASS</SMALL> specifies that the threads owned by the process must be given the highest possible priority. Threads running at this level literally outrun parts of the operating system. Because threads with this attribute execute faster than the virtual memory management system and other internal processes, they may become deadlocked and cause the system to behave erratically. This priority level will not be inherited by child processes.
</DL>
<p>The <small>CreateProcess</SMALL> function returns <small>TRUE</SMALL> if it was able to begin launching the new process. If the process cannot be started, it&#146;s usually considered a fault in the new process; as far as <small>CreateProcess</SMALL> is concerned, its work is finished.</P>
<p>The <small>PROCESS_INFORMATION</SMALL> structure contains information about the new process and its primary thread. The <small>PROCESS_INFORMATION</SMALL> structure has four members:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>hProcess</SMALL> is a handle for the new process.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>hThread</SMALL> is a handle to the primary thread of the new process.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>dwProcessId</SMALL> is an ID number for the new process. Take care when using this value&#151;it&#146;s only valid as long as the process is running, and Windows 2000 may reassign it to a new process immediately after this process is finished.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>dwThreadId</SMALL> is an ID number for the primary thread of the new process.
</DL>
<h4 align="LEFT"><a name="Heading5"></A><font color="#000077">Ending a Process</FONT></H4>
<p>There are three ways to end a process. The preferred way is to call the <small>ExitProcess</SMALL> function from within one of the threads executing the process:</P>
<!-- CODE SNIP //-->
<pre>
ExitProcess(NO_ERROR);
</PRE>
<!-- END CODE SNIP //-->
<p>Calling <small>ExitProcess</SMALL> enables a process to perform an orderly exit&#151;such as calling the DLL entry point functions for any DLLs that the process has loaded, signaling threads that may be waiting for it to finish, and closing all the object handles owned by the process.</P>
<p>After the process has ended, the <small>GetExitCodeProcess</SMALL> function returns the value passed as a parameter to <small>ExitProcess</SMALL>. If the <small>GetExitCodeProcess</SMALL> function is called before the process ends, the return value is <small>STILL_ACTIVE</SMALL>.</P>
<p>Another way to end a process is to call <small>TerminateProcess</SMALL>, passing the handle of the process to be ended:</P>
<!-- CODE SNIP //-->
<pre>
TerminateProcess(hProcess, NO_ERROR);
</PRE>
<!-- END CODE SNIP //-->
<p>This method should be avoided when possible, because it does not unload DLLs and perform other types of system cleanup that are normally performed when a process ends.
</P>
<p>The third way to kill a process is to terminate all the threads owned by the process. This is the method used by most Win32 programs&#151;after all the threads associated with a program have finished their work, the process is terminated.</P>
<h3><a name="Heading6"></A><font color="#000077">Managing Threads</FONT></H3>
<p>Unlike many popular multithreaded operating systems, Windows 2000 offers true threads. Most multithreaded operating systems require you to create a new process when creating a new path of execution. However, a Windows 2000 thread is much less expensive to create than a typical UNIX process, in terms of computing resources, and offers a wide range of management options. The next few sections discuss how threads are created and managed in a Windows 2000 application.
</P>
<h4 align="LEFT"><a name="Heading7"></A><font color="#000077">Creating Threads</FONT></H4>
<p>A thread can be created in four ways:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;By launching a new process
<dd><b>&#149;</B>&nbsp;&nbsp;By calling the Win32 <small>CreateThread</SMALL> API function
<dd><b>&#149;</B>&nbsp;&nbsp;By calling the C runtime library function <small>_beginthread</SMALL>
<dd><b>&#149;</B>&nbsp;&nbsp;By calling the C runtime library function <small>_beginthreadex</SMALL>
</DL>
<p>When you&#146;re launching a new process with the <small>CreateProcess</SMALL> function, the thread ID is found in the <small>dwThreadId</SMALL> member of the <small>PROCESS_INFORMATION</SMALL> structure that&#146;s filled after the function call returns. The thread handle can be found in the <small>hThread</SMALL> member of the same structure.</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="03-01.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="03-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>