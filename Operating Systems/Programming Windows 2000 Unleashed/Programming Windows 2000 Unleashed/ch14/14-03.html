<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Automation</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=14//-->
<!--PAGES=451-453//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="14-02.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="14-04.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<p>The discriminator for the actual data type in the union is contained in the <small>vt</SMALL> member. Possible values for <small>vt</SMALL> are listed in Table 14.1.</P>
<table width="100%"><caption align="LEFT" colspan="2"><b>Table 14.1</B> Possible Values for the <small>vt</SMALL> Member of the <small>VARIANT</SMALL> Structure
<tr>
<td colspan="2"><hr>
<tr>
<th width="40%" align="LEFT" valign="TOP"><i>Value</I>
<th width="60%" align="LEFT" valign="TOP"><i>Meaning</I>
<tr>
<td colspan="2"><hr>
<tr>
<td align="LEFT" valign="TOP"><small>VT_EMPTY</SMALL>
<td align="LEFT" valign="TOP">No value was specified.
<tr>
<td align="LEFT" valign="TOP"><small>VT_UI1</SMALL>
<td align="LEFT" valign="TOP">Unsigned one-byte character stored in <small>bVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_UI1 | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to an unsigned one-byte character is stored in <small>pbVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_I2</SMALL>
<td align="LEFT" valign="TOP">A two-byte integer value is stored in <small>iVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_I2 | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to a two-byte integer is stored in <small>piVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_I4</SMALL>
<td align="LEFT" valign="TOP">A four-byte integer value is stored in <small>lVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_I4 | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to a four-byte integer is stored in <small>plVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_R4</SMALL>
<td align="LEFT" valign="TOP">An IEEE four-byte real value is stored in <small>fltVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_R4 | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to an IEEE four-byte real is stored in <small>pfltVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_R8</SMALL>
<td align="LEFT" valign="TOP">An eight-byte IEEE real value is stored in <small>dblVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_R8 | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to an eight-byte IEEE real is stored in <small>pdblVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_CY</SMALL>
<td align="LEFT" valign="TOP">A currency value is stored in <small>cyVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_CY | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to a currency value is stored in <small>pcyVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_BSTR</SMALL>
<td align="LEFT" valign="TOP">A <small>BSTR</SMALL> is stored in <small>bstrVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_BSTR | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to a <small>BSTR</SMALL> is stored in <small>pbstrVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_NULL</SMALL>
<td align="LEFT" valign="TOP">A SQL <small>NULL</SMALL> value was specified.
<tr>
<td align="LEFT" valign="TOP"><small>VT_ERROR</SMALL>
<td align="LEFT" valign="TOP">An <small>HRESULT</SMALL> (also known as an <small>SCODE</SMALL>) is stored in <small>scode</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_ERROR | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to an <small>HRESULT</SMALL> is stored in <small>pscode</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_BOOL</SMALL>
<td align="LEFT" valign="TOP">A Boolean (true/false) value is stored in <small>bool</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_BOOL | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to a Boolean value is stored in <small>pbool</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_DATE</SMALL>
<td align="LEFT" valign="TOP">A value representing a date and time is stored in <small>date</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_DATE | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to a date is stored in <small>pdate</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_DISPATCH</SMALL>
<td align="LEFT" valign="TOP">A pointer to an object supporting <small>IDispatch</SMALL> is stored in <small>pdispVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_DISPATCH | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to a pointer to an object supporting <small>IDispatch</SMALL> is stored in the location referred to by <small>ppdispVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_VARIANT | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to another <small>VARIANTARG</SMALL> is stored in <small>pvarVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_UNKNOWN</SMALL>
<td align="LEFT" valign="TOP">A pointer to an object that implements <small>IUnknown</SMALL> is stored in <small>punkVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_UNKNOWN | VT_BYREF</SMALL>
<td align="LEFT" valign="TOP">A pointer to a pointer to <small>IUnknown</SMALL> is stored in <small>ppunkVal</SMALL>.
<tr>
<td align="LEFT" valign="TOP"><small>VT_ARRAY</SMALL> | &lt;<i>anything</I>&gt;
<td align="LEFT" valign="TOP">An array of data type <small><i>&lt;anything&gt;</I></SMALL> is passed, with information stored in an array descriptor pointed to by <small>pByrefVal</SMALL>.
<tr>
<td colspan="2"><hr>
</TABLE>
<p>When handling a <small>VARIANT</SMALL> object, you have two ways you can simplify your life:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;You can use the built-in Visual C<small>&#43;&#43;</SMALL> compiler support for COM and the _<small>variant_t</SMALL> data type.
<dd><b>&#149;</B>&nbsp;&nbsp;You can use the <small>Variant<i>xxx</I></SMALL> API functions. (These functions are discussed in detail in the next section.)
</DL>
<p><font size="+1"><b>Using the Win32 SDK Variant Functions</B></FONT></P>
<p>Managing a large discriminated union is always difficult. When the union is as large as <small>VARIANT</SMALL>, it is nearly impossible. Luckily, the Win32 SDK includes functions that are used to properly manage <small>VARIANT</SMALL> structures. These functions understand the maze of rules required to handle <small>VARIANT</SMALL> structures correctly.</P>
<p>For example, if you&#146;re clearing a <small>VARIANT</SMALL>, you must call <small>IUnknown::Release</SMALL> if the stored element is a pointer to <small>IUnknown</SMALL> or <small>IDispatch</SMALL>. The most commonly used <small>VARIANT</SMALL>-handling functions follow:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>VariantClear</SMALL> properly frees the contents of a <small>VARIANT.BSTR</SMALL> and OLE interface types are freed properly, and the <small>vt</SMALL> member is set to <small>VT_EMPTY</SMALL>.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>VariantCopy</SMALL> copies one <small>VARIANT</SMALL> to another, adjusting reference counts if needed.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>VariantInit</SMALL> initializes a <small>VARIANT</SMALL> structure.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>VariantChangeType</SMALL> safely converts a <small>VARIANT</SMALL> from one type to another, performing initialization and release operations as required.
</DL>
<p><font size="+1"><b>Using the _variant_t Data Type</B></FONT></P>
<p>If you&#146;re using Visual C<small>&#43;&#43;</SMALL> 5.0 or later, you can take advantage of the <small>_variant_t</SMALL> data type. Like the <small>_bstr_t</SMALL> data type, the <small>_variant_t</SMALL> class is defined in <small>comutil.h</SMALL> and is part of the compiler&#146;s built-in COM support.</P>
<p>The <small>_variant_t</SMALL> class is a very thin wrapper around the <small>VARIANT</SMALL> type. The constructor automatically initializes the <small>VARIANT</SMALL>, and the destructor will automatically destroy it. However, as of this writing, <small>_variant_t</SMALL> doesn&#146;t support all the types available for <small>VARIANT</SMALL> in Windows 2000. The <small>comutil.h</SMALL> header file includes documentation about exactly which types are supported.</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="14-02.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="14-04.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>