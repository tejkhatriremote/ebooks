<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Custom COM Objects</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=17//-->
<!--PAGES=534-537//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="17-03.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="17-05.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<p>Given a project named <i>Espresso</I>, the ATL COM AppWizard will create the following files for your ATL project:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>stdafx.h</SMALL>. Just as in an MFC project, <small>stdafx.h</SMALL> has all of the standard <small>#include</SMALL> directives that will be built into a precompiled header.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>stdafx.cpp</SMALL>. Just as in an MFC project, <small>stdafx.cpp</SMALL> is used to create the precompiled header file.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.dsp</SMALL>. The Visual C<small>&#43;&#43;</SMALL> project file.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.dsw</SMALL>. The Visual C<small>&#43;&#43;</SMALL> workspace file.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.opt</SMALL>. The Visual C<small>&#43;&#43;</SMALL> workspace options file.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.ncb</SMALL>. A binary file used by the Visual C<small>&#43;&#43;</SMALL> ClassWizard.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.rc</SMALL>. The project resource file, which initially contains version information for the project.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>resource.h</SMALL>. The project resource header file.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.idl</SMALL>. Contains the IDL definitions for the project.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.cpp</SMALL>. Contains basic functions necessary for the module to interact with COM. DLL projects have a variety of <small>Dll</SMALL> Xxx functions. EXE projects have <small>CExeModule</SMALL> member functions; service projects have <small>CServiceModule</SMALL> functions.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.h</SMALL>. This file is initially empty, but is replaced by a more meaningful version after the MIDL compiler is run against the project&#146;s IDL file.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espressops.mk</SMALL>. The makefile used to build the proxy/stub DLL if required for custom marshaling support.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espressops.def</SMALL>. The module definition file for the proxy/stub DLL.
</DL>
<p>If you create a DLL project that allows the proxy/stub code to be merged, the following files will be created:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>dlldatax.c</SMALL>. A source file that must be added to the project in order to merge proxy/stub code into the DLL.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>dlldatax.h</SMALL>. The header file for <small>dlldata.c</SMALL>.
</DL>
<p>These two files are not automatically added to your project&#151;you must follow the steps outlined later in the section titled &#147;Merging the Proxy/Stub Code with Your DLL.&#148;
</P>
<p>The following file will be created for all DLL-based projects:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.def</SMALL>. The module-definition file for the project.
</DL>
<p>Finally, the following file will be created for all EXE and service projects:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>espresso.rgs</SMALL>. The script file used to insert information into the System Registry.
</DL>
<p><font size="+1"><b>Using ATL Object Wizard</B></FONT></P>
<p>As discussed earlier, the ATL Object Wizard is used to add an ATL COM object to your project. The ATL Object Wizard is launched by selecting Insert, New ATL Object from the Visual C<small>&#43;&#43;</SMALL> menu. The ATL Object Wizard is shown in Figure 17.6.</P>
<p><a name="Fig6"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-06.jpg',412,256 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-06t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-06.jpg',412,256)"><font color="#000077"><b>Figure 17.6</B></FONT></A>&nbsp;&nbsp;The ATL Object Wizard.</P>
<p>There are four categories of objects that can be inserted into your project:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Objects</I>. Contains ASP components, MMC snap-ins, MTS components, and other basic COM objects.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Controls</I>. Contains controls that are suitable for embedding in ActiveX containers. These objects are discussed in Chapter 18, &#147;Developing ActiveX Controls.&#148;
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Miscellaneous</I>. Contains a dialog box object that can be added to your project.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Data Access</I>. Contains data provider and consumer objects.
</DL>
<p>Seven types of COM objects are offered by the ATL Object Wizard:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Simple Object</I>. Generates a simple COM object for the project.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Add-in Object</I>. Creates a COM object that can extend Visual Studio IDE.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Internet Explorer Object</I>. Creates a nonvisual COM object that can be hosted inside Internet Explorer.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>ActiveX Server Component</I>. Generates a COM object that can be used with Active Server Pages in IIS.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>MMC SnapIn</I>. Creates a COM object that can be used with Microsoft Management Console.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>MS Transaction Server Component</I>. Creates a COM object that can be used with MTS.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Component Registrar Object</I>. Creates a COM object that enables you to register individual components in a DLL rather than registering all components at once.
</DL>
<p>After a COM object has been selected, a property sheet is displayed that enables you to define attributes for the object. Some COM objects display specialized property pages that are specific to their object type. For example, the MTS component includes an MTS page that&#146;s used only for that particular object type. All the COM objects will present a Names property page, as shown in Figure 17.7.
</P>
<p><a name="Fig7"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-07.jpg',420,278 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-07t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-07.jpg',420,278)"><font color="#000077"><b>Figure 17.7</B></FONT></A>&nbsp;&nbsp;The Names property page contains naming attributes for the COM object.</P>
<p>Eight items are displayed on the Names property page:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Short Name</I>. The name of the COM object.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Class</I>. The name of the C<small>&#43;&#43;</SMALL> class that implements the COM object. By default, this is the name of the object prefixed with <small>C</SMALL>.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>.H File</I>. The name of the header file for the COM object. By default, this is the name of the COM object with an <small>.H</SMALL> extension.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>.CPP File</I>. The name of the implementation file for the COM object. By default, this is the name of the COM object with a <small>.CPP</SMALL> extension.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>CoClass</I>. The name of the COM object&#146;s coclass. By default, this is the name of the COM object.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Interface</I>. The name of the interface exposed by the COM object. By default, this is the name of the COM object prefixed with <small>I</SMALL>.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Type</I>. A description string that&#146;s stored in the Registry under the COM object&#146;s prog ID. By default, this is the name of the COM object followed by &#147;Class&#148;.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Prog ID</I>. The prog ID for the COM object. By default, this is <small>&lt <i>project name &gt.&ltCOM object name</I>&gt</SMALL>. For example, a project named <i>Latte</I> that has a COM object named <i>Foam</I> would have a default prog ID of Latte.Foam.
</DL>
<p>The second tab for most COM objects is the Attributes property page, which is used to collect information about the object, such as its threading model (see Figure 17.8).
</P>
<p><a name="Fig8"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-08.jpg',420,278 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-08t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch17/images/17-08.jpg',420,278)"><font color="#000077"><b>Figure 17.8</B></FONT></A>&nbsp;&nbsp;The Attributes property page contains characteristics for the COM object.</P>
<p>The Attributes property page allows you to define the following properties for the COM object:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Threading Model</I>. The threading model for the COM object. The options for this property are discussed in the next list.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Interface</I>. Select Dual for an Automation-compatible interface or Custom for a COM vtable interface.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Aggregation</I>. The type of aggregation supported by the COM object. The options for this property are discussed in a later list.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Support ISupportErrorInfo</I>. Adds support for the <small>ISupportErrorInfo</SMALL> interface to your COM object.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Support Connection Points</I>. Adds support for connection points to your COM object. Using connection points is discussed in the section titled, &#147;Connection Points,&#148; later in this chapter.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Free Threaded Marshaler</I>. Adds support for simplified marshaling of interface pointers between apartments, under some circumstances.
</DL>
<p>The threading model for the COM object can be set to one of the following options:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Single</I>. The COM object is created in the main STA for the process.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Apartment</I>. The COM object is created in an STA.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Free</I>. The COM object is created in an MTA.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Both</I>. The COM object is created in either an STA or MTA, depending on the apartment type of the caller.
</DL>
<p><br></P>
<center>
<table border>
<tr>
<td><a href="17-03.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="17-05.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>