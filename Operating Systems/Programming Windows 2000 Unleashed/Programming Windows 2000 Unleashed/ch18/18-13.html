<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Developing ActiveX Controls</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=18//-->
<!--PAGES=615-617//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="18-12.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="../ch19/19-01.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<p>Listing 18.23 contains six functions:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>OnDraw</SMALL> determines the proper colors for the control and calls the <small>DrawEdges</SMALL> and <small>DrawButtonText</SMALL> functions to perform most of the drawing work.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>DrawEdges</SMALL> draws the edges of the control rectangle based on the control&#146;s current state. This function calls <small>Draw3dRectEdges</SMALL> to draw the beveled edges.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>DrawButtonText</SMALL> fills the center of the button with the caption text.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>Draw3dRectEdges</SMALL> draws a rectangle in 3-D based on a <small>RECT</SMALL> passed as a parameter. This function breaks the rectangle into coordinates and calls <small>Draw3dCoordEdges</SMALL>.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>Draw3dCoordsEdges</SMALL> draws a rectangle in 3-D based on coordinates passed as a parameter. This function makes four calls to <small>FastFillCoords</SMALL> to draw the beveled edges of the rectangle.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FastFillCoords</SMALL> is a function that uses <small>ExtTextOut</SMALL> to fill a rectangle with a specified color.
</DL>
<p>Compile the PopBtn project. You can test the control using the ActiveX control container by following the steps outlined earlier in this chapter. In the next section, a Visual Basic project will be created that uses the PopButton control.
</P>
<h4 align="LEFT"><a name="Heading27"></A><font color="#000077">Testing PopButton with Visual Basic</FONT></H4>
<p>This section creates a Visual Basic project named PopTest that uses the PopButton control. The project can be found on this book&#146;s CD-ROM, or you can build the project yourself using the steps presented here.
</P>
<p><font size="+1"><b>Adding the PopButton Control to the VB Toolbox</B></FONT></P>
<p>To add the PopButton component to the VB component palette, follow these steps:
</P>
<dl>
<dd><b>1.</B>&nbsp;&nbsp;Right-click on the component palette and select Components from the pop-up menu. The Components dialog box will be displayed.
<dd><b>&#149;</B>&nbsp;&nbsp;2. Select PopBtn 1.0 Type Library from the list of registered components. Make sure the checkbox is checked.
<dd><b>&#149;</B>&nbsp;&nbsp;3. Click the OK button to add the control to the palette.
</DL>
<p><font size="+1"><b>Creating the PopTest Project</B></FONT></P>
<p>PopTest is a Visual Basic project consisting of one form that contains three PopButtons, one label, and one command button, as shown in Figure 18.22. Each of the controls uses its default name provided by Visual Basic.
</P>
<p><a name="Fig22"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-22.jpg',320,240 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-22t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-22.jpg',320,240)"><font color="#000077"><b>Figure 18.22</B></FONT></A>&nbsp;&nbsp;The main form in PopTest.</P>
<p>The source code for the PopTest project is provided in Listing 18.24.
</P>
<p><b>Listing 18.24</B> Source Code for the PopTest VB Project<hr></P>
<!-- CODE //-->
<pre>
Private Sub Command1_Click()
    Unload Me
End Sub

Private Sub PopButton1_OnClick(Index As Integer)

    Select Case Index
        Case 0
            MsgBox &#147;Hello from Huey&#148;
        Case 1
            MsgBox &#147;Hello from Dewey&#148;
        Case 2
            MsgBox &#147;Hello from Louie&#148;
    End Select

End Sub

Private Sub PopButton1_OnHover(Index As Integer)

    Select Case Index
        Case 0
            Label1 = &#147;Hovering over Huey&#148;
        Case 1
            Label1 = &#147;Hovering over Dewey&#148;
        Case 2
            Label1 = &#147;Hovering over Louie&#148;
    End Select

End Sub
</PRE>
<!-- END CODE //-->
<p><hr></P>
<p>Run the PopTest project. The text label is updated for hover events, and clicking on any of the PopButton controls will cause a message box to be displayed. Figure 18.23 shows an example of the PopTest project running.</P>
<p><a name="Fig23"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-23.jpg',320,240 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-23t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-23.jpg',320,240)"><font color="#000077"><b>Figure 18.23</B></FONT></A>&nbsp;&nbsp;The PopTest project running with several PopButton controls on one form.</P>
<h3><a name="Heading28"></A><font color="#000077">Summary</FONT></H3>
<p>This chapter discussed creating and testing ActiveX controls. ActiveX controls are smaller and simpler versions of OLE custom controls. Although an ActiveX control is required to support fewer interfaces than the older OLE custom controls, it&#146;s believed that most ActiveX controls will continue to be very similar to OLE custom controls, although you now have the flexibility to omit an interface if your control doesn&#146;t require it.
</P>
<p>Visual C<small>&#43;&#43;</SMALL> simplifies the task of creating an ActiveX control through the MFC and ATL class libraries and their associated wizards. For example, the MFC ActiveX ControlWizard is very similar to AppWizard, and it guides you through the steps required to create a skeleton version of your control.</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="18-12.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="../ch19/19-01.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>