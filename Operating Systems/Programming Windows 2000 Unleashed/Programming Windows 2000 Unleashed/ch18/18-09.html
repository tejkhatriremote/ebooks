<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Developing ActiveX Controls</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=18//-->
<!--PAGES=600-604//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="18-08.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="18-10.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
</P>
<p>The values used for PopButton are provided in Table 18.11. Keep the default values for all these options, except for the checkbox labeled Support Connection Points. Connection points are used to supply events to the control&#146;s container, so make sure the checkbox is selected.
</P>
<table width="100%"><td caption align="LEFT" colspan="2"><b>Table 18.11</B> Contents of the Attributes Tab for the PopButton Control
<tr>
<td colspan="2"><hr>
<tr>
<th width="50%" align="LEFT" valign="TOP"><i>Property</I>
<th width="50%" valign="TOP" align="LEFT"><i>Value</I>
<tr>
<td colspan="2"><hr>
<tr>
<td valign="TOP" align="LEFT">Threading Model
<td valign="TOP" align="LEFT">Apartment
<tr>
<td valign="TOP" align="LEFT">Interface
<td valign="TOP" align="LEFT">Dual
<tr>
<td valign="TOP" align="LEFT">Aggregation
<td valign="TOP" align="LEFT">Yes
<tr>
<td valign="TOP" align="LEFT">Support <small>ISupportErrorInfo</SMALL>
<td valign="TOP" align="LEFT">Unchecked
<tr>
<td valign="TOP" align="LEFT"><b>Support Connection Points</B>
<td valign="TOP" align="LEFT"><b>Checked</B>
<tr>
<td valign="TOP" align="LEFT">Free Threaded Marshaler
<td valign="TOP" align="LEFT">Unchecked
<tr>
<td colspan="2"><hr>
</TABLE>
<p>The third tab is labeled Miscellaneous and contains attributes that apply specifically to ActiveX controls. The Miscellaneous tab is shown in Figure 18.20.
</P>
<p><a name="Fig20"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-20.jpg',421,278 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-20t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-20.jpg',421,278)"><font color="#000077"><b>Figure 18.20</B></FONT></A>&nbsp;&nbsp;The contents of the Miscellaneous tab for the PopButton ATL object.</P>
<p>Here are the properties contained in the Miscellaneous tab:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Opaque</I>. Specifies that the control is completely opaque, with none of the container allowed to show through the control. Selecting this option causes the control to be drawn slightly faster.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Solid Background</I>. Specifies that the control has a solid background rather than a pattern-filled background.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Add control based on</I>. Specifies a standard Windows control that is subclassed or superclassed by the ActiveX control. PopButton superclasses the standard Windows pushbutton control.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Invisible at runtime</I>. Indicates that the button will never be visible at runtime.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Acts like a button</I>. Specifies that the control is a button and can draw a default button rectangle around the control. (This option is selected for PopButton.)
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Acts like a label</I>. Specifies that the control can replace the container&#146;s label.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Normalize DC</I>. Specifies that the device context (DC) should be normalized before it&#146;s passed to the control class&#146;s <small>OnDraw</SMALL> function. (This option is usually selected.)
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Insertable</I>. Specifies that the ActiveX control should be listed as an insertable object in general-purpose OLE containers such as Word.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Windowed Only</I>. Specifies that the control should never be created as a windowless control. Containers that support the OC 96 specification, such as Internet Explorer, will create windowless controls as an optimization whenever possible.
</DL>
<p>Values used by the PopButton object in the Miscellaneous tab are provided in Table 18.12, with nondefault values shown in bold type.
</P>
<table width="100%"><td caption align="LEFT" colspan="2"><b>Table 18.12</B> Contents of the Miscellaneous Tab for the PopButton Control
<tr>
<td colspan="2"><hr>
<tr>
<th width="50%" align="LEFT" valign="TOP"><i>Property</I>
<th width="50%" valign="TOP" align="LEFT"><i>Value</I>
<tr>
<td colspan="2"><hr>
<tr>
<td valign="TOP" align="LEFT">Opaque
<td valign="TOP" align="LEFT">Checked
<tr>
<td valign="TOP" align="LEFT">Solid Background
<td valign="TOP" align="LEFT">Checked
<tr>
<td valign="TOP" align="LEFT"><b>Add control based on</B>
<td valign="TOP" align="LEFT"><b>Button</B>
<tr>
<td valign="TOP" align="LEFT">Invisible at runtime
<td valign="TOP" align="LEFT">Unchecked
<tr>
<td valign="TOP" align="LEFT"><b>Acts like a button</B>
<td valign="TOP" align="LEFT"><b>Checked</B>
<tr>
<td valign="TOP" align="LEFT">Acts like a label
<td valign="TOP" align="LEFT">Unchecked
<tr>
<td valign="TOP" align="LEFT">Normalize DC
<td valign="TOP" align="LEFT">Checked
<tr>
<td valign="TOP" align="LEFT"><b>Windowed Only</B>
<td valign="TOP" align="LEFT"><b>Checked</B>
<tr>
<td valign="TOP" align="LEFT">Insertable
<td valign="TOP" align="LEFT">Unchecked
<tr>
<td colspan="2"><hr>
</TABLE>
<p>The final tab in the dialog box is labeled Stock Properties; it contains a list of all stock properties that can be implemented by an ActiveX control, as shown in Figure 18.21.
</P>
<p><a name="Fig21"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-21.jpg',421,279 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-21t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-21.jpg',421,279)"><font color="#000077"><b>Figure 18.21</B></FONT></A>&nbsp;&nbsp;The contents of the Stock Properties tab for the PopButton ATL object.</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;The following stock properties are used by the PopButton control:
<dd><b>&#149;</B>&nbsp;&nbsp;Background Color
<dd><b>&#149;</B>&nbsp;&nbsp;Foreground Color
<dd><b>&#149;</B>&nbsp;&nbsp;Tab Stop
<dd><b>&#149;</B>&nbsp;&nbsp;Caption
</DL>
<p>After you&#146;ve selected the stock properties listed here, close the dialog box. The ATL New Object Wizard will generate the necessary code and add it to the project.
</P>
<p><font size="+1"><b>Handling the BevelSize Custom Property</B></FONT></P>
<p>The PopButton object will expose a custom property that contains the size, in pixels, of the button&#146;s beveled edge. Add a custom property to the PopButton object by right-clicking the <small>IPopButton</SMALL> icon in ClassView and selecting Add Property from the pop-up menu. Use the values from Table 18.13 to add the <small>BevelSize</SMALL> property.</P>
<table width="100%"><td caption align="LEFT" colspan="2"><b>Table 18.13</B> Values Used to Add the <small>BevelSize</SMALL> Property
<tr>
<td colspan="2"><hr>
<tr>
<th width="20%" valign="TOP" align="LEFT"><i>Control</I>
<th width="80%" valign="TOP" align="LEFT"><i>Value</I>
<tr>
<td colspan="2"><hr>
<tr>
<td valign="TOP" align="LEFT">Property Type
<td valign="TOP" align="LEFT"><small>short</SMALL>
<tr>
<td valign="TOP" align="LEFT">Property Name
<td valign="TOP" align="LEFT"><small>BevelSize</SMALL>
<tr>
<td valign="TOP" align="LEFT">Parameters
<td valign="TOP" align="LEFT">(none)
<tr>
<td valign="TOP" align="LEFT">Get Function
<td valign="TOP" align="LEFT">Checked
<tr>
<td valign="TOP" align="LEFT">Put Function
<td valign="TOP" align="LEFT">Checked
<tr>
<td valign="TOP" align="LEFT">PropPut
<td valign="TOP" align="LEFT">Selected
<tr>
<td colspan="2"><hr>
</TABLE>
<p>Click OK to generate the IDL and skeleton C<small>&#43;&#43;</SMALL> code for the property. As part of adding the property to the project, <small>get_</SMALL> and <small>put_</SMALL> access functions are added to the project. The access functions for the <small>BevelSize</SMALL> property are shown in Listing 18.10, with new lines shown in bold. The new lines store the property in the <small>m_cBevelSize</SMALL> member variable.</P>
<p><b>Listing 18.10</B> The <small>get_</SMALL> and <small>put_</SMALL> Access Functions for the <small>BevelSize</SMALL> Property<hr></P>
<!-- CODE //-->
<pre>
STDMETHODIMP CPopButton::get_BevelSize(short *pVal)
{
  <b>*pVal = m_cBevelSize;</B>
   return S_OK;
}
STDMETHODIMP CPopButton::put_BevelSize(short newVal)
{
   <b>m_cBevelSize = newVal;</B>
      return S_OK;
}
</PRE>
<!-- END CODE //-->
<p><hr></P>
<p>Add a declaration for the <small>m_cBevelSize</SMALL> member variable at the end of the <small>CPopButton</SMALL> class declaration, after the other public member variables:</P>
<!-- CODE SNIP //-->
<pre>
short  m_cBevelSize; // Stores size of beveled edge
</PRE>
<!-- END CODE SNIP //-->
<p><font size="+1"><b>Adding Outgoing Events</B></FONT></P>
<p>As discussed earlier, the PopButton control will provide two events to its containers:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>OnClick</SMALL> will be sent when the button is clicked.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>OnHover</SMALL> will be sent when the button is raised.
</DL>
<p><br></P>
<center>
<table border>
<tr>
<td><a href="18-08.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="18-10.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>