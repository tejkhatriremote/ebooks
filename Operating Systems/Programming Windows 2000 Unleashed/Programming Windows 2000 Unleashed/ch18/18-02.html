<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Developing ActiveX Controls</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=18//-->
<!--PAGES=574-578//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="18-01.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="18-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h3><a name="Heading4"></A><font color="#000077">ActiveX Control Properties, Events, and Methods</FONT></H3>
<p>Interaction with an ActiveX component takes place via properties, events, and methods:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;A <i>property</I> is an attribute associated with the control.
<dd><b>&#149;</B>&nbsp;&nbsp;An <i>event</I> is a notification message passed to the container by the control.
<dd><b>&#149;</B>&nbsp;&nbsp;A <i>method</I> is an exposed function that can be applied to the control via <small>IDispatch</SMALL>.
</DL>
<p>I&#146;ll discuss each of these interaction methods in the next few sections.
</P>
<h4 align="LEFT"><a name="Heading5"></A><font color="#000077">Properties</FONT></H4>
<p><i>Properties</I> are exposed by ActiveX controls as well as by the client site where the control is located. There are four basic types of properties:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Ambient properties</I> are provided to the control by the container. The control uses these properties in order to &#147;fit in&#148; properly. Commonly used ambient properties include the container&#146;s background color, default font, and foreground color.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Extended properties</I> are implemented by the container but appear to be generated by the control. For example, the tab order of various controls in a container are extended properties.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Stock properties</I> are control properties implemented by the ActiveX control development kit. Examples of stock properties are the control&#146;s font, the caption text, and the foreground and background colors.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Custom properties</I> are control properties you implement.
</DL>
<h4 align="LEFT"><a name="Heading6"></A><font color="#000077">Events</FONT></H4>
<p>An <i>event</I> is used to send a notification message to the control&#146;s container. Typically, events are used to notify the container when mouse clicks or other events take place. There are two basic types of events:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Stock events</I> are implemented by the ActiveX control development kit and are invoked just like a function call, such as <small>FireError</SMALL>.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Custom events</I> are implemented by you, although the MFC and ATL class libraries and Visual C<small>&#43;&#43;</SMALL> handle much of the work for you.
</DL>
<h4 align="LEFT"><a name="Heading7"></A><font color="#000077">Methods</FONT></H4>
<p>Methods implemented by ActiveX controls are exactly like the methods implemented for Automation, as discussed in Chapter 14, &#147;Automation.&#148; In fact, methods are generally implemented through Automation using the <small>IDispatch</SMALL> interface.</P>
<p>ActiveX controls built with MFC always expose their methods via <small>IDispatch</SMALL>. Controls built with ATL can use either a dual interface, as discussed in Chapter 17, or a custom interface.</P>
<h3><a name="Heading8"></A><font color="#000077">An ActiveX Control Example</FONT></H3>
<p>As an example of creating an ActiveX control, the CD-ROM accompanying this book includes an ActiveX control that subclasses the existing Windows edit control. You can either use the completed project from the CD-ROM or follow along as the control is created from scratch.
</P>
<p>The AxEdit control is similar to the basic Windows edit control, except it exposes properties that allow it to accept only numbers, letters, or a combination of both. When <small>WM_CHAR</SMALL> is received by the control, it&#146;s processed as shown in Figure 18.1.</P>
<p><a name="Fig1"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-01.jpg',314,420 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-01t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-01.jpg',314,420)"><font color="#000077"><b>Figure 18.1</B></FONT></A>&nbsp;&nbsp;Handling <small>WM_CHAR</SMALL> in AxEdit.
</P>
<p>The property flags <small>m_fTextAllowed</SMALL> and <small>m_fNumbersAllowed</SMALL> are exposed as properties that can be changed by the AxEdit control&#146;s container.</P>
<h4 align="LEFT"><a name="Heading9"></A><font color="#000077">Creating the Project</FONT></H4>
<p>To get started creating the AxEdit control, use MFC ActiveX ControlWizard to create an MFC ActiveX control project. The initial page from the MFC ActiveX ControlWizard is shown in Figure 18.2. This page allows you to specify the basic characteristics of the project, such as the number of controls handled by this server, whether help files should be generated, and so on. Accept all the default options presented on this page by clicking the Next button.
</P>
<p><a name="Fig2"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-02.jpg',476,383 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-02t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-02.jpg',476,383)"><font color="#000077"><b>Figure 18.2</B></FONT></A>&nbsp;&nbsp;The first page of the MFC ActiveX ControlWizard.</P>
<p>The second ControlWizard page is shown in Figure 18.3. This page allows you to change the names associated with the control and its interfaces as well as to define properties for the control. There&#146;s also a drop-down list that allows a base class to be specified for the control. Select EDIT from the drop-down list to make the AxEdit control subclass the standard edit control.
</P>
<p><a name="Fig3"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-03.jpg',476,383 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-03t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch18/images/18-03.jpg',476,383)"><font color="#000077"><b>Figure 18.3</B></FONT></A>&nbsp;&nbsp;The second page of the MFC ActiveX ControlWizard.</P>
<p>Click the button labeled Finish. A list of the files to be created is displayed. Click the OK button, and the skeleton project is created.
</P>
<h4 align="LEFT"><a name="Heading10"></A><font color="#000077">Drawing the Control</FONT></H4>
<p>All visible ActiveX controls must be capable of drawing themselves. Even controls that aren&#146;t visible when active should draw something as an aid during program development. The AxEdit control is visible at runtime, and it should appear to be a standard edit control.
</P>
<p>You might think that because AxEdit subclasses the standard edit control, it can draw itself. Unfortunately, the only control I&#146;ve found that can draw itself correctly is the pushbutton control. For most controls, you must be prepared to handle the drawing yourself.</P>
<p>When an ActiveX control project is initially created, the control&#146;s <small>OnDraw</SMALL> function draws an ellipse inside the bounding rectangle. The changes to <small>OnDraw</SMALL> required for the AxEdit control are provided in Listing 18.1.</P>
<p><b>Listing 18.1</B> Using the <small>OnDraw</SMALL> Function to Draw an Edit Control<hr></P>
<!-- CODE //-->
<pre>
void CAxEditCtrl::OnDraw(
        CDC* pdc, const CRect&amp rcBounds, const CRect&amp rcInvalid)
{
    COLORREF    clrBackground = TranslateColor(GetBackColor());
    CBrush*     pOldBrush;
    CBrush      brBackground(clrBackground);
    pdc-&gtFillRect(rcBounds, &ampbrBackground);
    pOldBrush = pdc-&gtSelectObject(&ampbrBackground);
    pdc-&gtSelectObject(pOldBrush);
    DoSuperclassPaint(pdc, rcBounds);
    CRect rc(rcBounds);
    pdc-&gtDrawEdge(rc, EDGE_SUNKEN, BF_RECT);
}
</PRE>
<!-- END CODE //-->
<hr>
<p>The code provided in Listing 18.1 does three things. First, it fills the control&#146;s bounding rectangle with the ambient background color. Next, it calls <small>DoSuperclassPaint</SMALL> to allow the edit control a chance to not draw itself properly. Finally, it draws a three-dimensional edge along the control&#146;s bounding rectangle.</P>
<h4 align="LEFT"><a name="Heading11"></A><font color="#000077">Defining Properties for AxEdit</FONT></H4>
<p>There are four properties used by AxEdit: the <small>Font</SMALL> and <small>Text</SMALL> stock properties and the <small>fTextAllowed</SMALL> and <small>fNumbersAllowed</SMALL> custom properties.</P>
<p>Using ClassWizard, add the stock properties for the AxEdit control. Select the Automation tab and then click the Add Property button. Fill in the dialog box using the values provided in Table 18.2.</P>
<table width="100%"><td caption align="LEFT" colspan="2"><b>Table 18.2</B> Stock Properties for the AxEdit Control
<tr>
<td colspan="2"><hr>
<tr>
<th width="30%" align="LEFT" valign="TOP"><i>External name</I>
<th width="70%" valign="TOP" align="LEFT"><i>Implementation</I>
<tr>
<td colspan="2"><hr>
<tr>
<td valign="TOP" align="LEFT"><small>Font</SMALL>
<td valign="TOP" align="LEFT">Stock
<tr>
<td valign="TOP" align="LEFT"><small>Text</SMALL>
<td valign="TOP" align="LEFT">Stock
<tr>
<td colspan="2"><hr>
</TABLE>
<p><br></P>
<center>
<table border>
<tr>
<td><a href="18-01.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="18-03.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>