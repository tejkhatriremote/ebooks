<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:Files</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=4//-->
<!--PAGES=04-01//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="../ch03/03-14.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="04-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h2><a name="Heading1"></A><font color="#000077">Chapter 4<br>Files
</FONT></H2>
<p><b>In This Chapter</B></P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Using Windows 2000 File Systems <i>112</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Performing General File Operations <i>112</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Searching for Files <i>124</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Performing Other File Operations <i>131</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Using Asynchronous Input and Output <i>134</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Taking Advantage of the Encrypted File System <i>148</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Using File-Notification Functions <i>152</I></B>
</DL>
<p>This chapter discusses how files are used in applications written for Windows 2000. You&#146;ll learn about the basics of file input and output (I/O) and then move on to more advanced topics, such as asynchronous file I/O and using file I/O completion routines. This chapter also discusses searching for files and subscribing to notifications about file system changes.
</P>
<p>In addition, this chapter discusses the Encrypting File System, which is new in Windows 2000; it allows you to encrypt files on your hard drive.</P>
<table width="100%"><td valign="TOP" align="LEFT" width="5%"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch04/images/04-01i.jpg"><td valign="TOP" align="LEFT" width="95%">Along the way, several sample programs included on this book&#146;s CD-ROM will be presented, including examples that demonstrate how to use the Encrypting File System, asynchronous file I/O, file searching, and the file-notification functions.
</TABLE>
<h3><a name="Heading2"></A><font color="#000077">Using Windows 2000 File Systems</FONT></H3>
<p>Windows 2000 supports several types of file systems. Unlike some operating systems, each of these systems can be used on the same Windows 2000 installation. Also, the OS/2 High Performance File System (HPFS) no longer is supported. The file systems included with Windows 2000 are as follows:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>The File Allocation Table file system (FAT)</I>. Included for backward compatibility with MS-DOS and Windows files. FAT offers no security and has poor performance with large volumes. Also, minor errors can wipe out your entire volume. It has recently had several iterations of enhancements to make it more useful with today&#146;s larger disk sizes, but it&#146;s still the FAT file system.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>The New Technology File System (NTFS)</I>. Developed for Windows 2000. NTFS has excellent performance for large volumes. It also has excellent security and recovery functions. Windows 2000 includes new enhancements such as encryption and file quotas.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>The Compact Disc File System (CDFS)</I>. Included to support CD-ROMs, which are used in most Windows 2000 installations. In fact, most development tools, including Visual C&#43;&#43;, are delivered on CD-ROM.
</DL>
<h3><a name="Heading3"></A><font color="#000077">Performing General File Operations</FONT></H3>
<p>Windows 2000 has a rich set of functions used to interact with files. The most basic of these functions create, open, read, write, and delete files. The next few sections cover these functions and how they are used.
</P>
<h4 align="LEFT"><a name="Heading4"></A><font color="#000077">Collecting Volume Information</FONT></H4>
<p>Windows 2000 includes many different types of file systems. Each of these file systems has a different set of capabilities and features. In fact, just knowing the type of file system does not give you enough information to determine the features available on a specific volume. NTFS, the native file system used by Windows 2000, has been updated over the years to offer more features. Also, Windows 2000 systems can be configured to restrict features such as compression and file encryption.
</P>
<p>To discover all sorts of information about a disk volume, including whether a particular feature is supported, you can call the <small>GetVolumeInformation</SMALL> function:</P>
<!-- CODE SNIP //-->
<pre>
BOOL fInfo = GetVolumeInformation(pszVolumePath,
                                  szVolumeName,
                                  _MAX_PATH,
                                  &ampdwSerialNo,
                                  &ampdwMaxComponent,
                                  &ampdwFileSysFlags,
                                  szFileSystemName,
                                  _MAX_PATH);
</PRE>
<!-- END CODE SNIP //-->
<p><small>GetVolumeInformation</SMALL> has eight parameters:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;The path to the root of the volume.
<dd><b>&#149;</B>&nbsp;&nbsp;The address of a buffer that <small>GetVolumeInformation</SMALL> will fill with the volume&#146;s label. If you&#146;re not interested in the volume name, you can pass <small>NULL</SMALL> as this parameter.
<dd><b>&#149;</B>&nbsp;&nbsp;The size of the buffer passed in the second parameter (in characters, not bytes). This parameter is ignored if <small>NULL</SMALL> is passed as the second parameter.
<dd><b>&#149;</B>&nbsp;&nbsp;The address of a <small>DWORD</SMALL> that will be filled with the volume&#146;s serial number. If you aren&#146;t interested in the serial number, pass <small>NULL</SMALL> as this parameter.
<dd><b>&#149;</B>&nbsp;&nbsp;The address of a <small>DWORD</SMALL> that will be filled with the maximum size of filename components. This indicates the maximum size of text elements that make up a filename. If you aren&#146;t interested in the maximum component size, pass <small>NULL</SMALL> as this parameter.
<dd><b>&#149;</B>&nbsp;&nbsp;The address of a <small>DWORD</SMALL> that contains flags specifying the capabilities of the file system installed on the volume. The different values for the file system flags are provided in the following section. As with the other parameters, you can pass <small>NULL</SMALL> as this parameter if you&#146;re not interested in this information.
<dd><b>&#149;</B>&nbsp;&nbsp;The address of a buffer that the function will fill with the name of the file system. As with the other parameters, you can pass <small>NULL</SMALL> as this parameter if you&#146;re not interested in this information.
<dd><b>&#149;</B>&nbsp;&nbsp;The size of the previous parameter, in characters. This parameter is ignored if the previous parameter was <small>NULL</SMALL>.
</DL>
<h4 align="LEFT"><a name="Heading5"></A><font color="#000077">File System Flags</FONT></H4>
<p>The following file system flags are returned from a call to <small>GetVolumeInfo</SMALL> to indicate features available in the file system:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FS_CASE_IS_PRESERVED</SMALL>. Files stored in the file system retain their original case.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FS_CASE_SENSITIVE</SMALL>. Files can be stored with mixed-case names.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FS_UNICODE_STORED_ON_DISK</SMALL>. Filenames are stored in Unicode on disk.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FS_PERSISTENT_ACLS</SMALL>. ACLs are stored (and enforced) in the file system.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FS_FILE_COMPRESSION</SMALL>. Individual files in the file system can be compressed.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FS_VOL_IS_COMPRESSED</SMALL>. The volume is compressed.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FILE_SUPPORTS_ENCRYPTION</SMALL>. Files stored in the file system can be encrypted.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FILE_SUPPORTS_OBJECT_IDS</SMALL>. Object IDs can be stored in the file system.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FILE_SUPPORTS_REPARSE_POINTS</SMALL>. Reparse points are supported by the file system.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FILE_SUPPORTS_SPARSE_FILES</SMALL>. Sparse files are supported.
<dd><b>&#149;</B>&nbsp;&nbsp;<small>FILE_VOLUME_QUOTAS</SMALL>. Disk quotas are supported.
</DL>
<p><br></P>
<center>
<table border>
<tr>
<td><a href="../ch03/03-14.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="04-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>