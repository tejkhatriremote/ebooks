<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:An Introduction to COM[TITLE]#43; Services</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=21//-->
<!--PAGES=687-691//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="21-02.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="21-04.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<p>In reality, the priest is the transaction coordinator. The bride and groom are the resources, which in most cases will be databases as shown in the following diagram.
</P>
<p><a name="Fig2"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-02.jpg',226,115 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-02t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-02.jpg',226,115)"><font color="#000077"><b>Figure 21.2</B></FONT></A>&nbsp;&nbsp;Various pieces involved in a two-phase commit.</P>
<p>Unlike a marriage, the resources do not initiate the two-phase commit. In Figure 21.2 there is some business logic that has performed some action on the resource. It communicates with the transaction coordinator and initiates the two-phase commit. Here are the components involved in a two-phase commit:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Local prepare</I>. Each local resource prepares for the commit.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Distributed prepare</I>. A prepare request is sent to each transaction&#146;s outgoing session.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Decide</I>. If all vote yes and all outgoing sessions vote yes, then a durable transaction commit record is written that states the transaction managers and the resource managers.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Commit</I>. Each resource is invoked and informed of the voting commit outcome; then the message is sent on the outgoing transaction session.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Complete</I>. When all resources have acknowledged the commit message, a complete commit log record is written. When the message is durable, the resources needed for the transaction are freed.
</DL>
<h3><a name="Heading6"></A><font color="#000077">Understanding Transactions Within COM&#43;</FONT></H3>
<p>Now let&#146;s consider the bigger picture of COM&#43; services&#151;the middle tier of three-tiered systems (see Figure 21.3).
</P>
<p><a name="Fig3"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-03.jpg',263,201 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-03t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-03.jpg',263,201)"><font color="#000077"><b>Figure 21.3</B></FONT></A>&nbsp;&nbsp;Three-tiered COM&#43; application system.</P>
<p>In this diagram, you see three main functional layers. (I use the word <i>functional</I> because it does not imply that each layer is assigned to a physical computer.) N-tier computing is many client/server systems put together. For example, when the client communicates to the business logic, it will use COM. And when the COM components talk to the database, it will be using the resource protocol. There are two client/server systems in this N-tier system. The glue between is called <i>middleware</I>, which can be COM, HTTP, or anything that moves data from one physical location to another. In this book, there&#146;s not much of a discussion of middleware because it&#146;s assumed to exist.</P>
<p>The three layers are defined as follows:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Presentation</I>. The presentation layer is the layer that interacts with the user. At this layer, the user interface is presented. The user interface is neither thin nor dumb. It contains the necessary logic to perform its task. Also, the user interface may be physically big. For example, a graph control that maps the prices of competitors for the past year is not a lightweight control in terms of bytes. In terms of function, it is lightweight, because it does not modify the prices and does not attempt to comprehend the business process. An optimization for saving network communication costs involves adding some simple data-validation rules at this layer.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Business logic</I>. This layer is &#147;GUI-less&#148; and processes the information passed to it from the presentation layer. It contains the business rules required to manage the application. It provides a usable interface to the data services layer. At this layer, the business process is responsible for consolidating the various data sources. This layer does not contain data; rather, it processes data.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Data services</I>. This layer is a statement management layer. It provides the persistence of the data that&#146;s processed at the business logic layer. This layer is called <i>data services</I> because the data can be stored within a spreadsheet, email system, database, or even persistent business objects.
</DL>
<p>The middle tier implements the transactions using the architecture shown in Figure 21.4.
</P>
<p><a name="Fig4"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-04.jpg',199,143 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-04t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-04.jpg',199,143)"><font color="#000077"><b>Figure 21.4</B></FONT></A>&nbsp;&nbsp;The architecture of the middle tier.</P>
<p>In this chapter, we&#146;ll write COM objects that exist as COM&#43; applications. You should understand that a COM object is an individual object that has been exposed to the COM layer. A COM component is one or more COM objects bundled as a binary package, called a dynamic link library (DLL).
</P>
<h4 align="LEFT"><a name="Heading7"></A><font color="#000077">COM&#43; Application</FONT></H4>
<p>In Windows 2000, MTS and COM&#43; have been integrated; they&#146;re now one and the same. The integration goes beyond a simple transaction context; it extends into an infrastructure concept. When various COM objects are combined using a logical business process concept, it&#146;s called a COM&#43; application. The COM&#43; application isn&#146;t dependent on any COM component. It&#146;s a grouping that can be done at the administrative level.
</P>
<p>Why the grouping? When a COM&#43; application is created, a context is also created. Whenever any COM object is instantiated, it&#146;s shielded with a context. This architecture is called <i>interception</I> and is illustrated in Figure 21.5.</P>
<p><a name="Fig5"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-05.jpg',201,179 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-05t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-05.jpg',201,179)"><font color="#000077"><b>Figure 21.5</B></FONT></A>&nbsp;&nbsp;Interception architecture.</P>
<p>The purpose of interception is to act as a middle entity between the consumer and the COM object itself. The middle entity is a context. Having a context makes it possible to control all aspects of the COM object and for the COM object to know how it&#146;s being manipulated, all without code being added. For example, because the middle entity understands that the COM object is transaction based, it can start a transaction. On the other hand, if the COM object were to crash, the context can abort the transaction automatically. This is helpful because any consumer of the COM object will not crash. The consumer will only get the message that the COM object has crashed. This promotes stability.
</P>
<p><font size="+1"><b>The Distributed Transaction Coordinator</B></FONT></P>
<p>The context is not responsible for managing the transaction, and it isn&#146;t responsible for managing the two-phase commit. This is the responsibility of the Distributed Transaction Coordinator (DTC), as shown in Figure 21.6.
</P>
<p><a name="Fig6"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-06.jpg',227,151 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-06t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-06.jpg',227,151)"><font color="#000077"><b>Figure 21.6</B></FONT></A>&nbsp;&nbsp;Architecture of DTC and COM&#43; objects.</P>
<p>When a context is started and transaction support is desired, the context will connect to a transaction. This transaction may be new, or it may already exist from the consumer COM object. This transaction is connected to the DTC. It provides the wiring between the various COM objects and the resources. For example, if the new COM object were to access another resource or modify an existing resource, those actions will be part of the overall transaction. Of course, the DTC does not do this in isolation. It gets help from the individual resource managers and resource dispensers.
</P>
<p><b>Resource Dispensers</B></P>
<p>Consider the situation of sitting in a restaurant and ordering a meal. A waiter will typically take your order and relay that order to the kitchen. The kitchen will make the meal, and the waiter will give you the meal once it&#146;s ready from the kitchen. In effect, the waiter is acting as a way of accessing the kitchen resource. The waiter is a <i>resource dispenser</I>. The COM object is the person being waited on. The COM object, when it connects to the resource, has no idea where the resource comes from&#151;it just gets the information. The waiter does the same thing. The food, for that matter, could be shipped in from several time zones away. The COM object can do with the data what it wants. Likewise, a waiter does not care whether you eat the food or dance the dance of two-thousand scarves on it. The resource dispenser just manages the various connections and tries to optimize access to the resource. Examples are the Shared Memory and ODBC resource dispensers.</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="21-02.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="21-04.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>