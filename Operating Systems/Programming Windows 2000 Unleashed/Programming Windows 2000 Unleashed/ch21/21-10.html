<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:An Introduction to COM[TITLE]#43; Services</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=21//-->
<!--PAGES=716-721//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="21-09.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="21-11.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
</P>
<p><b>Advanced Tab</B></P>
<p>The third tab on the Bookstore Properties dialog box is the Advanced tab. Under this tab, you have the following features (see Figure 21.17):</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Server Process Shutdown</I>. When a COM object is accessed, the application is hosted by a process. You can define when the process shuts down and releases all its resources. When the radio button Leave Running when Idle is selected, the process will remain. This has the advantage of quicker response time initially. By selecting the Minutes Until Idle Shutdown radio button, you can define a shutdown to occur after a specific amount of time. The advantage to this option is that resources can be conserved. The timeout has the advantage of saving the initialization performance loss if there&#146;s a lull in traffic. A timeout value of zero tells the component to never shut down.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Permission</I>. Checking the boxes in this area specifies that scripts and other applications cannot delete and change the COM&#43; application.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Debugging</I>. Makes it possible to launch the application directly into a debugger.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Enable Compensating Resource Managers</I>. When resources that do not support transactions are used, a CRM makes it possible for a resource to participate within the two-phase commit.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Enable 3GB support</I>. Makes it possible for the COM object developer to access 3GB of memory when using the Windows 2000 Enterprise edition.
</DL>
<p><a name="Fig17"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-17.jpg',404,447 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-17t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-17.jpg',404,447)"><font color="#000077"><b>Figure 21.17</B></FONT></A>&nbsp;&nbsp;COM&#43; application advanced properties.</P>
<p><b>Identity Tab</B></P>
<p>The Identity tab was already discussed when the package was created.</P>
<p><b>Activation Tab</B></P>
<p>The fifth tab on the Bookstore Properties is the Activation tab. Under this tab, you have the following features:</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Activation Type</I>. Specifies how the component is activated. A library activation will put the component within the process space of the library process. The only catch with this is that the process must be running on the same machine as the COM object. The components also have less functionality. When Server Activation is specified, the COM&#43; environment provides the hosting process. This is the preferred technique, because it provides access to all the COM&#43; services.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Remote Server</I>. At the time of this writing, the purpose was not fully documented. In the release version it should be documented in the COM&#43; administration help file.
</DL>
<p><b>Queuing Tab</B></P>
<p>The final tab on the Bookstore Properties dialog box is the Queuing tab. Under this tab, you have the following feature (see Figure 21.18):</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Queuing properties</I>. This works only for COM objects that support the queuing concept. When a package is specified as &#147;queued,&#148; the COM objects marked queuable within the application can receive messages. To mark a package as queuable, check the Queued check box. To set up a listener, check the Listen check box. This will start up the process and wait for requests.
</DL>
<p><a name="Fig18"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-18.jpg',402,447 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-18t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-18.jpg',402,447)"><font color="#000077"><b>Figure 21.18</B></FONT></A>&nbsp;&nbsp;COM&#43; application queuing properties.</P>
<p><font size="+1"><b>Adding a Component</B></FONT></P>
<p>The next step is the addition of the component within the application. You can do this by double-clicking the newly created application node, BookStore. Two subnodes appear: Components and Roles. Select the Components node and then right-click it. From the pop-up menu, select New, Component. Again, a wizard appears. This time, the wizard helps you register a component within the application. Press the Next button and the dialog box shown in Figure 21.19 will appear.
</P>
<p><a name="Fig19"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-19.jpg',501,385 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-19t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-19.jpg',501,385)"><font color="#000077"><b>Figure 21.19</B></FONT></A>&nbsp;&nbsp;Starting the COM&#43; Component Install Wizard.</P>
<p>This dialog box has two options:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Install new components</I>. This option allows you to install COM objects resident within a COM component. The COM component will be added to the COM&#43; application by searching and loading the DLL.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Import components that are already registered</I>. This option allows you to install COM objects based on their ProgID within the Registry. It assumes the COM object is already registered.
</DL>
<p>Select the Install New Components button.
</P>
<p>The File Finder dialog will appear first. Select a file and click OK. A File common dialog box appears. Find the VBBookStore DLL and click OK. The following dialog box will appear (see Figure 21.20).</P>
<p>Click the Next button and then the Finish button. The COM Explorer is shown in Figure 21.21.</P>
<p><a name="Fig20"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-20.jpg',503,384 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-20t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-20.jpg',503,384)"><font color="#000077"><b>Figure 21.20</B></FONT></A>&nbsp;&nbsp;COM&#43; objects.</P>
<blockquote>
<p><font size="-1"><hr><b>Tip:&nbsp;&nbsp;</B>
<p>Figure 21.20 does not show this problem, but if classes are appearing that shouldn&#146;t, it&#146;s because the <small>Instancing</SMALL> property is set incorrectly. To solve this problem, set the <small>Instancing</SMALL> to <small>Private</SMALL>. This makes sure the class will not be generated within the type library. This is not defined to be external because it may do things that are not COM friendly. An example would be not setting the transaction attributes properly.</P>
</FONT><hr>
</BLOCKQUOTE>
<p><a name="Fig21"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-21.jpg',632,558 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-21t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-21.jpg',632,558)"><font color="#000077"><b>Figure 21.21</B></FONT></A>&nbsp;&nbsp;The newly registered COM&#43; object.</P>
<p><font size="+1"><b>Inspecting the COM Object</B></FONT></P>
<p>The next step is to inspect the various settings of the COM object. Right-click the object and select Properties from the pop-up menu.
</P>
<p><b>Transaction/Concurrency Tab</B></P>
<p>Under the Transaction/Concurrency tab, you&#146;ll find the following features (see Figure 21.22):</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Threading model</I>. This indicates the threading model that the COM object executes in.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Transaction support</I>. A check box that defines whether a transaction context will be defined. This attribute can be set manually or, as in our example, retrieved from the COM object itself and preset. The following options are possible:
<dl>
<dd><i>Ignored</I>. Any active transactions are ignored and not used.
<dd><i>Not Supported</I>. The component does support transactions.
<dd><i>Required</I>. A transaction context is required. If it exists, as from a call originating within another transaction, it will be used. Otherwise, a new transaction is started.
<dd><i>Requires New</I>. A new transaction is started regardless if one already exists. Do not confuse this with nesting, because the new transaction outcome does not impact any other currently running transaction.
<dd><i>Supported</I>. If there&#146;s a transaction from another object call, it is used;otherwise, the component runs without a transaction context.
</DL>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Synchronization</I>. This concept has not yet been discussed, but it will be discussed in detail in the next chapter. When a COM object is used within a COM&#43; context, the object needs to be stateless. It will use JIT activation and ASAP deactivation. This means that the component can be reused prematurely. Synchronization makes it possible to define how JIT activation is defined. The terms JIT and ASAP relate to how a COM object is referenced, which is explained in Chapter 22, &#147;Building Components for COM&#43; Services.&#148; In cases where transactions are involved, options that aren&#146;t possible are disabled.
</DL>
<p><a name="Fig22"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-22.jpg',404,447 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-22t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-22.jpg',404,447)"><font color="#000077"><b>Figure 21.22</B></FONT></A>&nbsp;&nbsp;COM&#43; object transaction/synchronization/concurrency properties.<p><br></P>
<center>
<table border>
<tr>
<td><a href="21-09.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="21-11.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>