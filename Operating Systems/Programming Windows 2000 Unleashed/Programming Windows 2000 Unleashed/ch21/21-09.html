<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:An Introduction to COM[TITLE]#43; Services</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=21//-->
<!--PAGES=711-715//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="21-08.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="21-10.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h4 align="LEFT"><a name="Heading10"></A><font color="#000077">What Has Been Shown?</FONT></H4>
<p>The preceding component uses good MTS programming style. Here are some reasons why:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;In general, values are not passed in using methods. Instead, they&#146;re set and retrieved using properties. As a result, they&#146;re more flexible and allow for simpler programming because you don&#146;t need to remember mile-long method calls. Using queued components incurs no performance hit when executing over a network.
<dd><b>&#149;</B>&nbsp;&nbsp;The database connection and transaction context are created and retrieved on a per-method basis. This means that resources are acquired late and released quickly. For MTS, this ensures scalability, because the component is stateless.
<dd><b>&#149;</B>&nbsp;&nbsp;The general ADO libraries are adapted to solving the problem in the domain. As a result, writing application code is quicker and requires less testing.
</DL>
<p>The first and last reasons are self explanatory, but the second one requires some more explanation, which is given in the next chapters.
</P>
<h4 align="LEFT"><a name="Heading11"></A><font color="#000077">Adding Components to a COM&#43; Application</FONT></H4>
<p>Now that the component has been compiled, it&#146;s ready to be added to a COM&#43; application. A COM&#43; application provides a way of grouping COM objects to form an application.
</P>
<blockquote>
<p><font size="-1"><hr><b>Note:&nbsp;&nbsp;</B><p>Note that at the time of this writing, the build of Windows 2000 was 1946. Therefore, the released edition may have features not available at the time of writing.
</P>
</FONT><hr>
</BLOCKQUOTE>
<p><font size="+1"><b>Creating an Application</B></FONT></P>
<p>Start the Component Services Explorer. The dialog box shown in Figure 21.12 will appear.
</P>
<p>In the Explorer view under the node COM&#43; applications, you&#146;ll find all the applications that use some of the services COM&#43; offers. The individual nodes represent applications. In previous versions of MTS, they were called <i>packages</I>. It&#146;s not recommended that you create applications that contain all the COM objects. The application concept does support <i>nesting</I>. This means that an application could theoretically contain thousands of COM objects. You should package an application according to a domain.</P>
<p><a name="Fig12"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-12.jpg',228,201 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-12t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-12.jpg',228,201)"><font color="#000077"><b>Figure 21.12</B></FONT></A>&nbsp;&nbsp;Component Services Explorer.</P>
<p>To create a new package, select the node COM&#43; applications and right-click. From the pop-up menu, select New, Application. This starts the COM Application Install Wizard. Click the Next button. The dialog box shown in Figure 21.13 will appear.
</P>
<p><a name="Fig13"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-13.jpg',181,138 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-13t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-13.jpg',181,138)"><font color="#000077"><b>Figure 21.13</B></FONT></A>&nbsp;&nbsp;Starting a COM&#43; application.</P>
<p>You have two options for creating a new package:
</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Prebuilt application</I>. This installs an application that has been built using the application <small>export</SMALL> command.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Empty application</I>. This installs an empty application that does not contain any COM objects.
</DL>
<p>Press the Empty Application button. The next dialog box specifies the name of the application (see Figure 21.14).
</P>
<p><a name="Fig14"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-14.jpg',181,138 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-14t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-14.jpg',181,138)"><font color="#000077"><b>Figure 21.14</B></FONT></A>&nbsp;&nbsp;Identifying a COM&#43; application name.</P>
<p>In the text box labeled Enter a Name for the New Application, enter <b>BookStore</B>. There are two option buttons used to specify whether the application will run within Server Application process space or within the Library process space. The default is Server Application process space, which means that COM&#43; services will manage the process. You can specify the library process space, but doing so limits the functionality. Click the Next button and the security settings will appear. You need to specify which user security attributes will be used to execute the application. Currently, this is set to Interactive User. In a debugging situation, this setting is okay. It&#146;s recommended, though, that the user be given local administrative authority. This helps avoid problems in the future. However, do not use this in a production setting; you&#146;ll then need to carefully consider the various options. Click the Next button. The dialog box presents a thank-you message. Click Finish to create the application.</P>
<p><font size="+1"><b>Inspecting the Application Properties</B></FONT></P>
<p>The next step is to inspect the various settings of the application. Right-click the BookStore node and select Properties from the pop-up menu. This causes the BookStore Properties dialog box to appear. This dialog box has several tabs, which are discussed in the following sections.
</P>
<p><b>General Tab</B></P>
<p>The first tab on the Bookstore Properties dialog box is the General tab. Under this tab, you have the following features (see Figure 21.15):</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Bookstore</I> defines the name of the package. This can be edited.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Description</I> is a description of the package.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Application ID</I> is the GUID used to identify the application. You can use this to debug Visual C&#43;&#43; components.
</DL>
<p><a name="Fig15"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-15.jpg',145,161 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-15t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-15.jpg',145,161)"><font color="#000077"><b>Figure 21.15</B></FONT></A>&nbsp;&nbsp;General COM&#43; application properties.</P>
<p><b>Security Tab</B></P>
<p>The next tab on the Bookstore Properties dialog box is the Security tab. Under this tab, you have the following features (see Figure 21.16):</P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Authentication level</I>. This identifies the amount of security used when packets of information are exchanged among the various COM&#43; applications, clients, and so on. The combo box is sorted from lowest level to highest level.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Impersonation level</I>. When a client makes a connection to the COM&#43; application, it has an associated security token. When the COM&#43; application accesses resources, it can impersonate the user. How it does this depends on the setting.
<br>Here are the available options:
<dl>
<dd><i>Default</I>. The machine-wide impersonation level is used.
<dd><i>Anonymous</I>. The server security token is anonymous and does not contain any information regarding the client.
<dd><i>Identity</I>. The server security token is identical to the client making the access to the COM&#43; application.
<dd><i>Impersonate</I>. This is identical to Identity, with some restrictions.
<dd><i>Delegate</I>. The server can pass around the client credentials to any other machine.
</DL>
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Security level</I>. When a client accesses a COM&#43; application, the security can be enforced at the application level or at the application and component levels.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Enforce application-level access checks</I>. COM&#43; authenticates the user according to the role assigned to the user when accessing the COM object. Roles offer the advantage of specifying various users in groups.
<dd><b>&#149;</B>&nbsp;&nbsp;<i>Use process access permissions</I>. The Windows NT ACL is used to perform security checks when the COM objects are accessed. COM&#43; library applications cannot use this type of security. It&#146;s recommended that you set up a role-based security mechanism.
</DL>
<p><a name="Fig16"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-16.jpg',145,161 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-16t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-16.jpg',145,161)"><font color="#000077"><b>Figure 21.16</B></FONT></A>&nbsp;&nbsp;COM&#43; application security properties.<p><br></P>
<center>
<table border>
<tr>
<td><a href="21-08.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="21-10.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>