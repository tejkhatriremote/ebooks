<html>
<head>
<meta name=vsisbn content="067231486x">
<meta name=vstitle content="Programming Microsoft Windows 2000 Unleashed">
<meta name=vsauthor content="MICKEY WILLIAMS">
<meta name=vsimprint content="Sams">
<meta name=vspublisher content="Macmillan Computer Publishing">
<meta name=vspubdate content="06/21/99">
<meta name=vscategory content="Operations Systems: Windows 2000">



<title>Programming Microsoft Windows 2000 Unleashed:An Introduction to COM[TITLE]#43; Services</TITLE>
<!-- BEGIN HEADER -->
<meta name="ROBOTS" content="NOINDEX, NOFOLLOW">
<script>
<!--
function displayWindow(url, width, height) {
        var Win = window.open(url,"displayWindow",'width=' + width +
',height=' + height + ',resizable=1,scrollbars=yes');
}
//--></SCRIPT>

<!-- HEADER -->
<style type="text/css">
<!--
A:hover { color:red }
-->
</STYLE>

<!-- HEADER -->
<style type="text/css"> 
 <!--
 A:hover  {
 	color : Red;
 }
 -->
 </STYLE>

</HEAD>
<BODY bgcolor=#FFFFFF><FONT size=2 face="Arial, verdana, helvetica"><table width=100% border=0 cellspacing=0 cellpadding=2><tr bgcolor=#000000><td width=100% align=right><b><font color=#FFFFFF>Gotcha</font></b></td></tr></table><br><!--Begin Content Column -->

<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td width=75 valign=top>
<img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/images/sm_covers/067231486x.gif" width=60 height=73 alt="Programming Microsoft Windows 2000 Unleashed" border="1">
</td>
<td align="left">
    <font face="arial, helvetica" size="-1" color="#336633"><b>Programming Microsoft Windows 2000 Unleashed</b></font>
    <br>
    <font face="arial, helvetica" size="-1"><i>by MICKEY WILLIAMS</i>
    <br>
    Sams,&nbsp;Macmillan Computer Publishing
    <br>
    <b>ISBN:</b>&nbsp;067231486x<b>&nbsp;&nbsp;&nbsp;Pub Date:</b>&nbsp;06/21/99</font>
</td>
</tr>
</table>
<p>
<!-- Empty Reference Subhead-->

<!--ISBN=067231486x//-->
<!--TITLE=Programming Microsoft Windows 2000 Unleashed//-->
<!--AUTHOR=Mickey Williams//-->
<!--PUBLISHER=Macmillan Computer Publishing//-->
<!--IMPRINT=sams//-->
<!--CHAPTER=21//-->
<!--PAGES=679-684//-->
<!--UNASSIGNED1//-->
<!--UNASSIGNED2//-->

<center>
<table border>
<tr>
<td><a href="../ch20/20-11.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="21-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>
<p><br></P>
<h2 align="CENTER"><font color="#000077"><i>Part IV<br>COM&#43;
</I></FONT></H2>
<p><big><b>In This Part</B></BIG></P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>An Introduction to COM&#43; Services <i>681</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Building Components for COM&#43; Services <i>727</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Using COM&#43; with the IIS <i>765</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Using the COM&#43; In-Memory Database <i>821</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Advanced COM&#43; Services <i>841</I></B>
</DL>
<h2><a name="Heading1"></A><font color="#000077">Chapter 21<br>An Introduction to COM&#43; Services
</FONT></H2>
<p><big><b>In This Chapter</B></BIG></P>
<dl>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Introducing Transactions <i>682</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Understanding Transactions Within COM&#43; <i>688</I></B>
<dd><b>&#149;</B>&nbsp;&nbsp;<b>Building a Transactionable COM&#43; Component <i>692</I></B>
</DL>
<p>This is the first chapter of the COM&#43; services section. This chapter is an introduction to the transaction aspect of COM&#43; services. To start the chapter, an introduction into transactions and their workings is given. You need to understand how transactions function; otherwise, you won&#146;t understand why the COM&#43; components are written the way they are. Then a simple component is shown using Visual Basic. This simple component expands on how to write code that interacts with its resource. Also, notice the terminology used&#151;the word <i>MTS</I> is absent. The reason is because COM&#43; services are an evolution of MTS.</P>
<h3><a name="Heading2"></A><font color="#000077">Introducing Transactions</FONT></H3>
<p>Source: Webster&#146;s Revised Unabridged Dictionary (1913) [web1913]
</P>
<p><b>transaction</B> \Trans*ac&#146;tion\, n. [L. transactio, fr. transigere, transactum, to drive through, carry through, accomplish, transact; trans across, over &#43; agree to drive; cf. F. transaction.</P>
<dl>
<dd><b>1.</B>&nbsp;&nbsp;The doing or performing of any business; management of any affair; performance.
<dd><b>2.</B>&nbsp;&nbsp;That which is done; an affair; as, the transactions on the exchange.
<dd><b>3.</B>&nbsp;&nbsp;(Civil Law) An adjustment of a dispute between parties by mutual agreement.
</DL>
<p>The dictionary states that a transaction means <i>to carry through</I>. It&#146;s the act of completing something 100 percent. This is absolutely important, because a transaction ensures completeness.</P>
<p>Consider, for example, a bank. You go to the nearest ATM machine and decide to get some money. Here are the steps you follow:</P>
<dl>
<dd><b>1.</B>&nbsp;&nbsp;Insert your card into the ATM.
<dd><b>2.</B>&nbsp;&nbsp;Punch in your PIN number.
<dd><b>3.</B>&nbsp;&nbsp;Decide the amount of money to withdraw.
<dd><b>4.</B>&nbsp;&nbsp;Press Validate to process the transaction.
<dd><b>5.</B>&nbsp;&nbsp;The account is debited by the requested amount.
<dd><b>6.</B>&nbsp;&nbsp;Remove your card from the machine.
<dd><b>7.</B>&nbsp;&nbsp;Remove the money from the machine.
</DL>
<p>All these steps are one transaction. Imagine a case in which the ATM delays the debiting of your account, and it fails. When the ATM has given you your money, it cannot run after you and ask for it back to retry the transaction. This is a very important fact about transactions. Once a transaction has been carried through, it cannot be rolled back. Although you may think the worst part of this failure is that the bank loses money, it is, in fact, worse. What happens is that money is produced. Money is produced because the transaction has debited from its ledgers a specific sum of money. And yet you hold money in your hand. Therefore, if you take that money and deposit it in your account, those money bills are considered new. This is illegal, since only governments can produce money.
</P>
<p>As a reference for later sections, consider the following diagram shown in Figure 21.1.</P>
<p><a name="Fig1"></A><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-01.jpg',212,139 )"><img webstripperattrwas="src" webstripperlinkwas="http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-01t.jpg"></A>
<br><a href="javascript:displayWindow('../WebStripper/protected.html#link=http://corpitk.earthweb.com/reference/pro/067231486x/ch21/images/21-01.jpg',212,139)"><font color="#000077"><b>Figure 21.1</B></FONT></A>&nbsp;&nbsp;Sample transactions involving two people and two accounts.</P>
<p>This sample transaction is an example of three different transactions. The first is the taking of money and then crediting an account. The second transaction is when an account is debited and then another account is credited a certain amount of money. The last transaction is the debiting of an account of a sum and then the paying of that sum in cash. Through all these transactions, money is never created or lost. This is important, because even if the money is electronic, it must be accounted for.
</P>
<h4 align="LEFT"><a name="Heading3"></A><font color="#000077">ACID: The Four Commandments of Transaction Processing</FONT></H4>
<p>ACID is an acronym for the four commandments of a transaction system. These commandments are atomicity, consistency, isolation, and durability. Unlike other systems, where certain parts of the system are exempt from certain rules, in a transaction-based system, everything must play by the rules&#151;this includes the transaction system, the server components, and the client components. Shortcuts and hacks are not tolerated and will cause problems in the long term of the development. A transaction system is like a chain, which is only as strong as its weakest link.
</P>
<p><font size="+1"><b>Atomicity</B></FONT></P>
<p>In the first example of representing a transaction, the requirement was for the account to be successfully debited a certain amount of money. If that transaction were to be interrupted or a crash were to occur, the transaction must fail. If the transaction fails, the person doing the withdrawal expects the account to remain at the same level. <i>Atomicity</I> requires that either the transaction commits or aborts. With either a success or failure, it&#146;s absolutely imperative that the state be maintained. It&#146;s a winner-take-all situation.</P>
<p>Sidestepping the main topic for a moment, in a static building design class exam, the following statement was made: Getting 85 percent of the question right does not mean you get 85 percent of the marks. A bridge that&#146;s 85 percent correct will still fall. Therefore, you must either get 100 percent correct or nothing. This is a hard way to grade exams, but it&#146;s the truth. Transaction code must be written to the same harsh reality.</P>
<p><font size="+1"><b>Consistency</B></FONT></P>
<p>Consistency doesn&#146;t mean a correct program. Consistency is the application of a consistent methodology. When money is loaned from a bank or deposited, interest is calculated. The interest is either for you or against you. A problem with interest is that half cents cannot be paid or collected. Therefore, the amount must be to the nearest cent. The value must be rounded off. Rounding off is not a simple issue, because there are two ways of doing it&#151;rounding up or rounding down. In most cases, the banks round either up only or down only. It makes it simple and consistent. What would be incorrect for the bank is to round down when paying interest and round up when collecting interest. That would be inconsistent.
</P>
<p>Consistency is a much-desired aspect of writing transaction code, because, with a consistent state, it&#146;s predictable to say, when an account is credited a sum of money, it always gets the same amount. When interest is calculated, it&#146;s always calculated the same way. This way, when a transaction is finalized, the end result will always be the same. Consistency cannot be enforced by the transaction system. Good testing and good programming techniques can only enforce consistency. A good way of enforcing consistency is to document your rules and business processes.</P><p><br></P>
<center>
<table border>
<tr>
<td><a href="../ch20/20-11.html">Previous</A></TD>
<td><a href="../ewtoc.html">Table of Contents</A></TD>
<td><a href="21-02.html">Next</A></TD>
</TR>
</TABLE>
</CENTER>


</font></BODY></HTML>