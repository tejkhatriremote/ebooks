<HTML>
<HEAD>
      <TITLE>Perl</TITLE>
</HEAD>
<BODY>
<br>
**************************************************
<BR>Perl for Win32 on Win95 (and some NT)
<BR>by <A HREF="mailto:Keydet89@yahoo.com">Keydet89@yahoo.com</A>

<P>[Purpose of this article]
<BR>[What is Perl?]
<BR>[Where do I get Perl?]
<BR>[Where can I find more information regarding Perl?]
<BR>[What can I do with Perl?]

<P>[Purpose of this article]

<P>The purpose of this article is to be instructional in nature.&nbsp;
This
<BR>article is directed toward Windows-oriented systems administrators
<BR>who have never heard of or used Perl, but it will also be useful to
<BR>other
<BR>people, such as systems administrators who are experienced with Unix
<BR>and Perl, but new to Windows.&nbsp; Individuals who work with large
amounts
<BR>of text or perform basic systems administration tasks on Win95 or NT
<BR>will also find this useful.

<P>This article is not meant to be a tutorial on programming in Perl,
<BR>primarily because there are so many other texts available that are
<BR>excellent tutorials.&nbsp; This article is meant simply to show the
<BR>utility in Perl, and to spark the reader's interest in finding more
<BR>information regarding Perl.&nbsp;&nbsp; After all, isn't the insatiable
desire
<BR>to learn one of the marks of a hacker?

<P>It should be noted that the information in this article, when combined
<BR>with an active imagination, could potentially be used for less than
<BR>honorable purposes.&nbsp; Inasmuch, it is the author's opinion that
it is
<BR>best to make information on tools and techniques available for
<BR>public consumption, because security through obscurity is no security
<BR>at all.

<P>[What is Perl?]

<P>Larry Wall, Perl's author, describes Perl as follows:
<BR>"Perl is an interpreted language optimized for scanning arbitrary text
<BR>files, extracting information from those text files, and printing
<BR>reports based on that information. It's also a good language for many
<BR>system management tasks. The language is intended to be practical
<BR>(easy to use, efficient, complete) rather than beautiful (tiny,
<BR>elegant, minimal)."
<BR>[**this definition was taken from:
<BR><A HREF="http://language.perl.com/info/synopsis.html">http://language.perl.com/info/synopsis.html</A>]

<P>Perl is an interpretted language, meaning that instead of compiling
<BR>the source file&nbsp; into an executable file, the file is interpretted
<BR>by the interpretor at run time.&nbsp; The interpretor calls upon platform
<BR>dependant libraries in order to execute the commands that make up
<BR>the source file, or script.&nbsp; Perl programs are generally referred
to
<BR>as scripts.

<P>As with other languages, there are naming conventions for Perl files.
<BR>Perl modules (more on modules later) have the ".pm" extension.&nbsp;
Scripts
<BR>generally have the ".pl" extension, but you will often see the ".plx"
<BR>extension identifying the file as an executable script.&nbsp; If you
intend
<BR>to write scripts for public consumption, it is a good idea to follow
<BR>a convention in programming, so that other folks will be able to
<BR>understand your scripts without having to contact you for lengthy
<BR>explanations.

<P>The program "perl.exe" is the interpretor.&nbsp; You run Perl scripts
by
<BR>calling
<BR>the interpertor, then the script you want to run, followed by any
<BR>arguements that you wish to pass to the script.

<P>[Where do I get Perl?]

<P>The binaries for Perl on Win32 can be obtained from:
<BR><A HREF="http://www.perl.com/CPAN-local/ports/win32/Standard/x86/">http://www.perl.com/CPAN-local/ports/win32/Standard/x86/</A>

<P>As of this writing, the particular file of interest is:
<BR>perl5.00402-bindist04-bc.zip

<P>Be sure to read the associated readme file:
<BR>perl5.00402-bindist04-bc.readme

<P>[How do I install Perl on Win95?]
<BR>The binary distribution of Perl is a 5.9Mb file, so be prepared for
<BR>a wait in downloading (and it's worth it!&nbsp; While you are waiting,
read
<BR>through some back issues of GTMHH and the Happy Hacker Digest!!).

<P>Download the zipped archive, and extract it.&nbsp; You'll get a lot
of
<BR>files, but to make things easier on yourself, move the subdirectory
<BR>called "perl" to a location under your root directory...an additional
<BR>partition or hard drive, such as d: or e: will suffice just as easily.

<P>********************************************************************
<BR>NEWBIE NOTE:&nbsp; The easiest way to move the subdirectory while using
<BR>windows is to drop and drag it...hold down the left mouse button on
<BR>the "perl" directory and drag it to the new desired location before
<BR>releasing the mouse button.&nbsp; This will automatically relocate
the
<BR>directory and all subdirectories and files.

<P>If you need more assistance, check out:
<BR><A HREF="http://www.pconline.com/~erc/perl95.htm">http://www.pconline.com/~erc/perl95.htm</A>
<BR>********************************************************************

<P>Once you have completed moving the directory, you need to add the
<BR>location of the "bin" subdirectory to your PATH statement.&nbsp; If
you
<BR>moved the directory to beneath your root directory on c:, that
<BR>statement will be "c:\perl\bin".

<P>********************************************************************
<BR>NEWBIE NOTE:&nbsp; Your PATH statement tells the command shell where
to
<BR>look for commands.&nbsp; The PATH statement can be embedded in your
<BR>autoexec.bat file, if you are using Win95 (or added as an
<BR>environment variable under Control Panel -> System -> Environment
<BR>if you are using NT).&nbsp; If you are simply relying on your autoexec.bat
<BR>file to load your enviroment variables, then the entry should look
<BR>like:

<P>PATH = .;c:\;c:\windows;c:\windows\system;c:\windows\command;
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; c:\perl\bin

<P>or you could simply create a batch file called setperl.bat, and
<BR>include the statement:

<P>SET PATH = %PATH%;c:\perl\bin

<P>Now when you want to run Perl scripts, all you need to do is
<BR>execute the batch file to update your environment variables.
<BR>********************************************************************

<P>[Where can I find more information regarding Perl?]
<BR><A HREF="http://reference.perl.com/query.cgi?windows">http://reference.perl.com/query.cgi?windows</A>

<P>This site provides several links to information regarding Perl,
<BR>as well as links to example scripts.

<P>[Perl for Win32 FAQ]
<BR><A HREF="http://www.endcontsw.com/people/evangelo/Perl_for_Win32_FAQ.html">http://www.endcontsw.com/people/evangelo/Perl_for_Win32_FAQ.html</A>

<P>[The Perl Journal]
<BR><A HREF="http://www.tpj.com/">http://www.tpj.com/</A>

<P>[Yahoo's Perl Page]
<BR><A HREF="http://www.yahoo.com/Computers_and_Internet/Programming_Languages/Perl/">http://www.yahoo.com/Computers_and_Internet/Programming_Languages/Perl/</A>

<P>Further, the O'Reilly and Assoc. publishing site has examples online
<BR>from the "Learning Perl on Win32 Systems" book at:
<BR><A HREF="http://www.oreilly.com/catalog/lperlwin/">http://www.oreilly.com/catalog/lperlwin/</A>

<P>[What can I do with Perl?]

<P>Perl is great for searching and organizing text.&nbsp; This is especially
<BR>true for volumnious log files.&nbsp; But Perl is also an excellent
tool
<BR>for automating systems administration tasks...which then obviously
<BR>lends itself to being an excellent hacking tool.

<P>Again, please keep in mind that this article is not meant to be a
<BR>full-blown tutorial, describing all of the intricacies of Perl.
<BR>Rather, it is meant as an introduction, to show how this tool can
<BR>be used, and to ignite further curiosity within the reader, to explore
<BR>the subject deeper.

<P>********************************************************************
<BR>It needs to be noted here that there are modules within the Perl
<BR>distribution that will not work on Win95, as they are designed
<BR>for use with NT.&nbsp; A "module" is similar to a library in C++, in
that
<BR>it is made up of commands to that are designed to make your job easier.
<BR>The commands are already set up as an Application Programming Interface,
<BR>so that all you need to do is provide the correct arguements, in the
<BR>correct order, and you can expect a particular result.

<P>However, the fact that all of the modules will not work with Win95
<BR>is hardly more than a minor annoyance.&nbsp; There are already several
<BR>programs that exist on Win95 that can be used within the Perl scripts
<BR>that you write to do considerable work.&nbsp; In essence, any command
that
<BR>is command-line in nature (ie, it is run from the command prompt, not
<BR>as a GUI program) is an excellent candidate for being included in
<BR>your Perl scripts.&nbsp; Such programs can be found on a variety of
sites
<BR>and resources, to include the TUCOWS archive (http://www.tucows.com)
<BR>and the Win95 Resource Kit.
<BR>********************************************************************

<P>As with other languages, the first program that is generally written
<BR>is the "Hello, World" program.&nbsp; Open an editor (Notepad or the
DOS
<BR>Editor program will do) and enter the following line:

<P>print "Hello, World!\n";

<P>Save the file as "hello.plx", and at the prompt, enter:

<P>c:\>perl hello.plx

<P>Assuming that your PATH statement is set up correctly, you will see:

<P>Hello, World!

<P>Now, let's add some arguements to our little program.&nbsp; Change the
<BR>hello.plx file to now contain the following lines:

<P>if (length($ARGV[0]) == 0) {
<BR>&nbsp; print "Usage:&nbsp; perl hello.plx message";
<BR>}
<BR>else {
<BR>&nbsp; print "Hello, $ARGV[0]\n";
<BR>}

<P>What we've done now is included arguements, or ways of configuring
<BR>our script for use at run-time.&nbsp; The command line arguements are
<BR>entered one after another, and we could continue to add further
<BR>error checking to verify correct number of arguements, and the
<BR>format of each arguement.&nbsp; However, that exercise will be left
to the
<BR>reader.

<P>Now, let's try something interesting.&nbsp; What we'll do is enter,
say,
<BR>the network portion of a class C IP address (the first three octets),
<BR>and have our script (called "test.plx") print out the range from 2
to
<BR>30 for the host portion (NOTE:&nbsp; The host portion of a class C
IP
<BR>address is the last octet.&nbsp; As the last octet is really a byte,
or a
<BR>series of 8 ones and zeros, the smallest number possible is 0, and
the
<BR>largest is 255.&nbsp; The test script can be easily modified to print
out
<BR>the entire range.)

<P>The script "test.plx" should contain the following lines:

<P>-----&nbsp; begin script&nbsp; -----

<P>if (length($ARGV[0]) == 0) {
<BR>&nbsp; print "Usage:&nbsp; perl test.plx IPADDR";
<BR>&nbsp; exit 0;
<BR>}
<BR>else {
<BR>&nbsp; print "Entering test.&nbsp; Using $ARGV[0]\n";
<BR>}

<P>$ip = $ARGV[0];

<P>$host = 2;

<P>while ($host &lt;= 30) {
<BR>&nbsp; $testip = $ip . ".$host";
<BR>&nbsp; print "$testip\n";
<BR>&nbsp; $host++;
<BR>}

<P>-----&nbsp; end script&nbsp; -----

<P>Run the script by typing:

<P>perl test.plx 131.120.67

<P>at the command prompt, and you will see the full class C addresses
<BR>scroll by.

<P>*******************************************************************
<BR>PROGRAMMING NOTE:&nbsp; We've seen a couple of simple scripts so far,
and
<BR>now is a good time to mention a couple of things.&nbsp; As you can
see,
<BR>Perl has the familiar control structures (while and for loops, if/else
<BR>statements, etc).&nbsp; Variables are prefaced with the "$" symbol,
arrays
<BR>are prefaced with the "@" symbol, and hashes are prefaced with the
"%"
<BR>symbol.&nbsp; Perl is capable of much more, to include sorting and
formatting
<BR>text, all sorts of error-checking, etc.&nbsp; Also, keep in mind that
the
<BR>motto of Perl is "there's more than one way to do it".
<BR>*******************************************************************

<P>Now, what is the use of this?&nbsp; What can I do with this?&nbsp; If
you
<BR>remember an earlier GTMHH that dealt with accessing win95 machines
<BR>across the Internet, there were a couple of commands that are native
<BR>to win95 (and NT) that we were interested in, and some particular
<BR>responses that we were looking for.&nbsp; As a review, we used the
"nbtstat"
<BR>and "net view" commands, and the particular response we were looking
<BR>for was the hex code "&lt;20>" in the NetBIOS Name Table, indicating
that
<BR>the host was advertising shares.

<P>*******************************************************************
<BR>NEWBIE NOTE:&nbsp; For the nbtstat and net commands to work, you have
to
<BR>have NetBIOS installed.&nbsp; To install NetBIOS, choose Control Panel
->
<BR>Network -> Add -> Protocol -> Microsoft -> NetBEUI.&nbsp; Also make
sure
<BR>that you have "Client for Microsoft Networks" installed.
<BR>*******************************************************************
<BR>*******************************************************************
<BR>SYSADMIN NOTE:&nbsp; The following Perl script can be used to scan
your
<BR>subnets and look for win95 hosts that have been modified to enable
<BR>file and print sharing, or that have had additional shares added to
<BR>the list.
<BR>*******************************************************************

<P>The following script can be used to scan a class C IP address range,
<BR>looking for win95 hosts with sharing enabled.&nbsp; If a host is found
to
<BR>have sharing enabled, the IP address will be printed to a log.&nbsp;
If
<BR>"net view" returns any disk shares, those disk shares will also be
<BR>added to the log.

<P>NOTE:&nbsp; This script does only minimal checking of the arguement
passed
<BR>to it.&nbsp; The required arguement is the network address of a Class
C
<BR>IP address; ie, 132.67.89 (NOTE:&nbsp; Do NOT add a trailing period).

<P>-----&nbsp; begin script&nbsp; -----

<P>//&nbsp; script:&nbsp; sweep.plx
<BR>//&nbsp; usage:&nbsp;&nbsp; perl sweep.plx classCIP
<BR>//&nbsp; author:&nbsp; Keydet89@yahoo.com

<P>// check number of arguements; if the command line doesn't
<BR>// have the correct number of arguements, quit.
<BR>//
<BR>// the format for the arguement is the first three octets
<BR>// representing the network address of a Class C IP address
<BR>// ie, 130.20.67 (NOTE:&nbsp; do NOT add a trailing period)
<BR>if (length($ARGV[0]) == 0) {
<BR>&nbsp; print "Usage:&nbsp; perl sweep.plx classCIP";
<BR>&nbsp; exit 0;
<BR>}
<BR>else {
<BR>&nbsp; print "Starting sweep.&nbsp; Using $ARGV[0]\n";
<BR>}

<P>// open log file for saving data
<BR>// Note:&nbsp; You can maintain a running log file by using the
<BR>// appropriate redirection operator...ie, open(LOG,">>sweep.log")
<BR>open(LOG,">sweep.log") || die "Could not open log file.";

<P>// assign arguement to a variable to make it easier to use
<BR>$ip = $ARGV[0];

<P>// assign first host; generally speaking, host = 1 is
<BR>// used for the router interface leading into the subnet
<BR>$host = 2;

<P>// span hosts through 254
<BR>while ($host &lt; 255) {

<P>// put IP address together
<BR>&nbsp; $testip = $ip . ".$host";

<P>// verify that IP address is properly constructed
<BR>&nbsp; print "Trying $testip\n";

<P>// open the nbtstat command
<BR>&nbsp; open(NBT, "nbtstat -A $testip | ");

<P>// the following while loop looks for the &lt;20> entry
<BR>// in the NetBIOS Name Table.&nbsp; If found, indicate that file
<BR>// sharing is enabled and write the data to the log.&nbsp; Do the
<BR>// same with "net view", writing disk shares to the log.
<BR>&nbsp; while(&lt;NBT>) {
<BR>&nbsp;&nbsp;&nbsp; if (grep(/&lt;20>&nbsp; UNIQUE/,$_) {
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print "Sharing enabled.\n";
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print LOG "Sharing enabled for host
$testip\n";

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; open(VIEW, "net view \\\\$testip | ");
<BR>&nbsp;
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; while(&lt;VIEW>) {
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (grep(/Disk/, $_) {
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print "Disk
share: $_";
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; print LOG "Disk
share: $_ ";
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
<BR>&nbsp;&nbsp;&nbsp; }
<BR>&nbsp; }

<P>// increment the host portion of the IP address
<BR>&nbsp; $host++;
<BR>}

<P>// close the log file
<BR>close(LOG) || die "Could not close log file: $!\n";

<P>-----&nbsp;&nbsp; end script&nbsp;&nbsp; -----

<P>That's it!&nbsp; With a little thought and imagination, not to mention
<BR>knowledge of Perl, anyone (sysadmins, especially) can modify this
<BR>script to gather more information, or attempt to access the shares
<BR>that are identified.

<P>********************************************************************
<BR>EVIL GENIUS or SYSADMIN NOTE:&nbsp; There is a Win32 extension called
<BR>Win32::GetNextAvailDrive.&nbsp; This extension can be used in combination
<BR>with the "net use" command to map drive shares to the local machine.
<BR>********************************************************************

<P>Please note that a script similar to parts of the above script can
<BR>be found in the appendix of Simple Nomad's NT Hack FAQ
<BR>(<A HREF="http://www.nmrc.org/indexg.html">http://www.nmrc.org/indexg.html</A>).&nbsp;
That script was written by Dave
<BR>LeBlanc of ISS...but I could not get it to work on my system.

<P>There are other neat little things you can do with Perl.&nbsp; Here's
one
<BR>out of the "Learning Perl on Win32 Systems" book (by Schwartz, Olson,
<BR>and Christiansen):

<P>-----&nbsp; begin script&nbsp; -----

<P>use Win32;
<BR>($string, $major, $minor, $build, $id) = Win32::GetOSVersion();
<BR>@os = qw(Win32s, Win95, WinNT);
<BR>print "$os[$id] $major\.$minor $string (Build $build)\n";

<P>-----&nbsp;&nbsp; end script&nbsp;&nbsp; -----

<P>Run this script, and you'll get version information regarding your
<BR>operating system.

<P>Another nifty little trick you can use Perl for is a port scanner.
<BR>Win95 will make use of the IO::Socket module, allowing you to
<BR>access TCP sockets.

<P>*****************************************************************
<BR>SYSADMIN NOTE:&nbsp; One of the things that a sysadmin/webmaster should
<BR>do when maintaining a site is to either delete or change the banners
<BR>that appear for their services.&nbsp; This makes it harder for a potential
<BR>attacker to figure out what operating system he is dealing with.
<BR>Along those lines, Perl can be used on the web server to listen for
<BR>PHF exploit attempts.&nbsp; You can write a script so that when someone
<BR>attempts the PHF exploit, the script sends them a bogus /etc/passwd
<BR>file (this is particularly tricky for NT admins...NT doesn't have an
<BR>/etc/passwd file!!) and then emails the sysadmin the environment
<BR>variables that are available from the browser.

<P>Further, Perl has a great deal of utility with regards to NT
<BR>systems.&nbsp; As mentioned above, the modules work on NT, but not
on
<BR>Win95.

<P>One of the uses of Perl on Un*x systems is to cull log files, looking
<BR>for suspicious activity.&nbsp; You can do the same thing on NT with
the
<BR>Event Logs.&nbsp; You won't be able to get near the sophistication
of
<BR>some expert systems used in intrusion detection software, but you
<BR>can do quite a bit.&nbsp; By enabling auditing on the correct events,
and
<BR>generally locking down your security overall, you can do quite a bit
<BR>to keep on top of things.

<P>Speaking of security, you can also use Perl to create, examine, and
<BR>change Registry entries on NT.&nbsp; (NOTE:&nbsp; Before doing anything
with
<BR>the NT Registry, run the RDisk utility, and only make one change at
<BR>a time.)&nbsp; For example, you can create a script that will create
or
<BR>enable certain security features, such as producing a login banner,
<BR>enabling Syskey encryption of the Registry on SP3 systems, etc.
<BR>&nbsp;
<BR>Using Perl in combination with the command line tools available from
<BR>the Resource Kit will give you an incredible toolkit, allowing you
<BR>to handle any situation that may arise.
<BR>*****************************************************************

<P>In the future, look for a Perl for Win32 article dealing with
<BR>NT-specific issues.
<BR>&nbsp;
</BODY>
</HTML>
